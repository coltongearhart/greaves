<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.376">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Colton Gearhart">
<meta name="author" content="Dhanuja Kasturiratna">
<meta name="dcterms.date" content="2018-06-13">
<meta name="keywords" content="Bayesian inference, Gibbs sampling, Markov chain, Monte Carlo simulation">
<title>Implementation of Gibbs Sampling within Bayesian Inference and its Applications in Actuarial Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="greaves_files/libs/clipboard/clipboard.min.js"></script>
<script src="greaves_files/libs/quarto-html/quarto.js"></script>
<script src="greaves_files/libs/quarto-html/popper.min.js"></script>
<script src="greaves_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="greaves_files/libs/quarto-html/anchor.min.js"></script>
<link href="greaves_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="greaves_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="greaves_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="greaves_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="greaves_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script src="greaves_files/libs/kePrint-0.0.1/kePrint.js"></script><link href="greaves_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body>

<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Implementation of Gibbs Sampling within Bayesian Inference and its Applications in Actuarial Science</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Colton Gearhart <a href="mailto:gearhart.colton.work@gmail.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              <a href="https://www.nku.edu/academics/artsci/about/departments/math.html">
              Northern Kentucky University
              </a>
            </p>
        </div>
        <div class="quarto-title-meta-contents">
      <p class="author">Dhanuja Kasturiratna <a href="mailto:kasturirad1@nku.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              <a href="https://www.nku.edu/academics/artsci/about/departments/math.html">
              Northern Kentucky University
              </a>
            </p>
        </div>
      </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 13, 2018</p>
      </div>
    </div>
    
      
    </div>
    
  <div>
    <div class="abstract">
      <div class="block-title">Abstract</div>
      <p>This paper discusses how a variety of actuarial models can be implemented and analyzed with a Bayesian approach using Gibbs sampling, a Markov chain Monte Carlo method. This approach allows a practitioner to analyze complicated actuarial models by reducing them to simpler, more manageable models. Furthermore, general properties of Gibbs sampling are discussed through a simulation approach.</p>
    </div>
  </div>

  <div>
    <div class="keywords">
      <div class="block-title">Keywords</div>
      <p>Bayesian inference, Gibbs sampling, Markov chain, Monte Carlo simulation</p>
    </div>
  </div>
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#r-setup" id="toc-r-setup" class="nav-link active" data-scroll-target="#r-setup">R Setup</a></li>
  <li>
<a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
<li><a href="#sec-bayes" id="toc-sec-bayes" class="nav-link" data-scroll-target="#sec-bayes"><span class="header-section-number">1.1</span> Bayesian Inference</a></li>
  <li><a href="#markov-chain-monte-carlo-methods-and-gibbs-sampling" id="toc-markov-chain-monte-carlo-methods-and-gibbs-sampling" class="nav-link" data-scroll-target="#markov-chain-monte-carlo-methods-and-gibbs-sampling"><span class="header-section-number">1.2</span> Markov Chain Monte Carlo Methods and Gibbs Sampling</a></li>
  </ul>
</li>
  <li>
<a href="#applications" id="toc-applications" class="nav-link" data-scroll-target="#applications"><span class="header-section-number">2</span> Applications</a>
  <ul class="collapse">
<li><a href="#demonstrating-the-properties-of-gibbs-sampling" id="toc-demonstrating-the-properties-of-gibbs-sampling" class="nav-link" data-scroll-target="#demonstrating-the-properties-of-gibbs-sampling"><span class="header-section-number">2.1</span> Demonstrating the Properties of Gibbs Sampling</a></li>
  <li><a href="#modeling-number-of-claims" id="toc-modeling-number-of-claims" class="nav-link" data-scroll-target="#modeling-number-of-claims"><span class="header-section-number">2.2</span> Modeling Number of Claims</a></li>
  <li><a href="#modeling-size-of-claim" id="toc-modeling-size-of-claim" class="nav-link" data-scroll-target="#modeling-size-of-claim"><span class="header-section-number">2.3</span> Modeling Size of Claim</a></li>
  </ul>
</li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content"><!-- % define LaTeX macros (/shortcuts) --><!-- % shortcut for ~ 'Named dist ' in normal font with space before parameters would go --><div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Quarto blog publish details
</div>
</div>
<div class="callout-body-container callout-body">
<p>This blog was created using <a href="https://quarto.org/">Quarto</a> and published with Github Pages.</p>
</div>
</div>
<section id="r-setup" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="r-setup">R Setup</h2>
<div class="cell" data-hash="greaves_cache/html/setup_d125412d3f5dd5f640e33b8b89e80ed6">
<details><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gitlab.com/vigou3/actuar">actuar</a></span><span class="op">)</span> <span class="co"># for pareto()</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">truncdist</span><span class="op">)</span> <span class="co"># for rtrunc()</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op">)</span> <span class="co"># for kable_styling()</span></span>
<span></span>
<span><span class="co"># create default storytelling with data theme</span></span>
<span><span class="va">theme_swd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>  <span class="co"># titles and captions</span></span>
<span>  plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">1.75</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"grey30"</span><span class="op">)</span>,</span>
<span>  plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">1.25</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"grey30"</span><span class="op">)</span>,</span>
<span>  plot.caption <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"grey30"</span><span class="op">)</span>,</span>
<span>  <span class="co"># axes</span></span>
<span>  axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"grey30"</span><span class="op">)</span>,</span>
<span>  axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"grey30"</span><span class="op">)</span>,</span>
<span>  axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span>,</span>
<span>  axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span>,</span>
<span>  <span class="co"># plot background and gridlines</span></span>
<span>  panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span>,</span>
<span>  panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span>,</span>
<span>  <span class="co"># legend</span></span>
<span>  legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey30"</span><span class="op">)</span>,</span>
<span>  legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey30"</span><span class="op">)</span>,</span>
<span>  legend.position <span class="op">=</span> <span class="st">"top"</span> </span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="introduction" class="level2" data-number="1"><h2 data-number="1" class="anchored" data-anchor-id="introduction">
<span class="header-section-number">1</span> Introduction</h2>
<p>The use of predictive models in research is a common practice for actuaries. However, they are still realizing the full potential of the many available techniques involving predictive models. The recent developments in high speed computation have opened new avenues to actuaries who are involved in constructing models that can be used in predicting future uncertain events. The practical development of techniques such as linear programming, dynamic programming, Monte Carlo experiments and many others would not have been possible without the arrival of high-speed computers. The actuarial profession needs to keep pace with these developments and consider how these methods can be utilized more effectively in decision making.</p>
<p>Stochastic models play a wide role in actuarial science applications. Mathematical analysis (a theoretical approach) is one way to extract characteristics of such models. A practitioner may also use simulation to study these models. This approach is especially useful when the stochastic models are complicated and impossible to tract theoretically. Because many actuarial models are like this, simulation is an important tool.</p>
<p>This paper discusses usefulness and importance of combining Monte Carlo simulation techniques with Bayesian analysis in order to study complicated stochastic models in actuarial sciences. Bayesian analysis is quite useful as it allows one to learn about the whole distribution of a chosen quantity, rather than just a single statistic. Additionally, the assignment of probability distributions to unknown quantities allows for the reflection of uncertainty. This uncertainty is represented as the prior distribution, which is then updated with data. This increases the reliability of the estimates. Then, once suitable models for the parameters are obtained, one can study the distribution of the variables of interest, which is the end goal of Bayesian analysis.</p>
<section id="sec-bayes" class="level3" data-number="1.1"><h3 data-number="1.1" class="anchored" data-anchor-id="sec-bayes">
<span class="header-section-number">1.1</span> Bayesian Inference</h3>
<p>In classical statistical techniques, model parameters are assumed to be fixed quantities; only the data is random. Thus, probability distributions can only be used to represent the data. But in Bayesian statistics, probability distributions are often applied to more than just the data. They can represent prior uncertainty in model parameters. These then get updated with current data to produce posterior probability distributions. In effect, the parameters now contain less uncertainty; in other words, they are more informed. This thinking produces a general rule in Bayesian statistics: any quantity which has uncertainty can be represented by a probability distribution. This can be shown in Bayes’ theorem, which simply is a demonstration of conditional probability, expressed using probability distributions as follows:</p>
<p><span class="math display">\[
f(\theta\mid data) = \frac{f(data\mid\theta)\,f(\theta)}{f(data)}.
\]</span></p>
<p>In this scenario, <span class="math inline">\(f(\theta\mid data)\)</span> is the posterior distribution for the parameter <span class="math inline">\(\theta\)</span>. <span class="math inline">\(f(data\mid\theta)\)</span> is the sampling density for the data. This distribution is proportional to the likelihood function; however, it differs by a constant which serves to make it a proper density. <span class="math inline">\(f(\theta)\)</span> is the prior distribution for the parameter. Finally, <span class="math inline">\(f(data)\)</span> is the marginal probability of the data. When considering a continuous sample space, this marginal probability is computed as</p>
<p><span class="math display">\[
f(data) = \int{f(data\mid\theta)\,f(\theta)\,d\theta}.
\]</span></p>
<p>In words, this is the integral of the sampling density multiplied by the prior distribution over the sample space of <span class="math inline">\(\theta\)</span>. This quantity is often referred to as the “marginal likelihood” for the data. It makes the posterior density proper by functioning as a normalizing constant. In addition, it is proportional to the likelihood function. These two qualities lead Bayes’ theorem for probability distributions to be frequently stated as</p>
<p><span class="math display">\[
Posterior \approx Likelihood\,\times Prior.
\]</span></p>
<p>Once the posterior distribution for a parameter is derived, Bayesian analysis attempts to summarize the entire distribution. In addition to not having a reliance on asymptotic arguments about normality, this allows for numerous additional tests and summaries. Occasionally, these distributions have closed-form solutions (or at least solutions that can be computed using numerical methods). However, for many other distributions the integrals may be quite difficult or even impossible to compute, especially multivariate ones. In this instance, Monte Carlo simulation plays a major role. The general logic of sampling is to generate a sample of size <span class="math inline">\(n\)</span> from the desired distribution and then apply discrete formulas to these samples. This, in effect, approximates the integrals of interest. For example, a mean is estimated by</p>
<p><span class="math display">\[
\int xf(x)\,dx \approx \frac{1}{n}\sum x,
\]</span></p>
<p>and a variance by</p>
<p><span class="math display">\[
\int (x-\mu)^2\,f(x)\,dx \approx \frac{1}{n} \sum (x-\mu)^2.
\]</span></p>
<p>Additionally, any desired quantile can be found by noting the value of <span class="math inline">\(x\)</span> that has <span class="math inline">\(Q\%\)</span> of the sampled values below it.</p>
<p>To sum up, Bayesian inference commonly follows these steps:</p>
<ol type="1">
<li><p>Creating a model and obtaining posterior distributions for the parameters being studied.</p></li>
<li><p>Simulating samples from the posterior distributions.</p></li>
<li><p>Taking discrete formulas and applying them to the samples found in step 2 in order to summarize knowledge of the parameters.</p></li>
</ol>
<p>This whole process differs from the approach taken in Classical statistics, where point estimates are found for parameters and inferences are conducted using the standard error and the central limit theorem.</p>
</section><section id="markov-chain-monte-carlo-methods-and-gibbs-sampling" class="level3" data-number="1.2"><h3 data-number="1.2" class="anchored" data-anchor-id="markov-chain-monte-carlo-methods-and-gibbs-sampling">
<span class="header-section-number">1.2</span> Markov Chain Monte Carlo Methods and Gibbs Sampling</h3>
<p>One very useful class of simulation techniques is known as Markov chain Monte Carlo (MCMC) sampling methods. The purpose of using these methods is to study distributions that would be very difficult to study otherwise (these distributions will later be referred to as “target distributions”). With the use of MCMC methods, a researcher can simulate a series of dependent random draws from models that are often quite complex. MCMC methods prove to be very useful when sampling from multivariate distributions that would normally be difficult to sample from. This is done by breaking them down into more feasible multivariate distributions or even univariate distributions.</p>
<p>The first step of a MCMC method is to specify a Markov chain with a unique invariant distribution equal to the target distribution (we will discuss one way to do this in the following paragraph). The next step is to generate a new value from this Markov chain given the previous value (for further reading, refer to <span class="citation" data-cites="berg2004">(<a href="#ref-berg2004" role="doc-biblioref">Berg 2004</a>)</span>. This forms an iterative process which produces a Markov chain of values. Furthermore, after the burn-in iterations<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> are complete, it has been shown that these generated values nearly follow a random draw from the target distribution. These samples can then be used for inference procedures in a variety of ways.</p>
<p>One popular MCMC method for constructing a Markov chain for a target density is Gibbs sampling. It was first introduced to the field of image restoration by Geman and Geman <span class="citation" data-cites="geman1984">(<a href="#ref-geman1984" role="doc-biblioref">Geman and Geman 1984</a>)</span>, however its use in the field of Bayesian analysis was first recognized by Gelfand and Smith <span class="citation" data-cites="gelfand1990">(<a href="#ref-gelfand1990" role="doc-biblioref">Gelfand and Smith 1990</a>)</span>. Since then, Gibbs sampling has only appeared a few times within actuarial literature. Carlin <span class="citation" data-cites="carlin1992">(<a href="#ref-carlin1992" role="doc-biblioref">Carlin 1992</a>)</span> used Gibbs sampling to study state space modeling of non-standard actuarial time series and Carlin <span class="citation" data-cites="asimple1994">(<a href="#ref-asimple1994" role="doc-biblioref">Carlin 1994</a>)</span> also used it to develop a Monte Carlo approach to Bayesian graduation. Klugman and Carlin <span class="citation" data-cites="carlinb.p.1993">(<a href="#ref-carlinb.p.1993" role="doc-biblioref">Carlin B. P. and Klugman S.A 1993</a>)</span> used Gibbs sampling in a similar area, however they had a focus on Whittaker-Henderson graduation. Additionally, Scollnik <span class="citation" data-cites="scollnik1993">(<a href="#ref-scollnik1993" role="doc-biblioref">Scollnik 1993</a>)</span> performed a Bayesian analysis of a simultaneous equations model for insurance rate-making.</p>
<p>On occasion, sampling from the multivariate posterior distribution is not feasible but sampling from the conditional distributions of each parameter is possible (for further reading, refer to <span class="citation" data-cites="besag1974">(<a href="#ref-besag1974" role="doc-biblioref">Besag 1974</a>)</span>). In this situation, Gibbs sampling has been found to be quite applicable. To create the Markov chain, Gibbs sampling uses a set of full conditional distributions associated with the target distribution. These are then used to generate a Markov chain with a unique invariant distribution equal to the target distribution. A basic Gibbs sampling algorithm is displayed below (<span class="math inline">\(j\)</span> represents the iteration count).</p>
<ol start="0" type="1">
<li><p>Assign a vector of starting values <span class="math inline">\(x^{(j)} = (x^{(j)}_1, x^{(j)}_2, \ldots, x^{(j)}_k)\)</span>, with <span class="math inline">\(j=0\)</span>.</p></li>
<li><p>Set <span class="math inline">\(j = j + 1\)</span>.</p></li>
<li><p>Simulate <span class="math inline">\(x^{(j)}_1 \sim f(x_1 \mid x^{(j-1)}_2, x^{(j-1)}_3, \ldots, x^{(j-1)}_k)\)</span>.</p></li>
<li><p>Simulate <span class="math inline">\(x^{(j)}_2 \sim f(x_2 \mid x^{(j-1)}_1, x^{(j-1)}_3, \ldots, x^{(j-1)}_k)\)</span>.</p></li>
</ol>
<p><span class="math inline">\(\hspace{10pt} \vdots \hspace{30pt} \vdots\)</span></p>
<ol start="11" type="a">
<li>Simulate <span class="math inline">\(x^{(j)}_k \sim f(x_k \mid x^{(j-1)}_1, x^{(j-1)}_2, \ldots, x^{(j-1)}_{k-1})\)</span>.</li>
</ol>
<p>k+1. Form <span class="math inline">\(x^{(j)} = (x^{(j)}_1, x^{(j)}_2, \ldots, x^{(j)}_k)\)</span>.</p>
<p>k+2. Return to step 1.</p>
<p>In words, the Gibbs sampling algorithm defined above generates a random draw from each of the full conditional distributions. However, as the algorithm progresses, the values of the conditioning variables are sequentially updated. Thus, the next draw depends on the previous one. Moreover, a key aspect of Gibbs sampling is that the full conditional distribution does not need to be known; it only needs to be known up to a normalizing constant. In conjunction with a Bayesian approach, Gibbs sampling allows us to use the joint densities that have all other parameters set at their current values. In other words, with all other parameters treated as fixed, the result is often a known form of the density. This greatly reduces the difficulty of many analyses.</p>
</section></section><section id="applications" class="level2" data-number="2"><h2 data-number="2" class="anchored" data-anchor-id="applications">
<span class="header-section-number">2</span> Applications</h2>
<section id="demonstrating-the-properties-of-gibbs-sampling" class="level3" data-number="2.1"><h3 data-number="2.1" class="anchored" data-anchor-id="demonstrating-the-properties-of-gibbs-sampling">
<span class="header-section-number">2.1</span> Demonstrating the Properties of Gibbs Sampling</h3>
<p>Here we are going to study the properties of Gibbs sampling through simulation. We start by assuming the size of a claim <span class="math inline">\(X\)</span> is exponentially distributed with parameter <span class="math inline">\(\lambda\)</span>. Further, we treat the parameter <span class="math inline">\(\lambda\)</span> as a random variable that follows a gamma distribution with parameters <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>. <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> are constants. Stemming from our Bayesian approach, we can write this information as follows: the conditional distribution of <span class="math inline">\(X\)</span> given <span class="math inline">\(\lambda\)</span> as</p>
<p><span id="eq-x-given-lambda"><span class="math display">\[
f(x \mid \lambda) = \lambda e^{-\lambda x},\hspace{10pt} x &gt; 0
\tag{1}\]</span></span></p>
<p>and the mixing distribution of <span class="math inline">\(\lambda\)</span>, with parameters <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> as</p>
<p><span class="math display">\[
f(\lambda \mid \alpha,\beta) = \frac{\beta^\alpha}{\Gamma(\alpha)} \lambda^{^\alpha-1} e{-\beta\lambda},\hspace{10pt}\lambda &gt; 0.
\]</span></p>
<p>Now, the joint distribution of <span class="math inline">\(X\)</span> and <span class="math inline">\(\lambda\)</span> can be obtained.</p>
<p><span class="math display">\[
\begin{align*}
f(x,\lambda) &amp;= f(x \mid \lambda)f(\lambda)\\
&amp;= \frac{1}{\Gamma(\alpha)} \beta^\alpha \lambda^\alpha e^{-\lambda(x+\beta)}.
\end{align*}
\]</span></p>
<p>By integrating the above joint density with respect to <span class="math inline">\(\lambda\)</span>, we can obtain the marginal distribution of <span class="math inline">\(X\)</span>.</p>
<p><span class="math display">\[
\begin{align*}
f(x) &amp;= \int_0^\infty{f(x,\lambda)\,d\lambda}\\
&amp;= \frac{\alpha \beta^\alpha}{(\beta+x)^{\alpha+1}},\hspace{10pt} x &gt; 0\\
&amp;\sim \text{Pareto}\, (\alpha,\beta).
\end{align*}
\]</span></p>
<p>Note that <span class="math inline">\(f(x)\)</span> simplifies to a Pareto distribution with parameters <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>. This density is the closed form solution that was mentioned in <a href="#sec-bayes" class="quarto-xref">Section&nbsp;1.1</a>; in most problems, this is not possible to obtain. However, we chose distributions such that there would be a closed form solution in order to compare our results to. Finally, we can solve for each conditional distribution. Having already been given <span class="math inline">\(f(x \mid \lambda)\)</span> in Equation <a href="#eq-x-given-lambda" class="quarto-xref">Equation&nbsp;1</a>, <span class="math inline">\(f(\lambda\mid x)\)</span> is derived as follows:</p>
<p><span class="math display">\[
\begin{align*}
f(\lambda\mid x) &amp;= \frac{f(x,\lambda)}{f(x)}\\
&amp;= \frac{(x+\beta)^{\alpha+1} \lambda^\alpha e^{-\lambda(x+\beta)}}{\Gamma(\alpha+1)}\\
&amp;\sim \text{gamma}\, (\alpha+1,x+\beta).
\end{align*}
\]</span></p>
<p>Notice here that the conditional distribution of <span class="math inline">\(f(\lambda \mid x)\)</span> simplifies to a gamma distribution. This is because of the use of a conjugate prior distribution. This simply means that the mixing distribution is from the same family as the variable of interest (for further reading, refer to <span class="citation" data-cites="casella2002">(<a href="#ref-casella2002" role="doc-biblioref">Casella and Berger 2002</a>)</span>).</p>
<p>The next step in Gibbs sampling is to run our two conditional distributions through the iterative algorithm defined below:</p>
<ol type="1">
<li><p>Select arbitrary initial values <span class="math inline">\(x^{(0)}\)</span> and <span class="math inline">\(\lambda^{(0)}\)</span>.</p></li>
<li><p>Set counter index <span class="math inline">\(i = 0\)</span>.</p></li>
<li><p>Sample <span class="math inline">\(x^{(i+1)}\)</span> from <span class="math inline">\(f(x \mid \lambda^{(i)}) \sim \text{exponential}\,(\lambda)\)</span>.</p></li>
<li><p>Sample <span class="math inline">\(\lambda^{(i+1)}\)</span> f from <span class="math inline">\(f(\lambda\mid x^{(i+1)}) \,\sim \text{gamma}\,(\alpha+1,x^{(i+1)}+\beta)\)</span>.</p></li>
<li><p>Set <span class="math inline">\(i = i + 1\)</span> and return to step 3.</p></li>
</ol>
<p>For illustrative purposes, assume <span class="math inline">\(\alpha = 5\)</span> and <span class="math inline">\(\beta = 100\)</span>. This reduces the uncertainty to the random variables <span class="math inline">\(X\)</span> and <span class="math inline">\(\lambda\)</span>. Using the principles of Gibbs sampling as shown above, 100,000 random numbers are generated for <span class="math inline">\(X\)</span> and <span class="math inline">\(\lambda\)</span>.</p>
<div class="cell" data-hash="greaves_cache/html/generate-data1_8e8ac6a6e9dce4c4d710cfc5264ecff3">
<details><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># function to generate random data from conditional distributions</span></span>
<span><span class="va">generate_sample1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">10000</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">beta</span> <span class="op">=</span> <span class="fl">100</span>, <span class="va">start_x</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">start_lambda</span> <span class="op">=</span> <span class="fl">1.5</span>, <span class="va">seed</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># create matrix</span></span>
<span>  <span class="co"># -&gt; NOTE -&gt; matrices are much faster than dataframes</span></span>
<span>  <span class="va">data_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">n</span>, ncol <span class="op">=</span> <span class="fl">3</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"iteration"</span>, <span class="st">"X"</span>, <span class="st">"lambda"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># conditionally set random seed</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">seed</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># initialize counter and starting values</span></span>
<span>  <span class="va">i</span> <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="va">data_sample</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">start_x</span>, <span class="va">start_lambda</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># generate new data for x and lambda based on sequentially updated conditional distributions</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="va">i</span> <span class="op">&lt;</span> <span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co"># record iteration</span></span>
<span>    <span class="va">data_sample</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, <span class="st">"iteration"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    </span>
<span>    <span class="co"># sample from x | lambda</span></span>
<span>    <span class="va">data_sample</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, <span class="st">"X"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, rate <span class="op">=</span> <span class="va">data_sample</span><span class="op">[</span><span class="va">i</span>, <span class="st">"lambda"</span><span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># sample from lambda | x</span></span>
<span>    <span class="va">data_sample</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, <span class="st">"lambda"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, shape <span class="op">=</span> <span class="va">alpha</span> <span class="op">+</span> <span class="fl">1</span>, rate <span class="op">=</span> <span class="va">data_sample</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, <span class="st">"X"</span><span class="op">]</span> <span class="op">+</span> <span class="va">beta</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># increase counter</span></span>
<span>    <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">data_sample</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># initialize items</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">start_x</span> <span class="op">&lt;-</span> <span class="fl">150</span></span>
<span><span class="va">start_lambda</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co"># sample from conditional distributions</span></span>
<span><span class="co"># set seed for all simulations</span></span>
<span><span class="va">seed</span> <span class="op">&lt;-</span> <span class="fl">09222023</span></span>
<span><span class="va">data_sample</span> <span class="op">&lt;-</span> <span class="fu">generate_sample1</span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, beta <span class="op">=</span> <span class="va">beta</span>, start_x <span class="op">=</span> <span class="va">start_x</span>, start_lambda <span class="op">=</span> <span class="va">start_lambda</span>, seed <span class="op">=</span> <span class="va">seed</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create data for scatterplot</span></span>
<span><span class="va">data_scatter</span> <span class="op">&lt;-</span> <span class="va">data_sample</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="va">data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">iteration</span> <span class="op">&gt;</span> <span class="va">n</span> <span class="op">-</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set number of burn-in iterations</span></span>
<span><span class="va">burn_in</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span></span>
<span><span class="co"># remove burn-in iteration</span></span>
<span><span class="va">data_sample2</span> <span class="op">&lt;-</span> <span class="va">data_sample</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="va">data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">iteration</span> <span class="op">&gt;</span> <span class="va">burn_in</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="greaves_cache/html/preview-sample1_ebc54c95dae7db84c238a193641f1c8d">
<details><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># preview</span></span>
<span><span class="fu">display_nice</span><span class="op">(</span><span class="va">data_sample2</span>, col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Iteration"</span>, <span class="st">"$X$"</span>, <span class="st">"$\\lambda$"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table data-quarto-disable-processing="true" class="table table-hover" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;"> Iteration </th>
   <th style="text-align:right;"> $X$ </th>
   <th style="text-align:right;"> $\lambda$ </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 2.347 </td>
   <td style="text-align:right;"> 0.757 </td>
  </tr>
<tr>
<td style="text-align:right;"> 102 </td>
   <td style="text-align:right;"> 2.448 </td>
   <td style="text-align:right;"> 0.532 </td>
  </tr>
<tr>
<td style="text-align:right;"> 103 </td>
   <td style="text-align:right;"> 3.218 </td>
   <td style="text-align:right;"> 0.743 </td>
  </tr>
<tr>
<td style="text-align:right;"> 104 </td>
   <td style="text-align:right;"> 0.464 </td>
   <td style="text-align:right;"> 0.273 </td>
  </tr>
<tr>
<td style="text-align:right;"> 105 </td>
   <td style="text-align:right;"> 4.399 </td>
   <td style="text-align:right;"> 0.537 </td>
  </tr>
<tr>
<td style="text-align:right;"> 106 </td>
   <td style="text-align:right;"> 1.818 </td>
   <td style="text-align:right;"> 0.377 </td>
  </tr>
<tr>
<td style="text-align:right;"> 107 </td>
   <td style="text-align:right;"> 0.847 </td>
   <td style="text-align:right;"> 0.850 </td>
  </tr>
<tr>
<td style="text-align:right;"> 108 </td>
   <td style="text-align:right;"> 1.103 </td>
   <td style="text-align:right;"> 0.874 </td>
  </tr>
<tr>
<td style="text-align:right;"> 109 </td>
   <td style="text-align:right;"> 0.151 </td>
   <td style="text-align:right;"> 0.864 </td>
  </tr>
<tr>
<td style="text-align:right;"> 110 </td>
   <td style="text-align:right;"> 1.311 </td>
   <td style="text-align:right;"> 0.229 </td>
  </tr>
</tbody>
</table>
</div>
</div>
<!-- NOTE: figures don't have labels on the rendered version, not working for some reason when add fig-cap -->
<p><a href="#fig-diag-scatter-plot-x" class="quarto-xref">Figure&nbsp;1</a> shows the last 100 sampled values for <span class="math inline">\(X\)</span> and <a href="#fig-diag-scatter-plot-lambda" class="quarto-xref">Figure&nbsp;2</a> shows the last 100 sampled values for <span class="math inline">\(\lambda\)</span>:</p>
<div class="cell" data-hash="greaves_cache/html/fig-diag-scatter-plot-x_7c52ea318e8161d7dc24bb3eb13a1c13">
<details><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create scatterplots of last iterations to visually check for randomness</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">iteration</span>,</span>
<span>                 y <span class="op">=</span> <span class="va">X</span><span class="op">)</span>,</span>
<span>             data <span class="op">=</span> <span class="va">data_scatter</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"white"</span>, shape <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span> <span class="fl">1</span>, stroke <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Iteration"</span>, y <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="va">theme_swd</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-diag-scatter-plot-x" class="quarto-figure quarto-figure-left anchored" width="50%">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-diag-scatter-plot-x-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Scatterplot of generated sample values of X
</figcaption><div aria-describedby="fig-diag-scatter-plot-x-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="greaves_files/figure-html/fig-diag-scatter-plot-x-1.png" class="img-fluid figure-img" style="width:50.0%">
</div>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="greaves_cache/html/fig-diag-scatter-plot-lambda_8749d164836af572237e33ce2dd7a768">
<details><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">iteration</span>,</span>
<span>                 y <span class="op">=</span> <span class="va">lambda</span><span class="op">)</span>,</span>
<span>             data <span class="op">=</span> <span class="va">data_scatter</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"white"</span>, shape <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span> <span class="fl">1</span>, stroke <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Iteration"</span>,</span>
<span>       y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="va">theme_swd</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-diag-scatter-plot-lambda" class="quarto-figure quarto-figure-left anchored" width="50%">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-diag-scatter-plot-lambda-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Scatterplot of generated sample values of λ
</figcaption><div aria-describedby="fig-diag-scatter-plot-lambda-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="greaves_files/figure-html/fig-diag-scatter-plot-lambda-1.png" class="img-fluid figure-img" style="width:50.0%">
</div>
</figure>
</div>
</div>
</div>
<p>As one can see from <a href="#fig-diag-scatter-plot-x" class="quarto-xref">Figure&nbsp;1</a> and <a href="#fig-diag-scatter-plot-lambda" class="quarto-xref">Figure&nbsp;2</a>, there is no pattern among the generated random numbers. Therefore, they can be considered as independent random samples.</p>
<p>Next, <a href="#fig-hist-x" class="quarto-xref">Figure&nbsp;3</a> and <a href="#fig-hist-lambda" class="quarto-xref">Figure&nbsp;4</a> show the histograms of the last 99,500 sampled values of <span class="math inline">\(X\)</span> and <span class="math inline">\(\lambda\)</span>, respectively. These values are generated from dependent sampling schemes, which were based on the full conditional distributions of <span class="math inline">\(f(x \mid \lambda)\)</span> and <span class="math inline">\(f(\lambda \mid x)\)</span>. The first 500 values of each sequence are discarded as these are considered to be the burn-in iterations. Additionally, the respective marginal density curves of <span class="math inline">\(X\)</span> and <span class="math inline">\(\lambda\)</span> are overlaid on their corresponding histogram.</p>
<div class="cell" data-hash="greaves_cache/html/fig-hist-x_994e4a2d37b0361c2488fef4a2aa2475">
<details><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># set maximum for x plot</span></span>
<span><span class="va">limit_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">data_sample2</span><span class="op">$</span><span class="va">X</span>, <span class="fl">0.995</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># in order to get the correct legend that I want...</span></span>
<span><span class="co"># -&gt; have to trick ggplot by adding another aesthetic to the desired geom (just map the correct aesthetic to a string constant of what I want it to say)</span></span>
<span><span class="co"># -&gt; then do a scale_&lt;...&gt;_manual(values = "&lt; desired color &gt;")</span></span>
<span><span class="co"># -&gt; also in a labs statement, make the name of label of that aesthetic an empty string</span></span>
<span><span class="co"># cannot do this trick more than once with the same aesthetic</span></span>
<span><span class="co"># -&gt; so if need the legend for multiple things, they must be mapped to different aesthetics</span></span>
<span><span class="co"># create histogram of x with marginal density curve overlaid</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"Sampled values"</span><span class="op">)</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">data_sample2</span>,</span>
<span>                 bins <span class="op">=</span> <span class="fl">40</span>,</span>
<span>                 color <span class="op">=</span> <span class="st">"grey60"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, color <span class="op">=</span> <span class="st">"Actual density"</span><span class="op">)</span>,</span>
<span>                data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">limit_x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                fun <span class="op">=</span> <span class="va">dpareto2</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>min <span class="op">=</span> <span class="fl">0</span>, shape <span class="op">=</span> <span class="va">alpha</span>, scale <span class="op">=</span> <span class="va">beta</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">100000</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">limit_x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="st">"grey40"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">""</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">theme_swd</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-hist-x" class="quarto-figure quarto-figure-left anchored" width="50%">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-hist-x-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Histogram of generated sample values of X
</figcaption><div aria-describedby="fig-hist-x-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="greaves_files/figure-html/fig-hist-x-1.png" class="img-fluid figure-img" style="width:50.0%">
</div>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="greaves_cache/html/fig-hist-lambda_ac63b8928a1f98f35d47feda2d3214e0">
<details><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create histogram of lambda with marginal density curve overlaid</span></span>
<span><span class="co"># -&gt; no limits were made for lambda because there won't be huge outliers</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lambda</span>, y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"Sampled values"</span><span class="op">)</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">data_sample2</span>,</span>
<span>                 bins <span class="op">=</span> <span class="fl">40</span>,</span>
<span>                 color <span class="op">=</span> <span class="st">"grey60"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, color <span class="op">=</span> <span class="st">"Actual density"</span><span class="op">)</span>,</span>
<span>                data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">data_sample2</span><span class="op">$</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                fun <span class="op">=</span> <span class="va">dgamma</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="va">alpha</span>, rate <span class="op">=</span> <span class="va">beta</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">100000</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="st">"grey40"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span>,</span>
<span>       color <span class="op">=</span> <span class="st">""</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">theme_swd</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-hist-lambda" class="quarto-figure quarto-figure-left anchored" width="50%">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-hist-lambda-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Histogram of generated sample values of λ
</figcaption><div aria-describedby="fig-hist-lambda-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="greaves_files/figure-html/fig-hist-lambda-1.png" class="img-fluid figure-img" style="width:50.0%">
</div>
</figure>
</div>
</div>
</div>
<p>The marginal densities appear to line up very well with the sampled values, which indicates the implemented dependent sampling schemes have generated random samples from their respective marginal distributions.</p>
<p>This is a property of Gibbs sampling. In effect, by taking very large random samples from the conditional posterior distributions, it appears as if the samples were taken from their respective marginal distributions. Thus, the generated random variates can be used to study the properties of the distribution of interest. With more complicated models, sampling from the marginal distributions directly would have been impossible; but with Gibbs sampling, it can be simulated. With these results in mind, we can formally state Gibbs sampling as:</p>
<p><em>The realization that as the number of iterations approaches infinity, the samples from the conditional posterior distributions converge to what the actual target distribution is that could not be sampled from directly.</em></p>
<p>Next, consider the following integral:</p>
<p><span class="math display">\[
f(x) = \int f(x \mid \lambda) f(\lambda)\,d\lambda.
\]</span></p>
<p>This states that the marginal distribution of <span class="math inline">\(X\)</span> can now be interpreted as the average of the conditional distribution of <span class="math inline">\(X\)</span> given <span class="math inline">\(\lambda\)</span> taken with respect to the marginal distribution of <span class="math inline">\(\lambda\)</span>. This fact suggests that an estimate for the actual value of <span class="math inline">\(f(x)\)</span> at the point <span class="math inline">\(x\)</span> may be obtained by taking the simulated average of <span class="math inline">\(f(x \mid \lambda)\)</span> over the sampled values of <span class="math inline">\(\lambda\)</span>, as shown in equation <a href="#eq-est-x" class="quarto-xref">Equation&nbsp;2</a>.</p>
<p><span id="eq-est-x"><span class="math display">\[
f(\hat{x}) = \frac{1}{99,500}\sum_{i=500}^{100,000}f(x \mid \lambda_i).
\tag{2}\]</span></span></p>
<p>A similar calculation can be done for <span class="math inline">\(\lambda\)</span>.</p>
<p><span class="math display">\[
f(\hat{\lambda}) = \frac{1}{99,500}\sum_{i=500}^{100,000}f(\lambda \mid x_i).
\]</span></p>
<p>After solving for and plotting these estimated densities, direct models of their respective target distribution are revealed. The next two figures show this relationship.</p>
<div class="cell" data-hash="greaves_cache/html/solve-est-densities-x1_9f6002c0ae0063359c4ea64a6e9b83aa">
<details><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># function to solve for density estimates</span></span>
<span><span class="va">estimate_density1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input_values</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">given_values</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">equation</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># calculate density estimate</span></span>
<span>  <span class="va">density_estimate</span> <span class="op">&lt;-</span> <span class="fu">equation</span><span class="op">(</span><span class="va">input_values</span>, <span class="va">given_values</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">colMeans</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># function to perform calculations for x</span></span>
<span><span class="va">density_x_given_lambda</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">Lambda</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># specify density equation</span></span>
<span>  <span class="va">Lambda</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">Lambda</span><span class="op">*</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># function to perform calculations for lambda</span></span>
<span><span class="va">density_lambda_given_x</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Lambda</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">X</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># specify density equation</span></span>
<span>  <span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">X</span> <span class="op">+</span> <span class="va">beta</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="va">alpha</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">Lambda</span><span class="op">^</span><span class="va">alpha</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">Lambda</span> <span class="op">*</span> <span class="op">(</span><span class="va">X</span> <span class="op">+</span> <span class="va">beta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">gamma</a></span><span class="op">(</span><span class="va">alpha</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># set max for plot and calculate points to estimate density of x at (if is to make sure step isn't zero)</span></span>
<span><span class="va">step_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">data_sample2</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">data_sample2</span><span class="op">$</span><span class="va">X</span>, <span class="fl">0.995</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">data_sample2</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">40</span>, <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">as.numeric</span>, <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set maximum for lambda plot</span></span>
<span><span class="va">limit_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">data_sample2</span><span class="op">$</span><span class="va">X</span>, <span class="fl">0.995</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create matrices of data to be used for x</span></span>
<span><span class="va">values_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">limit_x</span>, by <span class="op">=</span> <span class="va">step_x</span><span class="op">)</span></span>
<span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> , <span class="va">values_x</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data_sample2</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">values_x</span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Lambda1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_sample2</span><span class="op">$</span><span class="va">lambda</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data_sample2</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate density estimates for f(x)</span></span>
<span><span class="va">data_estimated_x</span> <span class="op">&lt;-</span> <span class="fu">estimate_density1</span><span class="op">(</span>input_values <span class="op">=</span> <span class="va">X1</span>, given_values <span class="op">=</span> <span class="va">Lambda1</span>, equation <span class="op">=</span> <span class="va">density_x_given_lambda</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">values_x</span>, f_x_hat <span class="op">=</span> <span class="va">.</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="greaves_cache/html/preview-estimated-x1_38517f9cdfd91f3a1ccc19c1262e3d74">
<div class="cell-output-display">
<table data-quarto-disable-processing="true" class="table table-hover" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;"> $x$ </th>
   <th style="text-align:right;"> $f\hat(x)$ </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:right;"> 0.000 </td>
   <td style="text-align:right;"> 0.510 </td>
  </tr>
<tr>
<td style="text-align:right;"> 0.408 </td>
   <td style="text-align:right;"> 0.400 </td>
  </tr>
<tr>
<td style="text-align:right;"> 0.817 </td>
   <td style="text-align:right;"> 0.316 </td>
  </tr>
<tr>
<td style="text-align:right;"> 1.225 </td>
   <td style="text-align:right;"> 0.252 </td>
  </tr>
<tr>
<td style="text-align:right;"> 1.633 </td>
   <td style="text-align:right;"> 0.203 </td>
  </tr>
<tr>
<td style="text-align:right;"> 2.041 </td>
   <td style="text-align:right;"> 0.164 </td>
  </tr>
<tr>
<td style="text-align:right;"> 2.450 </td>
   <td style="text-align:right;"> 0.134 </td>
  </tr>
<tr>
<td style="text-align:right;"> 2.858 </td>
   <td style="text-align:right;"> 0.110 </td>
  </tr>
<tr>
<td style="text-align:right;"> 3.266 </td>
   <td style="text-align:right;"> 0.091 </td>
  </tr>
<tr>
<td style="text-align:right;"> 3.675 </td>
   <td style="text-align:right;"> 0.076 </td>
  </tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="greaves_cache/html/solve-est-densities-lambda1_3d179d47df9dc258cf54328b566db348">
<details><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># set max for plot and  calculate points to estimate density of lambda at (if is to make sure step isn't zero)</span></span>
<span><span class="va">step_lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">data_sample2</span><span class="op">$</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">data_sample2</span><span class="op">$</span><span class="va">lambda</span>, <span class="fl">0.995</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">data_sample2</span><span class="op">$</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">40</span>, <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">as.numeric</span>, <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create matrices of data to be used for lambda</span></span>
<span><span class="va">values_lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">data_sample2</span><span class="op">$</span><span class="va">lambda</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">step_lambda</span><span class="op">)</span></span>
<span><span class="va">Lambda2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> , <span class="va">values_lambda</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data_sample2</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">values_lambda</span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">X2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_sample2</span><span class="op">$</span><span class="va">X</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data_sample2</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">Lambda2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate density estimates for f(lambda)</span></span>
<span><span class="va">data_estimated_lambda</span> <span class="op">&lt;-</span> <span class="fu">estimate_density1</span><span class="op">(</span>input_values <span class="op">=</span> <span class="va">Lambda2</span>, given_values <span class="op">=</span> <span class="va">X2</span>, <span class="va">density_lambda_given_x</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="va">values_lambda</span>, f_lambda_hat <span class="op">=</span> <span class="va">.</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="greaves_cache/html/preview-estimated-lambda1_dba5ce70010be63232370be3d2806ad9">
<div class="cell-output-display">
<table data-quarto-disable-processing="true" class="table table-hover" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;"> $\lambda$ </th>
   <th style="text-align:right;"> $f\hat(\lambda)$ </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:right;"> 0.000 </td>
   <td style="text-align:right;"> 0.000 </td>
  </tr>
<tr>
<td style="text-align:right;"> 0.027 </td>
   <td style="text-align:right;"> 0.001 </td>
  </tr>
<tr>
<td style="text-align:right;"> 0.053 </td>
   <td style="text-align:right;"> 0.014 </td>
  </tr>
<tr>
<td style="text-align:right;"> 0.080 </td>
   <td style="text-align:right;"> 0.063 </td>
  </tr>
<tr>
<td style="text-align:right;"> 0.107 </td>
   <td style="text-align:right;"> 0.165 </td>
  </tr>
<tr>
<td style="text-align:right;"> 0.134 </td>
   <td style="text-align:right;"> 0.322 </td>
  </tr>
<tr>
<td style="text-align:right;"> 0.160 </td>
   <td style="text-align:right;"> 0.523 </td>
  </tr>
<tr>
<td style="text-align:right;"> 0.187 </td>
   <td style="text-align:right;"> 0.753 </td>
  </tr>
<tr>
<td style="text-align:right;"> 0.214 </td>
   <td style="text-align:right;"> 0.993 </td>
  </tr>
<tr>
<td style="text-align:right;"> 0.241 </td>
   <td style="text-align:right;"> 1.227 </td>
  </tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="greaves_cache/html/fig-est-density-x1_986fd90ef8a49aaa954e8fd8c10207bd">
<details><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># X plot</span></span>
<span><span class="co"># -&gt; density estimates with marginal density curve overlaid</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">f_x_hat</span>, fill <span class="op">=</span> <span class="st">"Estimated density"</span><span class="op">)</span>,</span>
<span>             data <span class="op">=</span> <span class="va">data_estimated_x</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>, shape <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span> <span class="fl">2</span>, stroke <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, color <span class="op">=</span> <span class="st">"Actual density"</span><span class="op">)</span>,</span>
<span>                fun <span class="op">=</span> <span class="va">dpareto2</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>min <span class="op">=</span> <span class="fl">0</span>, shape <span class="op">=</span> <span class="va">alpha</span>, scale <span class="op">=</span> <span class="va">beta</span><span class="op">)</span>,</span>
<span>                data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">limit_x</span><span class="op">)</span><span class="op">)</span>,n <span class="op">=</span> <span class="fl">100000</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">limit_x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="st">"grey60"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>       y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">hat</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       color <span class="op">=</span> <span class="st">""</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">theme_swd</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-est-density-x1" class="quarto-figure quarto-figure-left anchored" width="50%">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-est-density-x1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Estimated and actual density of X
</figcaption><div aria-describedby="fig-est-density-x1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="greaves_files/figure-html/fig-est-density-x1-1.png" class="img-fluid figure-img" style="width:50.0%">
</div>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="greaves_cache/html/fig-est-density-lambda_2c6944bd3bb0576b38d3236d42e96b02">
<details><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Lambda plot</span></span>
<span><span class="co"># -&gt; density estimates with marginal density curve overlaid</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lambda</span>, y <span class="op">=</span> <span class="va">f_lambda_hat</span>, fill <span class="op">=</span> <span class="st">"Estimated density"</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>, shape <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span> <span class="fl">2</span>, stroke <span class="op">=</span> <span class="fl">1</span>,</span>
<span>             data <span class="op">=</span> <span class="va">data_estimated_lambda</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, color <span class="op">=</span> <span class="st">"Actual density"</span><span class="op">)</span>,</span>
<span>                fun <span class="op">=</span> <span class="va">dgamma</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="va">alpha</span>, rate <span class="op">=</span> <span class="va">beta</span><span class="op">)</span>,</span>
<span>                data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">data_sample2</span><span class="op">$</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                n <span class="op">=</span> <span class="fl">100000</span>, size <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="st">"grey60"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span>,</span>
<span>       y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">hat</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       color <span class="op">=</span> <span class="st">""</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">theme_swd</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-est-density-lambda" class="quarto-figure quarto-figure-left anchored" width="50%">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-est-density-lambda-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Estimated and actual density of λ
</figcaption><div aria-describedby="fig-est-density-lambda-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="greaves_files/figure-html/fig-est-density-lambda-1.png" class="img-fluid figure-img" style="width:50.0%">
</div>
</figure>
</div>
</div>
</div>
<p><a href="#fig-est-density-x1" class="quarto-xref">Figure&nbsp;5</a> shows the plotted points of <span class="math inline">\(f(\hat{x})\)</span> with its known function <span class="math inline">\(f(x)\)</span> overlaid. <a href="#fig-est-density-lambda" class="quarto-xref">Figure&nbsp;6</a> shows the same information except for <span class="math inline">\(\lambda\)</span>. As one can see on both figures, the estimated densities happen to be excellent representations of the actual densities. If looking at a more complicated model where the target distribution cannot be solved for in closed form, there is now methods to solve for and study a random sample from an unknown distribution.</p>
</section><section id="modeling-number-of-claims" class="level3" data-number="2.2"><h3 data-number="2.2" class="anchored" data-anchor-id="modeling-number-of-claims">
<span class="header-section-number">2.2</span> Modeling Number of Claims</h3>
<p>Actuaries often try to model the number of claims to be filed for a certain book of business. These books contain many individual policies, each with similar risk characteristics. These characteristics contribute to the probability that a claim is filed. Therefore, each book of business, which we will refer to as a portfolio, contains many policies that have a similar probability of filing a claim. This is done to allow for analyses to be completed on the group as a whole, rather than on each individual policy.</p>
<p>In order to model the number of claims for a portfolio, let claim probability <span class="math inline">\(P\)</span> (as a random variable) follow a beta distribution with parameters <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>.</p>
<p><span class="math display">\[
f(p) = \frac{\Gamma(\alpha+\beta)}{\Gamma(\alpha) \Gamma(\beta)} p^{\alpha-1} (1-p)^{\beta-1},\hspace{10pt} 0 \le p \le 1.
\]</span></p>
<p>It is a common practice to model claim probability <span class="math inline">\(P\)</span> with a beta distribution, where the values are bounded between zero and one. In practice, distributions for probabilities of filing a claim (<span class="math inline">\(P\)</span>) are skewed to the right allowing higher chances for smaller <span class="math inline">\(P\)</span>’s and increasingly lower chances for higher <span class="math inline">\(P\)</span>’s. The skewness of the beta distribution can easily be controlled with correctly chosen parameters <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>. Next, we have to model the number of policies within a certain portfolio. To do this, the Poisson distribution is widely used. However, we are going to modify it slightly. By truncating the random variable at zero (zero truncated Poisson distribution), we can ensure that the portfolio has at least one policy. Now, the total number of policies within a portfolio <span class="math inline">\(N\)</span> can be written as</p>
<p><span class="math display">\[
\begin{align*}
f(n) &amp;= \frac{P(N=n\mid N&gt;0)}{1-P(N=0)}\nonumber\\
&amp;= (e^{-\lambda}-1) \frac{\lambda^n}{n!},\hspace{10pt} n=1,2,3,\ldots.
\end{align*}
\]</span></p>
<p>Next, let’s focus on the number of policies that file a claim. Assuming that filing a claim for a policy is independent and that the probability of filing a claim is constant throughout the lifetime of the policy, the number of policies that file a claim <span class="math inline">\(X\)</span> can be modeled using a binomial distribution with parameters <span class="math inline">\(N\)</span> and <span class="math inline">\(P\)</span>. Thus, we have</p>
<p><span id="eq-conditional-x-given-np"><span class="math display">\[
f(x \mid p,n) = \binom nx p^x (1-p)^{n-x},\hspace{10pt} x = 0,1,2,\ldots,n.
\tag{3}\]</span></span></p>
<p>This is a well chosen distribution as it incorporates both of our previous random variates as parameters. It follows that the random variable <span class="math inline">\(X\)</span> can now be interpreted as the number of policies that generate a claim in a portfolio of <span class="math inline">\(N\)</span> identical and independent policies, each with a claim probability equal to <span class="math inline">\(P\)</span>. Most often actuaries are less interested in the conditional distribution of the variable of interest, but rather the marginal distribution. This is because the marginal distribution of our random variate <span class="math inline">\(X\)</span> describes the typical number of policies generating a claim within an arbitrary portfolio; this is much more informative for them. However, <span class="math inline">\(f(x)\)</span> cannot be obtained in closed form in this particular model. Gibbs sampling is one possible solution for this problem.</p>
<p>As shown earlier, the first step of Gibbs sampling is to find the conditional distributions of each random variable. These are derived as follows:</p>
<p><span class="math display">\[
\begin{align*}
f(x,p,n) &amp;= f(x\mid p,n) f(p) f(n)\\
&amp;= \frac{\binom nx p^{x+\alpha-1} (1-p)^{n+\beta-x-1} \Gamma(\alpha+\beta) \lambda^n}{\Gamma(\alpha) \Gamma(\beta) (e^\lambda-1)n!}
\end{align*}
\]</span></p>
<p><span class="math display">\[
\begin{align*}
f(x,n) &amp;= \int_0^1\ f(x,p,n)\,dp\\
&amp;= \frac{\Gamma(\alpha+\beta) \lambda^n \binom nx \Gamma(x+\alpha) \Gamma(n+\beta-x)}{\Gamma(\alpha) \Gamma(\beta) n! (e^\lambda-1) \Gamma(n+\alpha+\beta)}
\end{align*}
\]</span></p>
<p><span id="eq-conditional-p-given-xn"><span class="math display">\[
\begin{align*}
f(p\mid x,n) &amp;= \frac{f(x,p,n)}{f(x,n)}\\
&amp;= \frac{\Gamma(n+\alpha+\beta)}{\Gamma(x+\alpha) \Gamma(n+\beta-x)} p^{(x+\alpha)-1} (1-p)^{(n+\beta-x)-1}\\
&amp;\sim \text{beta}\,(x+\alpha, n+\beta-x)
\end{align*}
\tag{4}\]</span></span></p>
<p><span class="math display">\[
\begin{align*}
f(x,p) &amp;= \sum_{n=1}^\infty f(x,p,n)\\
&amp;= \frac{p^{x+\alpha-1} \Gamma(\alpha+\beta) p^{\beta-1} \lambda^x (e^\lambda-1) \Gamma(\alpha) \Gamma(\beta) x! e^{\lambda(1-p)}}{\Gamma(\alpha) \Gamma(\beta) (e^\lambda-1) n!}
\end{align*}
\]</span></p>
<p><span id="eq-conditional-n-given-xp"><span class="math display">\[
\begin{align*}
f(n\mid x,p) &amp;= \frac{f(x,p,n)}{f(x,p)}\\
&amp;= \frac{e^{-\lambda(1-p)} (\lambda(1-p))^{n-x}}{(n-x)!}\hspace{10pt}n = x,x+1,x+2,\ldots\\
&amp;\sim \text{Poisson}\,(\lambda(1-p)).
\end{align*}
\tag{5}\]</span></span></p>
<p>Note that the distribution <span class="math inline">\(f(p\mid x,n)\)</span> follows a beta distribution with parameters <span class="math inline">\(x+\alpha\)</span> and <span class="math inline">\(n+\beta-x\)</span>, as shown in equation <a href="#eq-conditional-p-given-xn" class="quarto-xref">Equation&nbsp;4</a>. Additionally, the conditional distribution of <span class="math inline">\(N\)</span> follows a Poisson distribution with parameter <span class="math inline">\(\lambda(1-p)\)</span>, which is shown in equation <a href="#eq-conditional-n-given-xp" class="quarto-xref">Equation&nbsp;5</a>. In order to implement Gibbs sampling, we simply need to initialize the variables. For the purposes of illustration, we select <span class="math inline">\(\alpha = 2\)</span> (weight on <span class="math inline">\(p\)</span>) and <span class="math inline">\(\beta = 8\)</span> (weight on <span class="math inline">\(1-p\)</span>). This makes the distribution in equation <a href="#eq-conditional-p-given-xn" class="quarto-xref">Equation&nbsp;4</a> right skewed. Furthermore, we assume the average number of policies within a portfolio is 12 (<span class="math inline">\(\lambda = 12\)</span>). Next, we run a loop to generate <span class="math inline">\(10,000\)</span> random numbers from each of the full conditional distributions. We then discard the first <span class="math inline">\(500\)</span> values of each sampling path in order to burn-in Gibbs sampling.</p>
<!-- NOTE: overwriting previous functions and objects, just chuck labels need to be different -->
<div class="cell" data-hash="greaves_cache/html/generate-data2_36c511103eafb9cd3f971729a8e8aef7">
<details><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># function to generate random data from conditional distributions</span></span>
<span><span class="va">generate_sample</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">k</span> <span class="op">=</span> <span class="fl">10000</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">beta</span> <span class="op">=</span> <span class="fl">8</span>, <span class="va">lambda</span> <span class="op">=</span> <span class="fl">12</span>, </span>
<span>                            <span class="va">start_x</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">start_p</span> <span class="op">=</span> <span class="fl">0.5</span>, <span class="va">start_n</span> <span class="op">=</span> <span class="fl">15</span>, <span class="va">seed</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># create matrix</span></span>
<span>  <span class="va">data_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">k</span>, ncol <span class="op">=</span> <span class="fl">4</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"iteration"</span>, <span class="st">"X"</span>, <span class="st">"p"</span>, <span class="st">"n"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># conditionally set random seed</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">seed</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># initialize counter and starting values</span></span>
<span>  <span class="va">i</span> <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="va">data_sample</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">start_x</span>, <span class="va">start_p</span>, <span class="va">start_n</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># generate new data for x, p and n based on sequentially updated conditional distributions</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="va">i</span> <span class="op">&lt;</span> <span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co"># record iteration</span></span>
<span>    <span class="va">data_sample</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, <span class="st">"iteration"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    </span>
<span>    <span class="co"># sample from x | p , n</span></span>
<span>    <span class="va">data_sample</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, <span class="st">"X"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="va">data_sample</span><span class="op">[</span><span class="va">i</span>, <span class="st">"n"</span><span class="op">]</span>, prob <span class="op">=</span> <span class="va">data_sample</span><span class="op">[</span><span class="va">i</span>, <span class="st">"p"</span><span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># sample from p | x , n</span></span>
<span>    <span class="va">data_sample</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, <span class="st">"p"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, shape1 <span class="op">=</span> <span class="va">data_sample</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, <span class="st">"X"</span><span class="op">]</span> <span class="op">+</span> <span class="va">alpha</span>, shape2 <span class="op">=</span> <span class="va">data_sample</span><span class="op">[</span><span class="va">i</span>, <span class="st">"n"</span><span class="op">]</span> <span class="op">+</span> <span class="va">beta</span> <span class="op">-</span> <span class="va">data_sample</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, <span class="st">"X"</span><span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># sample from n - x | x , p and then calculate final n = (n - x) + x</span></span>
<span>    <span class="va">data_sample</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, <span class="st">"n"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, lambda <span class="op">=</span> <span class="va">lambda</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">data_sample</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, <span class="st">"p"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">data_sample</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>, <span class="st">"X"</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="co"># increase counter</span></span>
<span>    <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">data_sample</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># initialize items</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span><span class="va">start_x</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">start_p</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">start_n</span> <span class="op">&lt;-</span> <span class="fl">15</span></span>
<span></span>
<span><span class="co"># sample from conditional distributions</span></span>
<span><span class="va">data_sample</span> <span class="op">&lt;-</span> <span class="fu">generate_sample</span><span class="op">(</span>k <span class="op">=</span> <span class="va">k</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, beta <span class="op">=</span> <span class="va">beta</span>, lambda <span class="op">=</span> <span class="va">lambda</span>, start_x <span class="op">=</span> <span class="va">start_x</span>, start_p <span class="op">=</span> <span class="va">start_p</span>, start_n <span class="op">=</span> <span class="va">start_n</span>, seed <span class="op">=</span> <span class="va">seed</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set number of burn-in iterations</span></span>
<span><span class="va">burn_in</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span></span>
<span><span class="co"># remove burn-in iteration</span></span>
<span><span class="va">data_sample2</span> <span class="op">&lt;-</span> <span class="va">data_sample</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="va">data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">iteration</span> <span class="op">&gt;</span> <span class="va">burn_in</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="greaves_cache/html/preview-sample2_f7aeaf8e1f70d81392d8970052c0f4be">
<div class="cell-output-display">
<table data-quarto-disable-processing="true" class="table table-hover" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;"> Iteration </th>
   <th style="text-align:right;"> $X$ </th>
   <th style="text-align:right;"> $N$ </th>
   <th style="text-align:right;"> $P$ </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:right;"> 101 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.036 </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
<tr>
<td style="text-align:right;"> 102 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.114 </td>
   <td style="text-align:right;"> 11 </td>
  </tr>
<tr>
<td style="text-align:right;"> 103 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.119 </td>
   <td style="text-align:right;"> 11 </td>
  </tr>
<tr>
<td style="text-align:right;"> 104 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.037 </td>
   <td style="text-align:right;"> 7 </td>
  </tr>
<tr>
<td style="text-align:right;"> 105 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.165 </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
<tr>
<td style="text-align:right;"> 106 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0.077 </td>
   <td style="text-align:right;"> 13 </td>
  </tr>
<tr>
<td style="text-align:right;"> 107 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.191 </td>
   <td style="text-align:right;"> 14 </td>
  </tr>
<tr>
<td style="text-align:right;"> 108 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0.125 </td>
   <td style="text-align:right;"> 12 </td>
  </tr>
<tr>
<td style="text-align:right;"> 109 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0.199 </td>
   <td style="text-align:right;"> 14 </td>
  </tr>
<tr>
<td style="text-align:right;"> 110 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 0.280 </td>
   <td style="text-align:right;"> 16 </td>
  </tr>
</tbody>
</table>
</div>
</div>
<p>The output of this simulation is an approximately independent random sample from each of the conditional distributions <span class="math inline">\(f(n \mid x,p)\)</span>, <span class="math inline">\(f(p \mid x, n)\)</span>, and <span class="math inline">\(f(x \mid p, n)\)</span>. We are interested in studying the distribution of <span class="math inline">\(f(x)\)</span>, which as noted earlier could not be found in closed form. However, by averaging equation <a href="#eq-conditional-x-given-np" class="quarto-xref">Equation&nbsp;3</a> over the simulated values <span class="math inline">\(P^{(i)}\)</span> and <span class="math inline">\(N^{(i)}\)</span>, a density estimate for the random variable <span class="math inline">\(X\)</span> can be obtained. In other words, the estimated value of the density of <span class="math inline">\(f(x)\)</span> at the point <span class="math inline">\(x\)</span> is given by</p>
<p><span class="math display">\[
f(\hat{x})=\frac{1}{9,500}\sum_{i=501}^{10,000}f(x\mid p^{(i)},n^{(i)}).
\]</span></p>
<div class="cell" data-hash="greaves_cache/html/solve-est-density2_451db9c7e0f85306e031d8ee6b90e185">
<details><summary>Code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># function to solve for density estimates</span></span>
<span><span class="va">estimate_density</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input_values</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">given_values1</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">given_values2</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">equation</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># calculate density estimate</span></span>
<span>  <span class="va">density_estimate</span> <span class="op">=</span> <span class="fu">equation</span><span class="op">(</span><span class="va">input_values</span>, <span class="va">given_values1</span>, <span class="va">given_values2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">colMeans</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># function to perform calculations for x</span></span>
<span><span class="co"># -&gt; x is technically a pmf</span></span>
<span><span class="va">density_x_given_p_and_n</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">P</span> <span class="op">=</span> <span class="fl">0.5</span>, <span class="va">N</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># specify density equation</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Special.html">choose</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">X</span><span class="op">)</span> <span class="op">*</span> <span class="va">P</span><span class="op">^</span><span class="va">X</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">P</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="va">N</span> <span class="op">-</span> <span class="va">X</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># determine step size for x values</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">data_sample2</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">75</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">step</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">step</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># create matrices of data to be used for x</span></span>
<span><span class="va">values_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">data_sample2</span><span class="op">$</span><span class="va">X</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">step</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> , <span class="va">values_x</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data_sample2</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">values_x</span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_sample2</span><span class="op">$</span><span class="va">p</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data_sample2</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_sample2</span><span class="op">$</span><span class="va">n</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data_sample2</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate density estimates for f(x) and scale so that probabilities sum to one</span></span>
<span><span class="co"># -&gt; with a step of 1, it is always super close to 1</span></span>
<span><span class="co"># --&gt; but if use a different step size, need to scale probabilities</span></span>
<span><span class="va">data_estimated_x</span> <span class="op">&lt;-</span> <span class="fu">estimate_density</span><span class="op">(</span>input_values <span class="op">=</span> <span class="va">X</span>, given_values1 <span class="op">=</span> <span class="va">P</span>, given_values2 <span class="op">=</span> <span class="va">N</span>, equation <span class="op">=</span> <span class="va">density_x_given_p_and_n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">values_x</span>, f_x_hat <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>f_x_hat <span class="op">=</span> <span class="va">f_x_hat</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">f_x_hat</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="greaves_cache/html/preview-estimated-x2_bfeeae7fd73339e9092e003116095d06">
<div class="cell-output-display">
<table data-quarto-disable-processing="true" class="table table-hover" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;"> $x$ </th>
   <th style="text-align:right;"> $f\hat(x)$ </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.187 </td>
  </tr>
<tr>
<td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.223 </td>
  </tr>
<tr>
<td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0.192 </td>
  </tr>
<tr>
<td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0.144 </td>
  </tr>
<tr>
<td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 0.100 </td>
  </tr>
<tr>
<td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 0.064 </td>
  </tr>
<tr>
<td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 0.039 </td>
  </tr>
<tr>
<td style="text-align:right;"> 7 </td>
   <td style="text-align:right;"> 0.023 </td>
  </tr>
<tr>
<td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 0.013 </td>
  </tr>
<tr>
<td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 0.007 </td>
  </tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="greaves_cache/html/fig-est-density-x2_30deec201785375844f76d56721f818a">
<details><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># function to calculate mean of discrete probability distribution</span></span>
<span><span class="va">calc_mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">p_x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="va">p_x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># function to calculate variance of discrete probability distribution</span></span>
<span><span class="va">calc_var</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">p_x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># calculate mean</span></span>
<span>  <span class="va">mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="va">p_x</span><span class="op">)</span></span>
<span>  <span class="co"># calculate variance</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">mean</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="va">p_x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># calculate mean</span></span>
<span><span class="va">x_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu">calc_mean</span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_estimated_x</span><span class="op">$</span><span class="va">x</span>, p_x <span class="op">=</span> <span class="va">data_estimated_x</span><span class="op">$</span><span class="va">f_x_hat</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate variance</span></span>
<span><span class="va">x_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu">calc_var</span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_estimated_x</span><span class="op">$</span><span class="va">x</span>, p_x <span class="op">=</span> <span class="va">data_estimated_x</span><span class="op">$</span><span class="va">f_x_hat</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># X plot</span></span>
<span><span class="co"># -&gt; density estimates with marginal density curve overlaid</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">f_x_hat</span>, fill <span class="op">=</span> <span class="st">"Estimated density"</span><span class="op">)</span>,</span>
<span>             data <span class="op">=</span> <span class="va">data_estimated_x</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>, shape <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span> <span class="fl">2</span>, stroke <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, ymax <span class="op">=</span> <span class="va">f_x_hat</span><span class="op">)</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">data_estimated_x</span>,</span>
<span>                 ymin <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>,</span>
<span>           label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"mean = "</span>, <span class="va">x_mean</span>, <span class="st">"\nvar = "</span>, <span class="va">x_var</span><span class="op">)</span>,</span>
<span>           x <span class="op">=</span> <span class="cn">Inf</span>, y <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>           hjust <span class="op">=</span> <span class="fl">1</span>, vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>       y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">hat</a></span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">theme_swd</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-est-density-x2" class="quarto-figure quarto-figure-left anchored" width="50%">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-est-density-x2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Estimated density of X
</figcaption><div aria-describedby="fig-est-density-x2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="greaves_files/figure-html/fig-est-density-x2-1.png" class="img-fluid figure-img" style="width:50.0%">
</div>
</figure>
</div>
</div>
</div>
<p>A plot of this density estimate appears in …. From this, actuaries can compute many statistics for a portfolio with parameters <span class="math inline">\(p\)</span> and <span class="math inline">\(n\)</span>. These can then be used to more accurately predict the number of claims expected for the future. For example, the expected value of <span class="math inline">\(X\)</span> can be found; in this case, <span class="math inline">\(E(X)\)</span> = 2.402 claims. Combined with a model of the size of a typical claim, this statistic can tell an insurer the amount of loss they expect per policy (in dollars). Another statistic that can be found is the variance of <span class="math inline">\(X\)</span>. This tells the average risk of each portfolio. If a group of policies has a large variance, then there could potentially be a large number of claims. This implies a higher risk, which means this particular group of policies likely will have a higher premium. For this model, <span class="math inline">\(Var(X)\)</span> = 4.521.</p>
</section><section id="modeling-size-of-claim" class="level3" data-number="2.3"><h3 data-number="2.3" class="anchored" data-anchor-id="modeling-size-of-claim">
<span class="header-section-number">2.3</span> Modeling Size of Claim</h3>
<p>In contrast to the previous model, which dealt with the number of claims, this one deals with the size of claims (i.e.&nbsp;loss amounts). Loss distributions have high probabilities for lower values and a long tail to allow for large claims, however with an increasingly smaller probability. A widely used distribution to model loss is the Pareto distribution. It incorporates parameters <span class="math inline">\(\lambda\)</span> and <span class="math inline">\(\theta\)</span> and has the following density function:</p>
<p><span class="math display">\[
f(x \mid \theta) = \frac{\theta \lambda^\theta}{(\lambda+x)^{\theta+1}}, \hspace{10pt} x &gt; 0.
\]</span></p>
<p>Note that this distribution is a variation of the Pareto distribution called a Lomax distribution. It is essentially the same, however it has been shifted so that the support set begins at zero. To simplify the presentation, we assume that the parameter <span class="math inline">\(\lambda\)</span> is known to be 7,000 so that the only uncertainty is with respect to the value of the parameter <span class="math inline">\(\theta\)</span>. Therefore, the prior distribution, represented as <span class="math inline">\(\theta\)</span>, follows a gamma distribution with parameters <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>. In order to make further inference, again Gibbs sampling can be implemented. However, here we are considering a somewhat different situation: assume a total of 50 independent observations are available, but we only know the class frequencies (<a href="#tbl-grouped-data" class="quarto-xref">Table&nbsp;1</a>).</p>
<div id="tbl-grouped-data" class="anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="table quarto-float-caption quarto-float-tbl" id="tbl-grouped-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Grouped data
</figcaption><div aria-describedby="tbl-grouped-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<thead><tr class="header">
<th>Class</th>
<th>Frequency</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>0 – 1000</td>
<td>25</td>
</tr>
<tr class="even">
<td>1000 – 2000</td>
<td>15</td>
</tr>
<tr class="odd">
<td>2000 – 3000</td>
<td>7</td>
</tr>
<tr class="even">
<td>3000 – <span class="math inline">\(\infty\)</span>
</td>
<td>3</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>If the original observations (losses) were given, the likelihood function <span class="math inline">\(L(\theta\mid observations)\)</span> can be written as</p>
<p><span class="math display">\[
L(\theta\mid observations) \propto \frac{\theta^{50}\lambda^{50\theta}}{\prod_{i=1}^{50}(\lambda+x_i)^{\theta+1}}
\]</span></p>
<p>Combining this likelihood function with the conjugate gamma <span class="math inline">\((\alpha,\beta)\)</span> prior density for <span class="math inline">\(\theta\)</span> results in the following posterior density:</p>
<p><span id="eq-conditional-theta-given-obs"><span class="math display">\[
\begin{align*}
f(\theta \mid \text{observations}) &amp;\propto L(\theta) f(\theta)\\
&amp;\propto \frac{\theta^{50}\lambda^{50 \theta}}{\prod_{i=1}^{50}(\lambda+x_i)^{\theta+1}} \frac{\beta^{\alpha}}{\Gamma(\alpha)} \theta^{\alpha-1} e^{-\beta\theta}\\
&amp;\propto \theta^{49+\alpha} e^{-\theta(\beta-50 \ln\lambda+\sum_{i=1}^{50}\ln(\lambda+x_i))}\\
&amp;\sim \text{gamma}\,(50+\alpha, \beta-50\ln(\lambda)+\sum_{i=1}^{50}\ln(\lambda+x_i)).
\end{align*}
\tag{6}\]</span></span></p>
<!-- NOTE: (just about) everything in the code is dynamic for sample size (n), but they are hard coded in the tables -->
<p>Note that the conditional distribution of <span class="math inline">\(\theta\)</span> once again follows a gamma distribution, this time with parameters <span class="math inline">\(50+\alpha\)</span> and <span class="math inline">\(\beta-50 \ln\lambda+\sum_{i=1}^{50}\ln(\lambda+x_i)\)</span>, as shown in equation <a href="#eq-conditional-theta-given-obs" class="quarto-xref">Equation&nbsp;6</a>; this is because of the conjugate nature of the gamma/Pareto distributions. Now, assume <span class="math inline">\(\alpha = 1\)</span> and <span class="math inline">\(\beta = 0.1\)</span>. This produces a large variance in the prior distribution. These values form a vague/uninformative prior which reflects the relative ignorance of the prior distribution. While this approach is common, the practitioner should adopt whatever form of the prior density that describes the prior information actually available. Next, a procedure called data augmentation is utilized on the grouped data in order to study individual losses. The augmented data values are all independently distributed given the model parameters and each is distributed according to the Pareto density function. However, they are restricted to the appropriate class interval. Thus, the conditional distribution of the augmented data given the model parameters and the observed class frequencies is described by the following set of truncated Pareto distributions:</p>
<p><span id="eq-trunc-paretos"><span class="math display">\[
\begin{align*}
x_i &amp;\sim\text{truncated }Pareto\,(\theta, \lambda)\text{ on the interval }(0, 1000] ]\text{ for } i = 1,2,\ldots,25\\
x_i &amp;\sim\text{truncated }Pareto\,(\theta, \lambda)\text{ on the interval } (1000, 2000] \text{ for } i = 26,27,\ldots,40\\
x_i &amp;\sim\text{truncated }Pareto\,(\theta, \lambda)\text{ on the interval } (2000,  3000] \text{ for } i=41,42,\ldots,47\\
x_i &amp;\sim\text{truncated }Pareto\,(\theta, \lambda)\text{ on the interval } (3000, \infty) \text{ for } i = 48,49,50.
\end{align*}
\tag{7}\]</span></span></p>
<p>By applying Gibbs sampling to the 1001 full conditional distributions defined by equations <a href="#eq-conditional-theta-given-obs" class="quarto-xref">Equation&nbsp;6</a> and <a href="#eq-trunc-paretos" class="quarto-xref">Equation&nbsp;7</a>, a Markov chain with an invariant distribution equal to <span class="math inline">\(P(\theta, \text{augmented data} \mid \text{observed data})\)</span> can be simulated. In order to make the posterior inference with respect to <span class="math inline">\(\theta\)</span>, the parameter of interest, <span class="math inline">\(10000\)</span> replications of this Markov chain are generated. Randomly selected starting values for <span class="math inline">\(\theta\)</span> and the augmented data are used each time.</p>
<div class="cell" data-hash="greaves_cache/html/generate_data3_659c8fc8ac692ff7bbb4134d86ec2f04">
<details><summary>Code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># function to generate random data from conditional distributions</span></span>
<span><span class="va">generate_sample</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">k</span> <span class="op">=</span> <span class="fl">10000</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">50</span>, <span class="va">lambda</span> <span class="op">=</span> <span class="fl">7000</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">beta</span> <span class="op">=</span> <span class="fl">0.1</span>, <span class="va">start_theta</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">seed</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># create matrix</span></span>
<span>  <span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">n</span>, ncol <span class="op">=</span> <span class="va">k</span><span class="op">)</span></span>
<span>  <span class="va">theta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">start_theta</span>, nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="va">k</span><span class="op">)</span></span>
<span>  <span class="va">total</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="va">k</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># conditionally set random seed</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">seed</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># loop to generate new x's and theta's</span></span>
<span>  <span class="va">i</span> <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="va">i</span> <span class="op">&lt;=</span> <span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>    <span class="co"># generate x | theta based on truncated distribution</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">j</span> <span class="op">&lt;=</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">x</span><span class="op">[</span><span class="va">j</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/truncdist/man/rtrunc.html">rtrunc</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, a <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">1000</span>, spec <span class="op">=</span> <span class="st">"pareto2"</span>, min <span class="op">=</span> <span class="fl">0</span>, shape <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, scale <span class="op">=</span> <span class="va">lambda</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">j</span> <span class="op">&lt;=</span> <span class="fl">0.8</span><span class="op">*</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">x</span><span class="op">[</span><span class="va">j</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/truncdist/man/rtrunc.html">rtrunc</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, a <span class="op">=</span> <span class="fl">1000</span>, b <span class="op">=</span> <span class="fl">2000</span>, spec <span class="op">=</span> <span class="st">"pareto2"</span>, min <span class="op">=</span> <span class="fl">1000</span>, shape <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, scale <span class="op">=</span> <span class="va">lambda</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">j</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fl">0.94</span><span class="op">*</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">x</span><span class="op">[</span><span class="va">j</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/truncdist/man/rtrunc.html">rtrunc</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, a <span class="op">=</span> <span class="fl">2000</span>, b <span class="op">=</span> <span class="fl">3000</span>, spec <span class="op">=</span> <span class="st">"pareto2"</span>, min <span class="op">=</span> <span class="fl">2000</span>, shape <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, scale <span class="op">=</span> <span class="va">lambda</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">x</span><span class="op">[</span><span class="va">j</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/truncdist/man/rtrunc.html">rtrunc</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, a <span class="op">=</span> <span class="fl">3000</span>, b <span class="op">=</span> <span class="cn">Inf</span>, spec <span class="op">=</span> <span class="st">"pareto2"</span>, min <span class="op">=</span> <span class="fl">3000</span>, shape <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, scale <span class="op">=</span> <span class="va">lambda</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co"># calculate total</span></span>
<span>    <span class="va">total</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">+</span><span class="va">x</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># generate a theta | x</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="va">k</span><span class="op">)</span></span>
<span>      <span class="kw">break</span></span>
<span>    <span class="kw">else</span> </span>
<span>      <span class="va">theta</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="fl">1</span>, shape <span class="op">=</span> <span class="fl">50</span><span class="op">+</span><span class="va">alpha</span>, rate <span class="op">=</span> <span class="va">beta</span><span class="op">-</span><span class="fl">50</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">+</span><span class="va">total</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># increase counter by 1</span></span>
<span>    <span class="va">i</span> <span class="op">=</span> <span class="va">i</span><span class="op">+</span><span class="fl">1</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>    </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, theta <span class="op">=</span> <span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span>  </span>
<span><span class="co"># initialize items</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">100000</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">7000</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span></span>
<span><span class="co"># sample from conditional distributions</span></span>
<span><span class="va">data_sample</span> <span class="op">&lt;-</span> <span class="fu">generate_sample</span><span class="op">(</span>k <span class="op">=</span> <span class="va">k</span>, n <span class="op">=</span> <span class="va">n</span>, lambda <span class="op">=</span> <span class="va">lambda</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, beta <span class="op">=</span> <span class="va">beta</span>, start_theta <span class="op">=</span> <span class="fl">5</span>, seed <span class="op">=</span> <span class="va">seed</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="greaves_cache/html/preview-sample3_e17c0a9ad8be7277bf02a433767b1279">
<div class="cell-output-display">
<table data-quarto-disable-processing="true" class="table table-hover" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;"> X1 </th>
   <th style="text-align:right;"> X2 </th>
   <th style="text-align:right;"> X3 </th>
   <th style="text-align:right;"> X4 </th>
   <th style="text-align:right;"> X5 </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:right;"> 293.149 </td>
   <td style="text-align:right;"> 28.754 </td>
   <td style="text-align:right;"> 696.792 </td>
   <td style="text-align:right;"> 15.045 </td>
   <td style="text-align:right;"> 752.232 </td>
  </tr>
<tr>
<td style="text-align:right;"> 44.388 </td>
   <td style="text-align:right;"> 768.985 </td>
   <td style="text-align:right;"> 877.523 </td>
   <td style="text-align:right;"> 455.443 </td>
   <td style="text-align:right;"> 646.416 </td>
  </tr>
<tr>
<td style="text-align:right;"> 379.133 </td>
   <td style="text-align:right;"> 63.357 </td>
   <td style="text-align:right;"> 40.781 </td>
   <td style="text-align:right;"> 323.106 </td>
   <td style="text-align:right;"> 173.086 </td>
  </tr>
<tr>
<td style="text-align:right;"> 923.996 </td>
   <td style="text-align:right;"> 709.768 </td>
   <td style="text-align:right;"> 17.401 </td>
   <td style="text-align:right;"> 174.121 </td>
   <td style="text-align:right;"> 136.311 </td>
  </tr>
<tr>
<td style="text-align:right;"> 236.406 </td>
   <td style="text-align:right;"> 14.865 </td>
   <td style="text-align:right;"> 862.763 </td>
   <td style="text-align:right;"> 852.098 </td>
   <td style="text-align:right;"> 187.093 </td>
  </tr>
<tr>
<td style="text-align:right;"> 310.762 </td>
   <td style="text-align:right;"> 154.967 </td>
   <td style="text-align:right;"> 627.174 </td>
   <td style="text-align:right;"> 824.034 </td>
   <td style="text-align:right;"> 363.562 </td>
  </tr>
<tr>
<td style="text-align:right;"> 157.924 </td>
   <td style="text-align:right;"> 19.983 </td>
   <td style="text-align:right;"> 354.000 </td>
   <td style="text-align:right;"> 714.257 </td>
   <td style="text-align:right;"> 501.888 </td>
  </tr>
<tr>
<td style="text-align:right;"> 905.434 </td>
   <td style="text-align:right;"> 827.415 </td>
   <td style="text-align:right;"> 774.412 </td>
   <td style="text-align:right;"> 100.209 </td>
   <td style="text-align:right;"> 37.322 </td>
  </tr>
<tr>
<td style="text-align:right;"> 573.337 </td>
   <td style="text-align:right;"> 168.854 </td>
   <td style="text-align:right;"> 496.870 </td>
   <td style="text-align:right;"> 205.502 </td>
   <td style="text-align:right;"> 434.875 </td>
  </tr>
<tr>
<td style="text-align:right;"> 942.166 </td>
   <td style="text-align:right;"> 434.272 </td>
   <td style="text-align:right;"> 41.477 </td>
   <td style="text-align:right;"> 901.480 </td>
   <td style="text-align:right;"> 8.237 </td>
  </tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table data-quarto-disable-processing="true" class="table table-hover" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;"> $\theta_1$ </th>
   <th style="text-align:right;"> $\theta_2$ </th>
   <th style="text-align:right;"> $\theta_3$ </th>
   <th style="text-align:right;"> $\theta_4$ </th>
   <th style="text-align:right;"> $\theta_5$ </th>
  </tr></thead>
<tbody><tr>
<td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 6.423 </td>
   <td style="text-align:right;"> 5.053 </td>
   <td style="text-align:right;"> 6.595 </td>
   <td style="text-align:right;"> 6.17 </td>
  </tr></tbody>
</table>
</div>
</div>
<p>Additionally, let each replication run for ten iterations with only the values generated in the final iteration of each replication will be used. This technique is called thinning, which takes care of the auto-correlation effect of the generated sample. Further, by taking the last 9500 values of the Markov chain, an approximately independent random sample from the posterior distribution <span class="math inline">\(P(\theta \mid \text{observed data})\)</span> can be obtained.</p>
<div class="cell" data-hash="greaves_cache/html/thin-and-burn_5cbf30a0365b782136b202594547e8b3">
<details><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># keep only every 10th x and theta</span></span>
<span><span class="co"># -&gt; then get rid of first 500 samples</span></span>
<span><span class="va">burn_in</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">x10</span> <span class="op">&lt;-</span> <span class="va">data_sample</span><span class="op">[[</span><span class="st">"x"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="va">data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"0"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">burn_in</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">theta10</span> <span class="op">&lt;-</span> <span class="va">data_sample</span><span class="op">[[</span><span class="st">"theta"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">burn_in</span>, to <span class="op">=</span> <span class="va">k</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="va">.</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="greaves_cache/html/preview-sample3-thinned-burned_fcaf77ec4cf018c659c9c53fe94f9650">
<div class="cell-output-display">
<table data-quarto-disable-processing="true" class="table table-hover" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;"> X5010 </th>
   <th style="text-align:right;"> X5020 </th>
   <th style="text-align:right;"> X5030 </th>
   <th style="text-align:right;"> X5040 </th>
   <th style="text-align:right;"> X5050 </th>
   <th style="text-align:right;"> X5060 </th>
   <th style="text-align:right;"> X5070 </th>
   <th style="text-align:right;"> X5080 </th>
   <th style="text-align:right;"> X5090 </th>
   <th style="text-align:right;"> X5100 </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:right;"> 31.259 </td>
   <td style="text-align:right;"> 135.898 </td>
   <td style="text-align:right;"> 573.027 </td>
   <td style="text-align:right;"> 404.471 </td>
   <td style="text-align:right;"> 159.562 </td>
   <td style="text-align:right;"> 671.176 </td>
   <td style="text-align:right;"> 689.664 </td>
   <td style="text-align:right;"> 332.838 </td>
   <td style="text-align:right;"> 9.929 </td>
   <td style="text-align:right;"> 702.540 </td>
  </tr>
<tr>
<td style="text-align:right;"> 808.803 </td>
   <td style="text-align:right;"> 24.394 </td>
   <td style="text-align:right;"> 405.262 </td>
   <td style="text-align:right;"> 162.588 </td>
   <td style="text-align:right;"> 290.926 </td>
   <td style="text-align:right;"> 863.840 </td>
   <td style="text-align:right;"> 907.913 </td>
   <td style="text-align:right;"> 435.047 </td>
   <td style="text-align:right;"> 814.370 </td>
   <td style="text-align:right;"> 317.161 </td>
  </tr>
<tr>
<td style="text-align:right;"> 506.018 </td>
   <td style="text-align:right;"> 700.950 </td>
   <td style="text-align:right;"> 509.669 </td>
   <td style="text-align:right;"> 602.056 </td>
   <td style="text-align:right;"> 61.922 </td>
   <td style="text-align:right;"> 29.831 </td>
   <td style="text-align:right;"> 528.140 </td>
   <td style="text-align:right;"> 286.251 </td>
   <td style="text-align:right;"> 544.004 </td>
   <td style="text-align:right;"> 353.806 </td>
  </tr>
<tr>
<td style="text-align:right;"> 317.783 </td>
   <td style="text-align:right;"> 122.247 </td>
   <td style="text-align:right;"> 969.489 </td>
   <td style="text-align:right;"> 314.995 </td>
   <td style="text-align:right;"> 279.198 </td>
   <td style="text-align:right;"> 269.620 </td>
   <td style="text-align:right;"> 349.425 </td>
   <td style="text-align:right;"> 477.575 </td>
   <td style="text-align:right;"> 292.889 </td>
   <td style="text-align:right;"> 865.762 </td>
  </tr>
<tr>
<td style="text-align:right;"> 281.109 </td>
   <td style="text-align:right;"> 162.063 </td>
   <td style="text-align:right;"> 188.003 </td>
   <td style="text-align:right;"> 585.472 </td>
   <td style="text-align:right;"> 352.052 </td>
   <td style="text-align:right;"> 897.231 </td>
   <td style="text-align:right;"> 421.589 </td>
   <td style="text-align:right;"> 578.666 </td>
   <td style="text-align:right;"> 640.352 </td>
   <td style="text-align:right;"> 593.311 </td>
  </tr>
<tr>
<td style="text-align:right;"> 750.103 </td>
   <td style="text-align:right;"> 57.684 </td>
   <td style="text-align:right;"> 309.059 </td>
   <td style="text-align:right;"> 167.512 </td>
   <td style="text-align:right;"> 878.419 </td>
   <td style="text-align:right;"> 446.924 </td>
   <td style="text-align:right;"> 647.250 </td>
   <td style="text-align:right;"> 781.140 </td>
   <td style="text-align:right;"> 5.558 </td>
   <td style="text-align:right;"> 924.113 </td>
  </tr>
<tr>
<td style="text-align:right;"> 422.574 </td>
   <td style="text-align:right;"> 842.723 </td>
   <td style="text-align:right;"> 159.991 </td>
   <td style="text-align:right;"> 310.099 </td>
   <td style="text-align:right;"> 25.013 </td>
   <td style="text-align:right;"> 981.043 </td>
   <td style="text-align:right;"> 144.422 </td>
   <td style="text-align:right;"> 663.908 </td>
   <td style="text-align:right;"> 364.907 </td>
   <td style="text-align:right;"> 500.616 </td>
  </tr>
<tr>
<td style="text-align:right;"> 503.473 </td>
   <td style="text-align:right;"> 553.540 </td>
   <td style="text-align:right;"> 754.799 </td>
   <td style="text-align:right;"> 633.983 </td>
   <td style="text-align:right;"> 36.217 </td>
   <td style="text-align:right;"> 910.594 </td>
   <td style="text-align:right;"> 280.736 </td>
   <td style="text-align:right;"> 205.374 </td>
   <td style="text-align:right;"> 979.925 </td>
   <td style="text-align:right;"> 677.565 </td>
  </tr>
<tr>
<td style="text-align:right;"> 97.682 </td>
   <td style="text-align:right;"> 771.105 </td>
   <td style="text-align:right;"> 812.617 </td>
   <td style="text-align:right;"> 534.896 </td>
   <td style="text-align:right;"> 544.516 </td>
   <td style="text-align:right;"> 331.650 </td>
   <td style="text-align:right;"> 636.353 </td>
   <td style="text-align:right;"> 109.515 </td>
   <td style="text-align:right;"> 629.157 </td>
   <td style="text-align:right;"> 526.683 </td>
  </tr>
<tr>
<td style="text-align:right;"> 715.948 </td>
   <td style="text-align:right;"> 838.502 </td>
   <td style="text-align:right;"> 422.218 </td>
   <td style="text-align:right;"> 111.138 </td>
   <td style="text-align:right;"> 88.707 </td>
   <td style="text-align:right;"> 65.735 </td>
   <td style="text-align:right;"> 385.538 </td>
   <td style="text-align:right;"> 237.156 </td>
   <td style="text-align:right;"> 934.917 </td>
   <td style="text-align:right;"> 257.114 </td>
  </tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table data-quarto-disable-processing="true" class="table table-hover" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;"> $\theta$ </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:right;"> 5.030 </td>
  </tr>
<tr>
<td style="text-align:right;"> 8.171 </td>
  </tr>
<tr>
<td style="text-align:right;"> 7.630 </td>
  </tr>
<tr>
<td style="text-align:right;"> 6.211 </td>
  </tr>
<tr>
<td style="text-align:right;"> 5.645 </td>
  </tr>
<tr>
<td style="text-align:right;"> 6.348 </td>
  </tr>
<tr>
<td style="text-align:right;"> 9.041 </td>
  </tr>
<tr>
<td style="text-align:right;"> 6.721 </td>
  </tr>
<tr>
<td style="text-align:right;"> 5.032 </td>
  </tr>
<tr>
<td style="text-align:right;"> 6.877 </td>
  </tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="greaves_cache/html/fig-est-density-theta_aefb68e102c7151fca890af55bc383ea">
<details><summary>Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create histogram of theta </span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">theta10</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">theta</span>,</span>
<span>                     y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span>,</span>
<span>                     fill <span class="op">=</span> <span class="st">"Sampled Values"</span><span class="op">)</span>,</span>
<span>                 binwidth <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                 col <span class="op">=</span> <span class="st">"grey40"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sampled Values"</span> <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"legend"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="va">theme_swd</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-est-density-theta" class="quarto-figure quarto-figure-left anchored" width="50%">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-est-density-theta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Estimated density of θ
</figcaption><div aria-describedby="fig-est-density-theta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="greaves_files/figure-html/fig-est-density-theta-1.png" class="img-fluid figure-img" style="width:50.0%">
</div>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="greaves_cache/html/calc-summary-stats_bcad634e19ae2393aa501e13aabecdc3">
<details><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># summary of theta</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">theta10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>     theta       
 Min.   : 3.202  
 1st Qu.: 5.912  
 Median : 6.515  
 Mean   : 6.567  
 3rd Qu.: 7.190  
 Max.   :11.029  </code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">theta_sd</span> <span class="op">&lt;-</span> <span class="fu">sd</span><span class="op">(</span><span class="va">theta10</span><span class="op">$</span><span class="va">theta</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># solve for the number of values exceeding 10000</span></span>
<span><span class="co"># -&gt; first get subset of extreme cases (largest classes)</span></span>
<span><span class="co"># -&gt; then count</span></span>
<span><span class="va">extreme_cases</span> <span class="op">&lt;-</span> <span class="va">x10</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="va">t</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="va">data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fl">0.94</span><span class="op">*</span><span class="va">n</span><span class="op">)</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">count</span> <span class="op">&lt;-</span> <span class="va">extreme_cases</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">.x</span> <span class="op">&gt;</span> <span class="fl">10000</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="va">sum</span></span>
<span>  </span>
<span><span class="co"># calculate percentage</span></span>
<span><span class="va">proportion</span> <span class="op">&lt;-</span> <span class="va">count</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">extreme_cases</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">extreme_cases</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>These values are used to construct the histogram of sample values for <span class="math inline">\(\theta\)</span> in Figure 9. The sample mean and standard deviation were 6.567 and 0.959, respectively.</p>
<p>By monitoring the values taken on by the augmented data as the simulation proceeds, posterior inferences can be made with respect to the actual but unobserved losses. For example, by looking at the values of the losses appearing in the upper-most class (<span class="math inline">\(x_{48}\)</span>, <span class="math inline">\(x_{49}\)</span>, and <span class="math inline">\(x_{50}\)</span>), estimates of the posterior probability can be made that one or more of these losses exceeds an upper limit, say 10,000. Knowing a number like this can help in decision making. For this particular model, there was 340 observations that exceeded 10,000, giving <span class="math inline">\(P(X &gt; 10,000) \approx%\)</span> 0.895 <span class="math inline">\(\%\)</span>.</p>
</section></section><section id="references" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="references">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-berg2004" class="csl-entry" role="listitem">
Berg, Bernd A. 2004. <span>“Introduction to Markov Chain Monte Carlo Simulations and Their Statistical Analysis.”</span> <em>arXiv</em>. <a href="https://doi.org/10.48550/ARXIV.COND-MAT/0410490">https://doi.org/10.48550/ARXIV.COND-MAT/0410490</a>.
</div>
<div id="ref-besag1974" class="csl-entry" role="listitem">
Besag, Julian. 1974. <span>“Spatial Interaction and the Statistical Analysis of Lattice Systems.”</span> <em>Journal of the Royal Statistical Society: Series B (Methodological)</em> 36 (2): 192–225. <a href="https://doi.org/10.1111/j.2517-6161.1974.tb00999.x">https://doi.org/10.1111/j.2517-6161.1974.tb00999.x</a>.
</div>
<div id="ref-carlinb.p.1993" class="csl-entry" role="listitem">
Carlin B. P., and Klugman S.A. 1993. <span>“Hierarchical Bayesian Whittaker Graduation.”</span> <em>Scandinavian Actuarial Journal</em> 1993 (2): 183–96. <a href="https://experts.umn.edu/en/publications/hierarchical-bayesian-whittaker-graduation">https://experts.umn.edu/en/publications/hierarchical-bayesian-whittaker-graduation</a>.
</div>
<div id="ref-carlin1992" class="csl-entry" role="listitem">
Carlin, Bradley P. 1992. <span>“State Space Modeling of Non-Standard Actuarial Time Series.”</span> <em>Insurance: Mathematics and Economics</em> 11 (3): 209–22. <a href="https://doi.org/10.1016/0167-6687(92)90027-9">https://doi.org/10.1016/0167-6687(92)90027-9</a>.
</div>
<div id="ref-asimple1994" class="csl-entry" role="listitem">
———. 1994. <span>“A Simple Monte Carlo Approach to Bayesian Graduation.”</span> <em>Insurance: Mathematics and Economics</em> 14 (1): 68–69. <a href="https://doi.org/10.1016/0167-6687(94)90424-3">https://doi.org/10.1016/0167-6687(94)90424-3</a>.
</div>
<div id="ref-casella2002" class="csl-entry" role="listitem">
Casella, George, and Roger L. Berger. 2002. <em>Statistical Inference</em>. 2nd ed. Australia ; Pacific Grove, CA: Thomson Learning.
</div>
<div id="ref-gelfand1990" class="csl-entry" role="listitem">
Gelfand, Alan E., and Adrian F. M. Smith. 1990. <span>“Sampling-Based Approaches to Calculating Marginal Densities.”</span> <em>Journal of the American Statistical Association</em> 85 (410): 398–409. <a href="https://doi.org/10.1080/01621459.1990.10476213">https://doi.org/10.1080/01621459.1990.10476213</a>.
</div>
<div id="ref-geman1984" class="csl-entry" role="listitem">
Geman, Stuart, and Donald Geman. 1984. <span>“Stochastic Relaxation, Gibbs Distributions, and the Bayesian Restoration of Images.”</span> <em>IEEE Transactions on Pattern Analysis and Machine Intelligence</em> PAMI-6 (6): 721–41. <a href="https://doi.org/10.1109/tpami.1984.4767596">https://doi.org/10.1109/tpami.1984.4767596</a>.
</div>
<div id="ref-scollnik1993" class="csl-entry" role="listitem">
Scollnik, David P. M. 1993. <span>“A Bayesian Analysis of a Simultaneous Equations Model for Insurance Rate-Making.”</span> <em>Insurance: Mathematics and Economics</em> 12 (3): 265–86. <a href="https://doi.org/10.1016/0167-6687(93)90238-k">https://doi.org/10.1016/0167-6687(93)90238-k</a>.
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Github repository for code
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can find the code to reproduce this report at <a href="https://github.com/coltongearhart/greaves">coltongearhart/greaves</a>.</p>
</div>
</div>
<!-- -->

</section><div id="quarto-appendix" class="default"><aside id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>Burn-in iterations allow the analysis to not use the values from the first <span class="math inline">\(x\)</span> iterations where the Markov chains are attempting to converge. For our analyses, 500 iterations is considered sufficient.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></aside><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-gearhart2018" class="csl-entry quarto-appendix-citeas" role="listitem">
Gearhart, Colton, and Dhanuja Kasturiratna. 2018. <span>“Implementation
of Gibbs Sampling Within Bayesian Inference and Its Applications in
Actuarial Science.”</span> <em>SIAM Undergraduate Research Online</em>
11 (June). <a href="https://www.siam.org/Portals/0/Publications/SIURO/Volume%2011/S016609.pdf?ver=2018-06-13-135921-713">https://www.siam.org/Portals/0/Publications/SIURO/Volume%2011/S016609.pdf?ver=2018-06-13-135921-713</a>.
</div></div></section></div></main><!-- /main column --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        console.log("RESIZE");
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb21" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Implementation of Gibbs Sampling within Bayesian Inference and its Applications in Actuarial Science</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Colton Gearhart</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">    email: gearhart.colton.work@gmail.com</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">    roles: "Author"</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation:</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">      - id: nku</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">        name: Northern Kentucky University</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">        department: Mathematics and Statistics</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">        city: Highland Heights</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">        country: USA</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">        url: https://www.nku.edu/academics/artsci/about/departments/math.html</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Dhanuja Kasturiratna</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co">    email: kasturirad1@nku.edu</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co">    roles: "Faculty Advisor"</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co">      - ref: nku</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="an">keywords:</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co">  - Bayesian inference</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="co">  - Gibbs sampling</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co">  - Markov chain</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="co">  - Monte Carlo simulation</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="an">abstract:</span><span class="co"> |</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="co">  This paper discusses how a variety of actuarial models can be implemented and analyzed with a Bayesian approach using Gibbs sampling, a Markov chain Monte Carlo method. This approach allows a practitioner to analyze complicated actuarial models by reducing them to simpler, more manageable models. Furthermore, general properties of Gibbs sampling are discussed through a simulation approach.</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="an">funding:</span><span class="co"> "Greaves Undergraduate Research Program"</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 6/13/2018</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="co">  type: article-journal</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a><span class="co">  container-title: "SIAM Undergraduate Research Online"</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a><span class="co">  volume: 11</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a><span class="co">  page: ""</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a><span class="co">  url: https://www.siam.org/Portals/0/Publications/SIURO/Volume%2011/S016609.pdf?ver=2018-06-13-135921-713</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a><span class="an">appendix-cite-as:</span><span class="co"> display</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a><span class="co">    output-file: index.html</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: flatly</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-expand: true</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true</span></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a><span class="co">    code-block-border-left: "#2C3E50"</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight-style: github</span></span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: kable</span></span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a><span class="an">number-sections:</span><span class="co"> true</span></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a><span class="an">title-block-banner:</span><span class="co"> true</span></span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a><span class="an">fig-cap-location:</span><span class="co"> top</span></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a><span class="an">fig-align:</span><span class="co"> left</span></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % define LaTeX macros (/shortcuts) --&gt;</span></span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- % shortcut for ~ 'Named dist ' in normal font with space before parameters would go --&gt;</span></span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>\newcommand{\follow}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\sim \text{#1}\,}</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{r knitr}</span></span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: knitr</span></span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a><span class="in"># set knitr options</span></span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(</span></span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a><span class="in">  cache = TRUE, # cache output and objects to speed up building process (broken by modifying code chunks / options -&gt; standalone file can't cache)</span></span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a><span class="in">  comment = '', # remove ## prefix for printed text output</span></span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a><span class="in">  message = FALSE, # suppress printing of messages in the output document</span></span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a><span class="in">  warning = FALSE, # suppress printing of warnings in the output document</span></span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a><span class="in">  out.width = "50%" # set output width of plots</span></span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a><span class="in"># disable scientific notation for readability purposes</span></span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a><span class="in">options(scipen = 999) </span></span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a><span class="fu">## Quarto blog publish details</span></span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>This blog was created using <span class="co">[</span><span class="ot">Quarto</span><span class="co">](https://quarto.org/)</span> and published with Github Pages. </span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a><span class="fu">## R Setup {.unnumbered}</span></span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(actuar) <span class="co"># for pareto()</span></span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(truncdist) <span class="co"># for rtrunc()</span></span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra) <span class="co"># for kable_styling()</span></span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a><span class="co"># create default storytelling with data theme</span></span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a>theme_swd <span class="ot">&lt;-</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a>  <span class="co"># titles and captions</span></span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.75</span>), <span class="at">color =</span> <span class="st">"grey30"</span>),</span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.25</span>), <span class="at">color =</span> <span class="st">"grey30"</span>),</span>
<span id="cb21-102"><a href="#cb21-102" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey30"</span>),</span>
<span id="cb21-103"><a href="#cb21-103" aria-hidden="true" tabindex="-1"></a>  <span class="co"># axes</span></span>
<span id="cb21-104"><a href="#cb21-104" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey30"</span>),</span>
<span id="cb21-105"><a href="#cb21-105" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"grey30"</span>),</span>
<span id="cb21-106"><a href="#cb21-106" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey90"</span>),</span>
<span id="cb21-107"><a href="#cb21-107" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey90"</span>),</span>
<span id="cb21-108"><a href="#cb21-108" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot background and gridlines</span></span>
<span id="cb21-109"><a href="#cb21-109" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-110"><a href="#cb21-110" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="fu">rel</span>(<span class="fl">0.5</span>), <span class="at">color =</span> <span class="st">"grey90"</span>),</span>
<span id="cb21-111"><a href="#cb21-111" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="fu">rel</span>(<span class="fl">0.5</span>), <span class="at">color =</span> <span class="st">"grey90"</span>),</span>
<span id="cb21-112"><a href="#cb21-112" aria-hidden="true" tabindex="-1"></a>  <span class="co"># legend</span></span>
<span id="cb21-113"><a href="#cb21-113" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey30"</span>),</span>
<span id="cb21-114"><a href="#cb21-114" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey30"</span>),</span>
<span id="cb21-115"><a href="#cb21-115" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.position =</span> <span class="st">"top"</span> </span>
<span id="cb21-116"><a href="#cb21-116" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-117"><a href="#cb21-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-118"><a href="#cb21-118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-119"><a href="#cb21-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-122"><a href="#cb21-122" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-123"><a href="#cb21-123" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb21-124"><a href="#cb21-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-125"><a href="#cb21-125" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co"> theme_set(theme_swd) not working for some reason, so adding individually to all plots </span></span>
<span id="cb21-126"><a href="#cb21-126" aria-hidden="true" tabindex="-1"></a><span class="co"># same for table styling</span></span>
<span id="cb21-127"><a href="#cb21-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-128"><a href="#cb21-128" aria-hidden="true" tabindex="-1"></a><span class="co"># set global theme</span></span>
<span id="cb21-129"><a href="#cb21-129" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(theme_swd)</span>
<span id="cb21-130"><a href="#cb21-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-131"><a href="#cb21-131" aria-hidden="true" tabindex="-1"></a><span class="co"># default function to display dataframes nicely</span></span>
<span id="cb21-132"><a href="#cb21-132" aria-hidden="true" tabindex="-1"></a><span class="co"># options -&gt; vector of column names (gets processed by kable(), so can be latex), number of rows to display, and rounding digits</span></span>
<span id="cb21-133"><a href="#cb21-133" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; needed because formatting of raw dataframe is bad when output in markdown</span></span>
<span id="cb21-134"><a href="#cb21-134" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; nesting functions instead of piping so doesn't require magrittr</span></span>
<span id="cb21-135"><a href="#cb21-135" aria-hidden="true" tabindex="-1"></a>display_nice <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">col.names =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="dv">10</span>, <span class="at">digits =</span> <span class="dv">3</span>) {</span>
<span id="cb21-136"><a href="#cb21-136" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-137"><a href="#cb21-137" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set columns names to the given vector or keep names or original df</span></span>
<span id="cb21-138"><a href="#cb21-138" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">identical</span>(col.names, <span class="cn">NA</span>)) {</span>
<span id="cb21-139"><a href="#cb21-139" aria-hidden="true" tabindex="-1"></a>    col.names <span class="ot">=</span> <span class="fu">colnames</span>(df)</span>
<span id="cb21-140"><a href="#cb21-140" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-141"><a href="#cb21-141" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-142"><a href="#cb21-142" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to knitr_kable and style</span></span>
<span id="cb21-143"><a href="#cb21-143" aria-hidden="true" tabindex="-1"></a>  <span class="co"># -&gt; always want html format, left aligned with not full width</span></span>
<span id="cb21-144"><a href="#cb21-144" aria-hidden="true" tabindex="-1"></a>  <span class="co"># -&gt; table.attr -&gt; have to tell quarto to not process the table (https://github.com/quarto-dev/quarto-cli/issues/5737)</span></span>
<span id="cb21-145"><a href="#cb21-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="fu">kable</span>(<span class="fu">head</span>(df, <span class="at">n =</span> nrow),</span>
<span id="cb21-146"><a href="#cb21-146" aria-hidden="true" tabindex="-1"></a>                      <span class="at">col.names =</span> col.names,</span>
<span id="cb21-147"><a href="#cb21-147" aria-hidden="true" tabindex="-1"></a>                      <span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb21-148"><a href="#cb21-148" aria-hidden="true" tabindex="-1"></a>                      <span class="at">digits =</span> digits,</span>
<span id="cb21-149"><a href="#cb21-149" aria-hidden="true" tabindex="-1"></a>                      <span class="at">table.attr =</span> <span class="st">'data-quarto-disable-processing="true"'</span>),</span>
<span id="cb21-150"><a href="#cb21-150" aria-hidden="true" tabindex="-1"></a>                <span class="at">bootstrap_options =</span> <span class="st">"hover"</span>,</span>
<span id="cb21-151"><a href="#cb21-151" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb21-152"><a href="#cb21-152" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">"left"</span>)</span>
<span id="cb21-153"><a href="#cb21-153" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-154"><a href="#cb21-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-155"><a href="#cb21-155" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-156"><a href="#cb21-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-157"><a href="#cb21-157" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb21-158"><a href="#cb21-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-159"><a href="#cb21-159" aria-hidden="true" tabindex="-1"></a>The use of predictive models in research is a common practice for actuaries. However, they are still realizing the full potential of the many available techniques involving predictive models. The recent developments in high speed computation have opened new avenues to actuaries who are involved in constructing models that can be used in predicting future uncertain events. The practical development of techniques such as linear programming, dynamic programming, Monte Carlo experiments and many others would not have been possible without the arrival of high-speed computers. The actuarial profession needs to keep pace with these developments and consider how these methods can be utilized more effectively in decision making.</span>
<span id="cb21-160"><a href="#cb21-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-161"><a href="#cb21-161" aria-hidden="true" tabindex="-1"></a>Stochastic models play a wide role in actuarial science applications. Mathematical analysis (a theoretical approach) is one way to extract characteristics of such models. A practitioner may also use simulation to study these models. This approach is especially useful when the stochastic models are complicated and impossible to tract theoretically. Because many actuarial models are like this, simulation is an important tool.</span>
<span id="cb21-162"><a href="#cb21-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-163"><a href="#cb21-163" aria-hidden="true" tabindex="-1"></a>This paper discusses usefulness and importance of combining Monte Carlo simulation techniques with Bayesian analysis in order to study complicated stochastic models in actuarial sciences. Bayesian analysis is quite useful as it allows one to learn about the whole distribution of a chosen quantity, rather than just a single statistic. Additionally, the assignment of probability distributions to unknown quantities allows for the reflection of uncertainty. This uncertainty is represented as the prior distribution, which is then updated with data. This increases the reliability of the estimates. Then, once suitable models for the parameters are obtained, one can study the distribution of the variables of interest, which is the end goal of Bayesian analysis.</span>
<span id="cb21-164"><a href="#cb21-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-165"><a href="#cb21-165" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bayesian Inference {#sec-bayes}</span></span>
<span id="cb21-166"><a href="#cb21-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-167"><a href="#cb21-167" aria-hidden="true" tabindex="-1"></a>In classical statistical techniques, model parameters are assumed to be fixed quantities; only the data is random. Thus, probability distributions can only be used to represent the data. But in Bayesian statistics, probability distributions are often applied to more than just the data. They can represent prior uncertainty in model parameters. These then get updated with current data to produce posterior probability distributions. In effect, the parameters now contain less uncertainty; in other words, they are more informed. This thinking produces a general rule in Bayesian statistics: any quantity which has uncertainty can be represented by a probability distribution. This can be shown in Bayes' theorem, which simply is a demonstration of conditional probability, expressed using probability distributions as follows:</span>
<span id="cb21-168"><a href="#cb21-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-169"><a href="#cb21-169" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-170"><a href="#cb21-170" aria-hidden="true" tabindex="-1"></a>f(\theta\mid data) = \frac{f(data\mid\theta)\,f(\theta)}{f(data)}.</span>
<span id="cb21-171"><a href="#cb21-171" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-172"><a href="#cb21-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-173"><a href="#cb21-173" aria-hidden="true" tabindex="-1"></a>In this scenario, $f(\theta\mid data)$ is the posterior distribution for the parameter $\theta$. $f(data\mid\theta)$ is the sampling density for the data. This distribution is proportional to the likelihood function; however, it differs by a constant which serves to make it a proper density. $f(\theta)$ is the prior distribution for the parameter. Finally, $f(data)$ is the marginal probability of the data. When considering a continuous sample space, this marginal probability is computed as</span>
<span id="cb21-174"><a href="#cb21-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-175"><a href="#cb21-175" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-176"><a href="#cb21-176" aria-hidden="true" tabindex="-1"></a>f(data) = \int{f(data\mid\theta)\,f(\theta)\,d\theta}.</span>
<span id="cb21-177"><a href="#cb21-177" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-178"><a href="#cb21-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-179"><a href="#cb21-179" aria-hidden="true" tabindex="-1"></a>In words, this is the integral of the sampling density multiplied by the prior distribution over the sample space of $\theta$. This quantity is often referred to as the "marginal likelihood" for the data. It makes the posterior density proper by functioning as a normalizing constant. In addition, it is proportional to the likelihood function. These two qualities lead Bayes' theorem for probability distributions to be frequently stated as</span>
<span id="cb21-180"><a href="#cb21-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-181"><a href="#cb21-181" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-182"><a href="#cb21-182" aria-hidden="true" tabindex="-1"></a>Posterior \approx Likelihood\,\times Prior.</span>
<span id="cb21-183"><a href="#cb21-183" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-184"><a href="#cb21-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-185"><a href="#cb21-185" aria-hidden="true" tabindex="-1"></a>Once the posterior distribution for a parameter is derived, Bayesian analysis attempts to summarize the entire distribution. In addition to not having a reliance on asymptotic arguments about normality, this allows for numerous additional tests and summaries. Occasionally, these distributions have closed-form solutions (or at least solutions that can be computed using numerical methods). However, for many other distributions the integrals may be quite difficult or even impossible to compute, especially multivariate ones. In this instance, Monte Carlo simulation plays a major role. The general logic of sampling is to generate a sample of size $n$ from the desired distribution and then apply discrete formulas to these samples. This, in effect, approximates the integrals of interest. For example, a mean is estimated by</span>
<span id="cb21-186"><a href="#cb21-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-187"><a href="#cb21-187" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-188"><a href="#cb21-188" aria-hidden="true" tabindex="-1"></a>\int xf(x)\,dx \approx \frac{1}{n}\sum x,</span>
<span id="cb21-189"><a href="#cb21-189" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-190"><a href="#cb21-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-191"><a href="#cb21-191" aria-hidden="true" tabindex="-1"></a>and a variance by</span>
<span id="cb21-192"><a href="#cb21-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-193"><a href="#cb21-193" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-194"><a href="#cb21-194" aria-hidden="true" tabindex="-1"></a>\int (x-\mu)^2\,f(x)\,dx \approx \frac{1}{n} \sum (x-\mu)^2.</span>
<span id="cb21-195"><a href="#cb21-195" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-196"><a href="#cb21-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-197"><a href="#cb21-197" aria-hidden="true" tabindex="-1"></a>Additionally, any desired quantile can be found by noting the value of $x$ that has $Q\%$ of the sampled values below it.</span>
<span id="cb21-198"><a href="#cb21-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-199"><a href="#cb21-199" aria-hidden="true" tabindex="-1"></a>To sum up, Bayesian inference commonly follows these steps:</span>
<span id="cb21-200"><a href="#cb21-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-201"><a href="#cb21-201" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Creating a model and obtaining posterior distributions for the parameters being studied.</span>
<span id="cb21-202"><a href="#cb21-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-203"><a href="#cb21-203" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Simulating samples from the posterior distributions.</span>
<span id="cb21-204"><a href="#cb21-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-205"><a href="#cb21-205" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Taking discrete formulas and applying them to the samples found in step 2 in order to summarize knowledge of the parameters.</span>
<span id="cb21-206"><a href="#cb21-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-207"><a href="#cb21-207" aria-hidden="true" tabindex="-1"></a>This whole process differs from the approach taken in Classical statistics, where point estimates are found for parameters and inferences are conducted using the standard error and the central limit theorem.</span>
<span id="cb21-208"><a href="#cb21-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-209"><a href="#cb21-209" aria-hidden="true" tabindex="-1"></a><span class="fu">### Markov Chain Monte Carlo Methods and Gibbs Sampling</span></span>
<span id="cb21-210"><a href="#cb21-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-211"><a href="#cb21-211" aria-hidden="true" tabindex="-1"></a>One very useful class of simulation techniques is known as Markov chain Monte Carlo (MCMC) sampling methods. The purpose of using these methods is to study distributions that would be very difficult to study otherwise (these distributions will later be referred to as "target distributions"). With the use of MCMC methods, a researcher can simulate a series of dependent random draws from models that are often quite complex. MCMC methods prove to be very useful when sampling from multivariate distributions that would normally be difficult to sample from. This is done by breaking them down into more feasible multivariate distributions or even univariate distributions.</span>
<span id="cb21-212"><a href="#cb21-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-213"><a href="#cb21-213" aria-hidden="true" tabindex="-1"></a>The first step of a MCMC method is to specify a Markov chain with a unique invariant distribution equal to the target distribution (we will discuss one way to do this in the following paragraph). The next step is to generate a new value from this Markov chain given the previous value (for further reading, refer to <span class="co">[</span><span class="ot">@berg2004</span><span class="co">]</span>. This forms an iterative process which produces a Markov chain of values. Furthermore, after the burn-in iterations<span class="ot">[^1]</span> are complete, it has been shown that these generated values nearly follow a random draw from the target distribution. These samples can then be used for inference procedures in a variety of ways.</span>
<span id="cb21-214"><a href="#cb21-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-215"><a href="#cb21-215" aria-hidden="true" tabindex="-1"></a><span class="ot">[^1]: </span>Burn-in iterations allow the analysis to not use the values from the first $x$ iterations where the Markov chains are attempting to converge. For our analyses, 500 iterations is considered sufficient.</span>
<span id="cb21-216"><a href="#cb21-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-217"><a href="#cb21-217" aria-hidden="true" tabindex="-1"></a>One popular MCMC method for constructing a Markov chain for a target density is Gibbs sampling. It was first introduced to the field of image restoration by Geman and Geman <span class="co">[</span><span class="ot">@geman1984</span><span class="co">]</span>, however its use in the field of Bayesian analysis was first recognized by Gelfand and Smith <span class="co">[</span><span class="ot">@gelfand1990</span><span class="co">]</span>. Since then, Gibbs sampling has only appeared a few times within actuarial literature. Carlin <span class="co">[</span><span class="ot">@carlin1992</span><span class="co">]</span> used Gibbs sampling to study state space modeling of non-standard actuarial time series and Carlin <span class="co">[</span><span class="ot">@asimple1994</span><span class="co">]</span> also used it to develop a Monte Carlo approach to Bayesian graduation. Klugman and Carlin <span class="co">[</span><span class="ot">@carlinb.p.1993</span><span class="co">]</span> used Gibbs sampling in a similar area, however they had a focus on Whittaker-Henderson graduation. Additionally, Scollnik <span class="co">[</span><span class="ot">@scollnik1993</span><span class="co">]</span> performed a Bayesian analysis of a simultaneous equations model for insurance rate-making.</span>
<span id="cb21-218"><a href="#cb21-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-219"><a href="#cb21-219" aria-hidden="true" tabindex="-1"></a>On occasion, sampling from the multivariate posterior distribution is not feasible but sampling from the conditional distributions of each parameter is possible (for further reading, refer to <span class="co">[</span><span class="ot">@besag1974</span><span class="co">]</span>). In this situation, Gibbs sampling has been found to be quite applicable. To create the Markov chain, Gibbs sampling uses a set of full conditional distributions associated with the target distribution. These are then used to generate a Markov chain with a unique invariant distribution equal to the target distribution. A basic Gibbs sampling algorithm is displayed below ($j$ represents the iteration count).</span>
<span id="cb21-220"><a href="#cb21-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-221"><a href="#cb21-221" aria-hidden="true" tabindex="-1"></a><span class="ss">0.  </span>Assign a vector of starting values $x^{(j)} = (x^{(j)}_1, x^{(j)}_2, \ldots, x^{(j)}_k)$, with $j=0$.</span>
<span id="cb21-222"><a href="#cb21-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-223"><a href="#cb21-223" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Set $j = j + 1$.</span>
<span id="cb21-224"><a href="#cb21-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-225"><a href="#cb21-225" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Simulate $x^{(j)}_1 \sim f(x_1 \mid x^{(j-1)}_2, x^{(j-1)}_3, \ldots, x^{(j-1)}_k)$.</span>
<span id="cb21-226"><a href="#cb21-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-227"><a href="#cb21-227" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Simulate $x^{(j)}_2 \sim f(x_2 \mid x^{(j-1)}_1, x^{(j-1)}_3, \ldots, x^{(j-1)}_k)$.</span>
<span id="cb21-228"><a href="#cb21-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-229"><a href="#cb21-229" aria-hidden="true" tabindex="-1"></a>$\hspace{10pt} \vdots \hspace{30pt} \vdots$</span>
<span id="cb21-230"><a href="#cb21-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-231"><a href="#cb21-231" aria-hidden="true" tabindex="-1"></a>k.  Simulate $x^{(j)}_k \sim f(x_k \mid x^{(j-1)}_1, x^{(j-1)}_2, \ldots, x^{(j-1)}_{k-1})$.</span>
<span id="cb21-232"><a href="#cb21-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-233"><a href="#cb21-233" aria-hidden="true" tabindex="-1"></a>k+1. Form $x^{(j)} = (x^{(j)}_1, x^{(j)}_2, \ldots, x^{(j)}_k)$.</span>
<span id="cb21-234"><a href="#cb21-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-235"><a href="#cb21-235" aria-hidden="true" tabindex="-1"></a>k+2. Return to step 1.</span>
<span id="cb21-236"><a href="#cb21-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-237"><a href="#cb21-237" aria-hidden="true" tabindex="-1"></a>In words, the Gibbs sampling algorithm defined above generates a random draw from each of the full conditional distributions. However, as the algorithm progresses, the values of the conditioning variables are sequentially updated. Thus, the next draw depends on the previous one. Moreover, a key aspect of Gibbs sampling is that the full conditional distribution does not need to be known; it only needs to be known up to a normalizing constant. In conjunction with a Bayesian approach, Gibbs sampling allows us to use the joint densities that have all other parameters set at their current values. In other words, with all other parameters treated as fixed, the result is often a known form of the density. This greatly reduces the difficulty of many analyses.</span>
<span id="cb21-238"><a href="#cb21-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-239"><a href="#cb21-239" aria-hidden="true" tabindex="-1"></a><span class="fu">## Applications</span></span>
<span id="cb21-240"><a href="#cb21-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-241"><a href="#cb21-241" aria-hidden="true" tabindex="-1"></a><span class="fu">### Demonstrating the Properties of Gibbs Sampling</span></span>
<span id="cb21-242"><a href="#cb21-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-243"><a href="#cb21-243" aria-hidden="true" tabindex="-1"></a>Here we are going to study the properties of Gibbs sampling through simulation. We start by assuming the size of a claim $X$ is exponentially distributed with parameter $\lambda$. Further, we treat the parameter $\lambda$ as a random variable that follows a gamma distribution with parameters $\alpha$ and $\beta$. $\alpha$ and $\beta$ are constants. Stemming from our Bayesian approach, we can write this information as follows: the conditional distribution of $X$ given $\lambda$ as</span>
<span id="cb21-244"><a href="#cb21-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-245"><a href="#cb21-245" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-246"><a href="#cb21-246" aria-hidden="true" tabindex="-1"></a>f(x \mid \lambda) = \lambda e^{-\lambda x},\hspace{10pt} x &gt; 0</span>
<span id="cb21-247"><a href="#cb21-247" aria-hidden="true" tabindex="-1"></a>$$ {#eq-x-given-lambda}</span>
<span id="cb21-248"><a href="#cb21-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-249"><a href="#cb21-249" aria-hidden="true" tabindex="-1"></a>and the mixing distribution of $\lambda$, with parameters $\alpha$ and $\beta$ as</span>
<span id="cb21-250"><a href="#cb21-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-251"><a href="#cb21-251" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-252"><a href="#cb21-252" aria-hidden="true" tabindex="-1"></a>f(\lambda \mid \alpha,\beta) = \frac{\beta^\alpha}{\Gamma(\alpha)} \lambda^{^\alpha-1} e{-\beta\lambda},\hspace{10pt}\lambda &gt; 0.</span>
<span id="cb21-253"><a href="#cb21-253" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-254"><a href="#cb21-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-255"><a href="#cb21-255" aria-hidden="true" tabindex="-1"></a>Now, the joint distribution of $X$ and $\lambda$ can be obtained.</span>
<span id="cb21-256"><a href="#cb21-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-257"><a href="#cb21-257" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-258"><a href="#cb21-258" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb21-259"><a href="#cb21-259" aria-hidden="true" tabindex="-1"></a>f(x,\lambda) &amp;= f(x \mid \lambda)f(\lambda)<span class="sc">\\</span></span>
<span id="cb21-260"><a href="#cb21-260" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{1}{\Gamma(\alpha)} \beta^\alpha \lambda^\alpha e^{-\lambda(x+\beta)}.</span>
<span id="cb21-261"><a href="#cb21-261" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb21-262"><a href="#cb21-262" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-263"><a href="#cb21-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-264"><a href="#cb21-264" aria-hidden="true" tabindex="-1"></a>By integrating the above joint density with respect to $\lambda$, we can obtain the marginal distribution of $X$.</span>
<span id="cb21-265"><a href="#cb21-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-266"><a href="#cb21-266" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-267"><a href="#cb21-267" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb21-268"><a href="#cb21-268" aria-hidden="true" tabindex="-1"></a>f(x) &amp;= \int_0^\infty{f(x,\lambda)\,d\lambda}<span class="sc">\\</span></span>
<span id="cb21-269"><a href="#cb21-269" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{\alpha \beta^\alpha}{(\beta+x)^{\alpha+1}},\hspace{10pt} x &gt; 0<span class="sc">\\</span></span>
<span id="cb21-270"><a href="#cb21-270" aria-hidden="true" tabindex="-1"></a>&amp;\sim \text{Pareto}\, (\alpha,\beta).</span>
<span id="cb21-271"><a href="#cb21-271" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb21-272"><a href="#cb21-272" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-273"><a href="#cb21-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-274"><a href="#cb21-274" aria-hidden="true" tabindex="-1"></a>Note that $f(x)$ simplifies to a Pareto distribution with parameters $\alpha$ and $\beta$. This density is the closed form solution that was mentioned in @sec-bayes; in most problems, this is not possible to obtain. However, we chose distributions such that there would be a closed form solution in order to compare our results to. Finally, we can solve for each conditional distribution. Having already been given $f(x \mid \lambda)$ in Equation @eq-x-given-lambda, $f(\lambda\mid x)$ is derived as follows:</span>
<span id="cb21-275"><a href="#cb21-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-276"><a href="#cb21-276" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-277"><a href="#cb21-277" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb21-278"><a href="#cb21-278" aria-hidden="true" tabindex="-1"></a>f(\lambda\mid x) &amp;= \frac{f(x,\lambda)}{f(x)}<span class="sc">\\</span></span>
<span id="cb21-279"><a href="#cb21-279" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{(x+\beta)^{\alpha+1} \lambda^\alpha e^{-\lambda(x+\beta)}}{\Gamma(\alpha+1)}<span class="sc">\\</span></span>
<span id="cb21-280"><a href="#cb21-280" aria-hidden="true" tabindex="-1"></a>&amp;\sim \text{gamma}\, (\alpha+1,x+\beta).</span>
<span id="cb21-281"><a href="#cb21-281" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb21-282"><a href="#cb21-282" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-283"><a href="#cb21-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-284"><a href="#cb21-284" aria-hidden="true" tabindex="-1"></a>Notice here that the conditional distribution of $f(\lambda \mid x)$ simplifies to a gamma distribution. This is because of the use of a conjugate prior distribution. This simply means that the mixing distribution is from the same family as the variable of interest (for further reading, refer to <span class="co">[</span><span class="ot">@casella2002</span><span class="co">]</span>).</span>
<span id="cb21-285"><a href="#cb21-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-286"><a href="#cb21-286" aria-hidden="true" tabindex="-1"></a>The next step in Gibbs sampling is to run our two conditional distributions through the iterative algorithm defined below:</span>
<span id="cb21-287"><a href="#cb21-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-288"><a href="#cb21-288" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Select arbitrary initial values $x^{(0)}$ and $\lambda^{(0)}$.</span>
<span id="cb21-289"><a href="#cb21-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-290"><a href="#cb21-290" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Set counter index $i = 0$.</span>
<span id="cb21-291"><a href="#cb21-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-292"><a href="#cb21-292" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Sample $x^{(i+1)}$ from $f(x \mid \lambda^{(i)}) \sim \text{exponential}\,(\lambda)$.</span>
<span id="cb21-293"><a href="#cb21-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-294"><a href="#cb21-294" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Sample $\lambda^{(i+1)}$ f from $f(\lambda\mid x^{(i+1)}) \,\sim \text{gamma}\,(\alpha+1,x^{(i+1)}+\beta)$.</span>
<span id="cb21-295"><a href="#cb21-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-296"><a href="#cb21-296" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>Set $i = i + 1$ and return to step 3.</span>
<span id="cb21-297"><a href="#cb21-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-298"><a href="#cb21-298" aria-hidden="true" tabindex="-1"></a>For illustrative purposes, assume $\alpha = 5$ and $\beta = 100$. This reduces the uncertainty to the random variables $X$ and $\lambda$. Using the principles of Gibbs sampling as shown above, 100,000 random numbers are generated for $X$ and $\lambda$.</span>
<span id="cb21-299"><a href="#cb21-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-302"><a href="#cb21-302" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-303"><a href="#cb21-303" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: generate-data1</span></span>
<span id="cb21-304"><a href="#cb21-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-305"><a href="#cb21-305" aria-hidden="true" tabindex="-1"></a><span class="co"># function to generate random data from conditional distributions</span></span>
<span id="cb21-306"><a href="#cb21-306" aria-hidden="true" tabindex="-1"></a>generate_sample1 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">10000</span>, <span class="at">alpha =</span> <span class="dv">5</span>, <span class="at">beta =</span> <span class="dv">100</span>, <span class="at">start_x =</span> <span class="dv">5</span>, <span class="at">start_lambda =</span> <span class="fl">1.5</span>, <span class="at">seed =</span> <span class="dv">0</span>) {</span>
<span id="cb21-307"><a href="#cb21-307" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-308"><a href="#cb21-308" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create matrix</span></span>
<span id="cb21-309"><a href="#cb21-309" aria-hidden="true" tabindex="-1"></a>  <span class="co"># -&gt; </span><span class="al">NOTE</span><span class="co"> -&gt; matrices are much faster than dataframes</span></span>
<span id="cb21-310"><a href="#cb21-310" aria-hidden="true" tabindex="-1"></a>  data_sample <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> n, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="cn">NULL</span>, <span class="fu">c</span>(<span class="st">"iteration"</span>, <span class="st">"X"</span>, <span class="st">"lambda"</span>)))</span>
<span id="cb21-311"><a href="#cb21-311" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-312"><a href="#cb21-312" aria-hidden="true" tabindex="-1"></a>  <span class="co"># conditionally set random seed</span></span>
<span id="cb21-313"><a href="#cb21-313" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (seed <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="fu">set.seed</span>(seed)</span>
<span id="cb21-314"><a href="#cb21-314" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-315"><a href="#cb21-315" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize counter and starting values</span></span>
<span id="cb21-316"><a href="#cb21-316" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb21-317"><a href="#cb21-317" aria-hidden="true" tabindex="-1"></a>  data_sample[i, ] <span class="ot">=</span> <span class="fu">c</span>(i, start_x, start_lambda)</span>
<span id="cb21-318"><a href="#cb21-318" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-319"><a href="#cb21-319" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate new data for x and lambda based on sequentially updated conditional distributions</span></span>
<span id="cb21-320"><a href="#cb21-320" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (i <span class="sc">&lt;</span> n) {</span>
<span id="cb21-321"><a href="#cb21-321" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-322"><a href="#cb21-322" aria-hidden="true" tabindex="-1"></a>    <span class="co"># record iteration</span></span>
<span id="cb21-323"><a href="#cb21-323" aria-hidden="true" tabindex="-1"></a>    data_sample[i <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"iteration"</span>] <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb21-324"><a href="#cb21-324" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-325"><a href="#cb21-325" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sample from x | lambda</span></span>
<span id="cb21-326"><a href="#cb21-326" aria-hidden="true" tabindex="-1"></a>    data_sample[i <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"X"</span>] <span class="ot">&lt;-</span> <span class="fu">rexp</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">rate =</span> data_sample[i, <span class="st">"lambda"</span>])</span>
<span id="cb21-327"><a href="#cb21-327" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-328"><a href="#cb21-328" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sample from lambda | x</span></span>
<span id="cb21-329"><a href="#cb21-329" aria-hidden="true" tabindex="-1"></a>    data_sample[i <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"lambda"</span>] <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">shape =</span> alpha <span class="sc">+</span> <span class="dv">1</span>, <span class="at">rate =</span> data_sample[i <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"X"</span>] <span class="sc">+</span> beta)</span>
<span id="cb21-330"><a href="#cb21-330" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-331"><a href="#cb21-331" aria-hidden="true" tabindex="-1"></a>    <span class="co"># increase counter</span></span>
<span id="cb21-332"><a href="#cb21-332" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb21-333"><a href="#cb21-333" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-334"><a href="#cb21-334" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-335"><a href="#cb21-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data_sample)</span>
<span id="cb21-336"><a href="#cb21-336" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-337"><a href="#cb21-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-338"><a href="#cb21-338" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb21-339"><a href="#cb21-339" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb21-340"><a href="#cb21-340" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb21-341"><a href="#cb21-341" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb21-342"><a href="#cb21-342" aria-hidden="true" tabindex="-1"></a>start_x <span class="ot">&lt;-</span> <span class="dv">150</span></span>
<span id="cb21-343"><a href="#cb21-343" aria-hidden="true" tabindex="-1"></a>start_lambda <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb21-344"><a href="#cb21-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-345"><a href="#cb21-345" aria-hidden="true" tabindex="-1"></a><span class="co"># sample from conditional distributions</span></span>
<span id="cb21-346"><a href="#cb21-346" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed for all simulations</span></span>
<span id="cb21-347"><a href="#cb21-347" aria-hidden="true" tabindex="-1"></a>seed <span class="ot">&lt;-</span> <span class="dv">09222023</span></span>
<span id="cb21-348"><a href="#cb21-348" aria-hidden="true" tabindex="-1"></a>data_sample <span class="ot">&lt;-</span> <span class="fu">generate_sample1</span>(<span class="at">n =</span> n, <span class="at">alpha =</span> alpha, <span class="at">beta =</span> beta, <span class="at">start_x =</span> start_x, <span class="at">start_lambda =</span> start_lambda, <span class="at">seed =</span> seed)</span>
<span id="cb21-349"><a href="#cb21-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-350"><a href="#cb21-350" aria-hidden="true" tabindex="-1"></a><span class="co"># create data for scatterplot</span></span>
<span id="cb21-351"><a href="#cb21-351" aria-hidden="true" tabindex="-1"></a>data_scatter <span class="ot">&lt;-</span> data_sample <span class="sc">%&gt;%</span> </span>
<span id="cb21-352"><a href="#cb21-352" aria-hidden="true" tabindex="-1"></a>  data.frame <span class="sc">%&gt;%</span> </span>
<span id="cb21-353"><a href="#cb21-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(iteration <span class="sc">&gt;</span> n <span class="sc">-</span> <span class="dv">100</span>)</span>
<span id="cb21-354"><a href="#cb21-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-355"><a href="#cb21-355" aria-hidden="true" tabindex="-1"></a><span class="co"># set number of burn-in iterations</span></span>
<span id="cb21-356"><a href="#cb21-356" aria-hidden="true" tabindex="-1"></a>burn_in <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb21-357"><a href="#cb21-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-358"><a href="#cb21-358" aria-hidden="true" tabindex="-1"></a><span class="co"># remove burn-in iteration</span></span>
<span id="cb21-359"><a href="#cb21-359" aria-hidden="true" tabindex="-1"></a>data_sample2 <span class="ot">&lt;-</span> data_sample <span class="sc">%&gt;%</span> </span>
<span id="cb21-360"><a href="#cb21-360" aria-hidden="true" tabindex="-1"></a>  data.frame <span class="sc">%&gt;%</span> </span>
<span id="cb21-361"><a href="#cb21-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(iteration <span class="sc">&gt;</span> burn_in)</span>
<span id="cb21-362"><a href="#cb21-362" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-363"><a href="#cb21-363" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-364"><a href="#cb21-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-367"><a href="#cb21-367" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-368"><a href="#cb21-368" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: preview-sample1 </span></span>
<span id="cb21-369"><a href="#cb21-369" aria-hidden="true" tabindex="-1"></a><span class="co"># preview</span></span>
<span id="cb21-370"><a href="#cb21-370" aria-hidden="true" tabindex="-1"></a><span class="fu">display_nice</span>(data_sample2, <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Iteration"</span>, <span class="st">"$X$"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">lambda$"</span>))</span>
<span id="cb21-371"><a href="#cb21-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-372"><a href="#cb21-372" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-373"><a href="#cb21-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-376"><a href="#cb21-376" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-377"><a href="#cb21-377" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: diag-trace-plot</span></span>
<span id="cb21-378"><a href="#cb21-378" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Trace plot of generated X values" </span></span>
<span id="cb21-379"><a href="#cb21-379" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb21-380"><a href="#cb21-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-381"><a href="#cb21-381" aria-hidden="true" tabindex="-1"></a><span class="co"># check convergence with a trace plot</span></span>
<span id="cb21-382"><a href="#cb21-382" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; line plot of generated values across iterations</span></span>
<span id="cb21-383"><a href="#cb21-383" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb21-384"><a href="#cb21-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> iteration,</span>
<span id="cb21-385"><a href="#cb21-385" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> X),</span>
<span id="cb21-386"><a href="#cb21-386" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">data.frame</span>(data_sample),</span>
<span id="cb21-387"><a href="#cb21-387" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"grey"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb21-388"><a href="#cb21-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Iteration"</span>) <span class="sc">+</span> </span>
<span id="cb21-389"><a href="#cb21-389" aria-hidden="true" tabindex="-1"></a>  theme_swd</span>
<span id="cb21-390"><a href="#cb21-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-391"><a href="#cb21-391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-392"><a href="#cb21-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-393"><a href="#cb21-393" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">NOTE</span><span class="co">: figures don't have labels on the rendered version, not working for some reason when add fig-cap --&gt;</span></span>
<span id="cb21-394"><a href="#cb21-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-395"><a href="#cb21-395" aria-hidden="true" tabindex="-1"></a>@fig-diag-scatter-plot-x shows the last 100 sampled values for $X$ and @fig-diag-scatter-plot-lambda shows the last 100 sampled values for $\lambda$:</span>
<span id="cb21-396"><a href="#cb21-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-399"><a href="#cb21-399" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-400"><a href="#cb21-400" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-diag-scatter-plot-x</span></span>
<span id="cb21-401"><a href="#cb21-401" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Scatterplot of generated sample values of X"</span></span>
<span id="cb21-402"><a href="#cb21-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-403"><a href="#cb21-403" aria-hidden="true" tabindex="-1"></a><span class="co"># create scatterplots of last iterations to visually check for randomness</span></span>
<span id="cb21-404"><a href="#cb21-404" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb21-405"><a href="#cb21-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> iteration,</span>
<span id="cb21-406"><a href="#cb21-406" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> X),</span>
<span id="cb21-407"><a href="#cb21-407" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> data_scatter,</span>
<span id="cb21-408"><a href="#cb21-408" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">stroke =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb21-409"><a href="#cb21-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Iteration"</span>, <span class="at">y =</span> <span class="st">"x"</span>) <span class="sc">+</span> </span>
<span id="cb21-410"><a href="#cb21-410" aria-hidden="true" tabindex="-1"></a>  theme_swd</span>
<span id="cb21-411"><a href="#cb21-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-412"><a href="#cb21-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-413"><a href="#cb21-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-416"><a href="#cb21-416" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-417"><a href="#cb21-417" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-diag-scatter-plot-lambda</span></span>
<span id="cb21-418"><a href="#cb21-418" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Scatterplot of generated sample values of λ"</span></span>
<span id="cb21-419"><a href="#cb21-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-420"><a href="#cb21-420" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb21-421"><a href="#cb21-421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> iteration,</span>
<span id="cb21-422"><a href="#cb21-422" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> lambda),</span>
<span id="cb21-423"><a href="#cb21-423" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> data_scatter,</span>
<span id="cb21-424"><a href="#cb21-424" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">stroke =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb21-425"><a href="#cb21-425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Iteration"</span>,</span>
<span id="cb21-426"><a href="#cb21-426" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(lambda)) <span class="sc">+</span> </span>
<span id="cb21-427"><a href="#cb21-427" aria-hidden="true" tabindex="-1"></a>  theme_swd</span>
<span id="cb21-428"><a href="#cb21-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-429"><a href="#cb21-429" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-430"><a href="#cb21-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-431"><a href="#cb21-431" aria-hidden="true" tabindex="-1"></a>As one can see from @fig-diag-scatter-plot-x and @fig-diag-scatter-plot-lambda, there is no pattern among the generated random numbers. Therefore, they can be considered as independent random samples.</span>
<span id="cb21-432"><a href="#cb21-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-433"><a href="#cb21-433" aria-hidden="true" tabindex="-1"></a>Next, @fig-hist-x and @fig-hist-lambda show the histograms of the last 99,500 sampled values of $X$ and $\lambda$, respectively. These values are generated from dependent sampling schemes, which were based on the full conditional distributions of $f(x \mid \lambda)$ and $f(\lambda \mid x)$. The first 500 values of each sequence are discarded as these are considered to be the burn-in iterations. Additionally, the respective marginal density curves of $X$ and $\lambda$ are overlaid on their corresponding histogram.</span>
<span id="cb21-434"><a href="#cb21-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-437"><a href="#cb21-437" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-438"><a href="#cb21-438" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-hist-x</span></span>
<span id="cb21-439"><a href="#cb21-439" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Histogram of generated sample values of X"</span></span>
<span id="cb21-440"><a href="#cb21-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-441"><a href="#cb21-441" aria-hidden="true" tabindex="-1"></a><span class="co"># set maximum for x plot</span></span>
<span id="cb21-442"><a href="#cb21-442" aria-hidden="true" tabindex="-1"></a>limit_x <span class="ot">&lt;-</span> <span class="fu">quantile</span>(data_sample2<span class="sc">$</span>X, <span class="fl">0.995</span>)</span>
<span id="cb21-443"><a href="#cb21-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-444"><a href="#cb21-444" aria-hidden="true" tabindex="-1"></a><span class="co"># in order to get the correct legend that I want...</span></span>
<span id="cb21-445"><a href="#cb21-445" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; have to trick ggplot by adding another aesthetic to the desired geom (just map the correct aesthetic to a string constant of what I want it to say)</span></span>
<span id="cb21-446"><a href="#cb21-446" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; then do a scale_&lt;...&gt;_manual(values = "&lt; desired color &gt;")</span></span>
<span id="cb21-447"><a href="#cb21-447" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; also in a labs statement, make the name of label of that aesthetic an empty string</span></span>
<span id="cb21-448"><a href="#cb21-448" aria-hidden="true" tabindex="-1"></a><span class="co"># cannot do this trick more than once with the same aesthetic</span></span>
<span id="cb21-449"><a href="#cb21-449" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; so if need the legend for multiple things, they must be mapped to different aesthetics</span></span>
<span id="cb21-450"><a href="#cb21-450" aria-hidden="true" tabindex="-1"></a><span class="co"># create histogram of x with marginal density curve overlaid</span></span>
<span id="cb21-451"><a href="#cb21-451" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb21-452"><a href="#cb21-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> <span class="fu">after_stat</span>(density), <span class="at">fill =</span> <span class="st">"Sampled values"</span>),</span>
<span id="cb21-453"><a href="#cb21-453" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> data_sample2,</span>
<span id="cb21-454"><a href="#cb21-454" aria-hidden="true" tabindex="-1"></a>                 <span class="at">bins =</span> <span class="dv">40</span>,</span>
<span id="cb21-455"><a href="#cb21-455" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"grey60"</span>) <span class="sc">+</span></span>
<span id="cb21-456"><a href="#cb21-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">color =</span> <span class="st">"Actual density"</span>),</span>
<span id="cb21-457"><a href="#cb21-457" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, limit_x)),</span>
<span id="cb21-458"><a href="#cb21-458" aria-hidden="true" tabindex="-1"></a>                <span class="at">fun =</span> dpareto2, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">min =</span> <span class="dv">0</span>, <span class="at">shape =</span> alpha, <span class="at">scale =</span> beta), <span class="at">n =</span> <span class="dv">100000</span>,</span>
<span id="cb21-459"><a href="#cb21-459" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb21-460"><a href="#cb21-460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, limit_x)) <span class="sc">+</span></span>
<span id="cb21-461"><a href="#cb21-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb21-462"><a href="#cb21-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb21-463"><a href="#cb21-463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"x"</span>,</span>
<span id="cb21-464"><a href="#cb21-464" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">""</span>,</span>
<span id="cb21-465"><a href="#cb21-465" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb21-466"><a href="#cb21-466" aria-hidden="true" tabindex="-1"></a>  theme_swd</span>
<span id="cb21-467"><a href="#cb21-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-468"><a href="#cb21-468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-469"><a href="#cb21-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-472"><a href="#cb21-472" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-473"><a href="#cb21-473" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-hist-lambda</span></span>
<span id="cb21-474"><a href="#cb21-474" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Histogram of generated sample values of λ"</span></span>
<span id="cb21-475"><a href="#cb21-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-476"><a href="#cb21-476" aria-hidden="true" tabindex="-1"></a><span class="co"># create histogram of lambda with marginal density curve overlaid</span></span>
<span id="cb21-477"><a href="#cb21-477" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; no limits were made for lambda because there won't be huge outliers</span></span>
<span id="cb21-478"><a href="#cb21-478" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb21-479"><a href="#cb21-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> lambda, <span class="at">y =</span> <span class="fu">after_stat</span>(density), <span class="at">fill =</span> <span class="st">"Sampled values"</span>),</span>
<span id="cb21-480"><a href="#cb21-480" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> data_sample2,</span>
<span id="cb21-481"><a href="#cb21-481" aria-hidden="true" tabindex="-1"></a>                 <span class="at">bins =</span> <span class="dv">40</span>,</span>
<span id="cb21-482"><a href="#cb21-482" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"grey60"</span>) <span class="sc">+</span></span>
<span id="cb21-483"><a href="#cb21-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">color =</span> <span class="st">"Actual density"</span>),</span>
<span id="cb21-484"><a href="#cb21-484" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(data_sample2<span class="sc">$</span>lambda))),</span>
<span id="cb21-485"><a href="#cb21-485" aria-hidden="true" tabindex="-1"></a>                <span class="at">fun =</span> dgamma, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">shape =</span> alpha, <span class="at">rate =</span> beta), <span class="at">n =</span> <span class="dv">100000</span>,</span>
<span id="cb21-486"><a href="#cb21-486" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb21-487"><a href="#cb21-487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb21-488"><a href="#cb21-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb21-489"><a href="#cb21-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(lambda),</span>
<span id="cb21-490"><a href="#cb21-490" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">""</span>,</span>
<span id="cb21-491"><a href="#cb21-491" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb21-492"><a href="#cb21-492" aria-hidden="true" tabindex="-1"></a>  theme_swd</span>
<span id="cb21-493"><a href="#cb21-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-494"><a href="#cb21-494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-495"><a href="#cb21-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-496"><a href="#cb21-496" aria-hidden="true" tabindex="-1"></a>The marginal densities appear to line up very well with the sampled values, which indicates the implemented dependent sampling schemes have generated random samples from their respective marginal distributions.</span>
<span id="cb21-497"><a href="#cb21-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-498"><a href="#cb21-498" aria-hidden="true" tabindex="-1"></a>This is a property of Gibbs sampling. In effect, by taking very large random samples from the conditional posterior distributions, it appears as if the samples were taken from their respective marginal distributions. Thus, the generated random variates can be used to study the properties of the distribution of interest. With more complicated models, sampling from the marginal distributions directly would have been impossible; but with Gibbs sampling, it can be simulated. With these results in mind, we can formally state Gibbs sampling as:</span>
<span id="cb21-499"><a href="#cb21-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-500"><a href="#cb21-500" aria-hidden="true" tabindex="-1"></a>*The realization that as the number of iterations approaches infinity, the samples from the conditional posterior distributions converge to what the actual target distribution is that could not be sampled from directly.*</span>
<span id="cb21-501"><a href="#cb21-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-502"><a href="#cb21-502" aria-hidden="true" tabindex="-1"></a>Next, consider the following integral:</span>
<span id="cb21-503"><a href="#cb21-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-504"><a href="#cb21-504" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-505"><a href="#cb21-505" aria-hidden="true" tabindex="-1"></a>f(x) = \int f(x \mid \lambda) f(\lambda)\,d\lambda.</span>
<span id="cb21-506"><a href="#cb21-506" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-507"><a href="#cb21-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-508"><a href="#cb21-508" aria-hidden="true" tabindex="-1"></a>This states that the marginal distribution of $X$ can now be interpreted as the average of the conditional distribution of $X$ given $\lambda$ taken with respect to the marginal distribution of $\lambda$. This fact suggests that an estimate for the actual value of $f(x)$ at the point $x$ may be obtained by taking the simulated average of $f(x \mid \lambda)$ over the sampled values of $\lambda$, as shown in equation @eq-est-x.</span>
<span id="cb21-509"><a href="#cb21-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-510"><a href="#cb21-510" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-511"><a href="#cb21-511" aria-hidden="true" tabindex="-1"></a>f(\hat{x}) = \frac{1}{99,500}\sum_{i=500}^{100,000}f(x \mid \lambda_i).</span>
<span id="cb21-512"><a href="#cb21-512" aria-hidden="true" tabindex="-1"></a>$$ {#eq-est-x}</span>
<span id="cb21-513"><a href="#cb21-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-514"><a href="#cb21-514" aria-hidden="true" tabindex="-1"></a>A similar calculation can be done for $\lambda$.</span>
<span id="cb21-515"><a href="#cb21-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-516"><a href="#cb21-516" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-517"><a href="#cb21-517" aria-hidden="true" tabindex="-1"></a>f(\hat{\lambda}) = \frac{1}{99,500}\sum_{i=500}^{100,000}f(\lambda \mid x_i).</span>
<span id="cb21-518"><a href="#cb21-518" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-519"><a href="#cb21-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-520"><a href="#cb21-520" aria-hidden="true" tabindex="-1"></a>After solving for and plotting these estimated densities, direct models of their respective target distribution are revealed. The next two figures show this relationship.</span>
<span id="cb21-521"><a href="#cb21-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-524"><a href="#cb21-524" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-525"><a href="#cb21-525" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: solve-est-densities-x1</span></span>
<span id="cb21-526"><a href="#cb21-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-527"><a href="#cb21-527" aria-hidden="true" tabindex="-1"></a><span class="co"># function to solve for density estimates</span></span>
<span id="cb21-528"><a href="#cb21-528" aria-hidden="true" tabindex="-1"></a>estimate_density1 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">input_values =</span> <span class="dv">1</span>, <span class="at">given_values =</span> <span class="dv">1</span>, <span class="at">equation =</span> <span class="dv">1</span>) {</span>
<span id="cb21-529"><a href="#cb21-529" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-530"><a href="#cb21-530" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate density estimate</span></span>
<span id="cb21-531"><a href="#cb21-531" aria-hidden="true" tabindex="-1"></a>  density_estimate <span class="ot">&lt;-</span> <span class="fu">equation</span>(input_values, given_values) <span class="sc">%&gt;%</span> colMeans</span>
<span id="cb21-532"><a href="#cb21-532" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-533"><a href="#cb21-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-534"><a href="#cb21-534" aria-hidden="true" tabindex="-1"></a><span class="co"># function to perform calculations for x</span></span>
<span id="cb21-535"><a href="#cb21-535" aria-hidden="true" tabindex="-1"></a>density_x_given_lambda <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">X =</span> <span class="dv">1</span>, <span class="at">Lambda =</span> <span class="dv">1</span>) {</span>
<span id="cb21-536"><a href="#cb21-536" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-537"><a href="#cb21-537" aria-hidden="true" tabindex="-1"></a>  <span class="co"># specify density equation</span></span>
<span id="cb21-538"><a href="#cb21-538" aria-hidden="true" tabindex="-1"></a>  Lambda<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>Lambda<span class="sc">*</span>X)</span>
<span id="cb21-539"><a href="#cb21-539" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-540"><a href="#cb21-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-541"><a href="#cb21-541" aria-hidden="true" tabindex="-1"></a><span class="co"># function to perform calculations for lambda</span></span>
<span id="cb21-542"><a href="#cb21-542" aria-hidden="true" tabindex="-1"></a>density_lambda_given_x <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">Lambda =</span> <span class="dv">1</span>, <span class="at">X =</span> <span class="dv">1</span>) {</span>
<span id="cb21-543"><a href="#cb21-543" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-544"><a href="#cb21-544" aria-hidden="true" tabindex="-1"></a>  <span class="co"># specify density equation</span></span>
<span id="cb21-545"><a href="#cb21-545" aria-hidden="true" tabindex="-1"></a>  (((X <span class="sc">+</span> beta)<span class="sc">^</span>(alpha <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">*</span> (Lambda<span class="sc">^</span>alpha) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>Lambda <span class="sc">*</span> (X <span class="sc">+</span> beta))) <span class="sc">/</span> <span class="fu">gamma</span>(alpha <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb21-546"><a href="#cb21-546" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-547"><a href="#cb21-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-548"><a href="#cb21-548" aria-hidden="true" tabindex="-1"></a><span class="co"># set max for plot and calculate points to estimate density of x at (if is to make sure step isn't zero)</span></span>
<span id="cb21-549"><a href="#cb21-549" aria-hidden="true" tabindex="-1"></a>step_x <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">diff</span>(<span class="fu">range</span>(data_sample2<span class="sc">$</span>X)) <span class="sc">&gt;</span> <span class="dv">1</span>,</span>
<span id="cb21-550"><a href="#cb21-550" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">round</span>((<span class="fu">quantile</span>(data_sample2<span class="sc">$</span>X, <span class="fl">0.995</span>) <span class="sc">-</span> <span class="fu">min</span>(data_sample2<span class="sc">$</span>X))<span class="sc">/</span><span class="dv">40</span>, <span class="dv">5</span>) <span class="sc">%&gt;%</span> as.numeric, <span class="fl">0.01</span>)</span>
<span id="cb21-551"><a href="#cb21-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-552"><a href="#cb21-552" aria-hidden="true" tabindex="-1"></a><span class="co"># set maximum for lambda plot</span></span>
<span id="cb21-553"><a href="#cb21-553" aria-hidden="true" tabindex="-1"></a>limit_x <span class="ot">&lt;-</span> <span class="fu">quantile</span>(data_sample2<span class="sc">$</span>X, <span class="fl">0.995</span>)</span>
<span id="cb21-554"><a href="#cb21-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-555"><a href="#cb21-555" aria-hidden="true" tabindex="-1"></a><span class="co"># create matrices of data to be used for x</span></span>
<span id="cb21-556"><a href="#cb21-556" aria-hidden="true" tabindex="-1"></a>values_x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, limit_x, <span class="at">by =</span> step_x)</span>
<span id="cb21-557"><a href="#cb21-557" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> , values_x, <span class="at">nrow =</span> <span class="fu">nrow</span>(data_sample2), <span class="at">ncol =</span> <span class="fu">length</span>(values_x), <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-558"><a href="#cb21-558" aria-hidden="true" tabindex="-1"></a>Lambda1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> data_sample2<span class="sc">$</span>lambda, <span class="at">nrow =</span> <span class="fu">nrow</span>(data_sample2), <span class="at">ncol =</span> <span class="fu">ncol</span>(X1))</span>
<span id="cb21-559"><a href="#cb21-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-560"><a href="#cb21-560" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate density estimates for f(x)</span></span>
<span id="cb21-561"><a href="#cb21-561" aria-hidden="true" tabindex="-1"></a>data_estimated_x <span class="ot">&lt;-</span> <span class="fu">estimate_density1</span>(<span class="at">input_values =</span> X1, <span class="at">given_values =</span> Lambda1, <span class="at">equation =</span> density_x_given_lambda) <span class="sc">%&gt;%</span> </span>
<span id="cb21-562"><a href="#cb21-562" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">x =</span> values_x, <span class="at">f_x_hat =</span> .)</span>
<span id="cb21-563"><a href="#cb21-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-564"><a href="#cb21-564" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-565"><a href="#cb21-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-568"><a href="#cb21-568" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-569"><a href="#cb21-569" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: preview-estimated-x1</span></span>
<span id="cb21-570"><a href="#cb21-570" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb21-571"><a href="#cb21-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-572"><a href="#cb21-572" aria-hidden="true" tabindex="-1"></a><span class="co"># preview</span></span>
<span id="cb21-573"><a href="#cb21-573" aria-hidden="true" tabindex="-1"></a><span class="fu">display_nice</span>(data_estimated_x, <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"$x$"</span>, <span class="st">"$f</span><span class="sc">\\</span><span class="st">hat(x)$"</span>))</span>
<span id="cb21-574"><a href="#cb21-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-575"><a href="#cb21-575" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-576"><a href="#cb21-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-579"><a href="#cb21-579" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-580"><a href="#cb21-580" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: solve-est-densities-lambda1</span></span>
<span id="cb21-581"><a href="#cb21-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-582"><a href="#cb21-582" aria-hidden="true" tabindex="-1"></a><span class="co"># set max for plot and  calculate points to estimate density of lambda at (if is to make sure step isn't zero)</span></span>
<span id="cb21-583"><a href="#cb21-583" aria-hidden="true" tabindex="-1"></a>step_lambda <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">diff</span>(<span class="fu">range</span>(data_sample2<span class="sc">$</span>lambda)) <span class="sc">&gt;</span> <span class="dv">1</span>,</span>
<span id="cb21-584"><a href="#cb21-584" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">round</span>((<span class="fu">quantile</span>(data_sample2<span class="sc">$</span>lambda, <span class="fl">0.995</span>) <span class="sc">-</span> <span class="fu">min</span>(data_sample2<span class="sc">$</span>lambda))<span class="sc">/</span><span class="dv">40</span>, <span class="dv">5</span>) <span class="sc">%&gt;%</span> as.numeric, <span class="fl">0.01</span>)</span>
<span id="cb21-585"><a href="#cb21-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-586"><a href="#cb21-586" aria-hidden="true" tabindex="-1"></a><span class="co"># create matrices of data to be used for lambda</span></span>
<span id="cb21-587"><a href="#cb21-587" aria-hidden="true" tabindex="-1"></a>values_lambda <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">max</span>(data_sample2<span class="sc">$</span>lambda), <span class="at">by =</span> step_lambda)</span>
<span id="cb21-588"><a href="#cb21-588" aria-hidden="true" tabindex="-1"></a>Lambda2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> , values_lambda, <span class="at">nrow =</span> <span class="fu">nrow</span>(data_sample2), <span class="at">ncol =</span> <span class="fu">length</span>(values_lambda), <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-589"><a href="#cb21-589" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> data_sample2<span class="sc">$</span>X, <span class="at">nrow =</span> <span class="fu">nrow</span>(data_sample2), <span class="at">ncol =</span> <span class="fu">ncol</span>(Lambda2))</span>
<span id="cb21-590"><a href="#cb21-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-591"><a href="#cb21-591" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate density estimates for f(lambda)</span></span>
<span id="cb21-592"><a href="#cb21-592" aria-hidden="true" tabindex="-1"></a>data_estimated_lambda <span class="ot">&lt;-</span> <span class="fu">estimate_density1</span>(<span class="at">input_values =</span> Lambda2, <span class="at">given_values =</span> X2, density_lambda_given_x) <span class="sc">%&gt;%</span></span>
<span id="cb21-593"><a href="#cb21-593" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">lambda =</span> values_lambda, <span class="at">f_lambda_hat =</span> .)</span>
<span id="cb21-594"><a href="#cb21-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-595"><a href="#cb21-595" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-596"><a href="#cb21-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-599"><a href="#cb21-599" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-600"><a href="#cb21-600" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: preview-estimated-lambda1</span></span>
<span id="cb21-601"><a href="#cb21-601" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb21-602"><a href="#cb21-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-603"><a href="#cb21-603" aria-hidden="true" tabindex="-1"></a><span class="co"># preview</span></span>
<span id="cb21-604"><a href="#cb21-604" aria-hidden="true" tabindex="-1"></a><span class="fu">display_nice</span>(data_estimated_lambda, <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"$</span><span class="sc">\\</span><span class="st">lambda$"</span>, <span class="st">"$f</span><span class="sc">\\</span><span class="st">hat(</span><span class="sc">\\</span><span class="st">lambda)$"</span>))</span>
<span id="cb21-605"><a href="#cb21-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-606"><a href="#cb21-606" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-607"><a href="#cb21-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-610"><a href="#cb21-610" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-611"><a href="#cb21-611" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-est-density-x1</span></span>
<span id="cb21-612"><a href="#cb21-612" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Estimated and actual density of X"</span></span>
<span id="cb21-613"><a href="#cb21-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-614"><a href="#cb21-614" aria-hidden="true" tabindex="-1"></a><span class="co"># X plot</span></span>
<span id="cb21-615"><a href="#cb21-615" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; density estimates with marginal density curve overlaid</span></span>
<span id="cb21-616"><a href="#cb21-616" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb21-617"><a href="#cb21-617" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> f_x_hat, <span class="at">fill =</span> <span class="st">"Estimated density"</span>),</span>
<span id="cb21-618"><a href="#cb21-618" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> data_estimated_x,</span>
<span id="cb21-619"><a href="#cb21-619" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">stroke =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb21-620"><a href="#cb21-620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">color =</span> <span class="st">"Actual density"</span>),</span>
<span id="cb21-621"><a href="#cb21-621" aria-hidden="true" tabindex="-1"></a>                <span class="at">fun =</span> dpareto2, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">min =</span> <span class="dv">0</span>, <span class="at">shape =</span> alpha, <span class="at">scale =</span> beta),</span>
<span id="cb21-622"><a href="#cb21-622" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, limit_x)),<span class="at">n =</span> <span class="dv">100000</span>,</span>
<span id="cb21-623"><a href="#cb21-623" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb21-624"><a href="#cb21-624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, limit_x)) <span class="sc">+</span></span>
<span id="cb21-625"><a href="#cb21-625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb21-626"><a href="#cb21-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="st">"grey60"</span>) <span class="sc">+</span></span>
<span id="cb21-627"><a href="#cb21-627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"x"</span>,</span>
<span id="cb21-628"><a href="#cb21-628" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">f</span>(<span class="fu">hat</span>(x))),</span>
<span id="cb21-629"><a href="#cb21-629" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">""</span>,</span>
<span id="cb21-630"><a href="#cb21-630" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb21-631"><a href="#cb21-631" aria-hidden="true" tabindex="-1"></a>  theme_swd</span>
<span id="cb21-632"><a href="#cb21-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-633"><a href="#cb21-633" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-634"><a href="#cb21-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-637"><a href="#cb21-637" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-638"><a href="#cb21-638" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-est-density-lambda</span></span>
<span id="cb21-639"><a href="#cb21-639" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Estimated and actual density of  λ"</span></span>
<span id="cb21-640"><a href="#cb21-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-641"><a href="#cb21-641" aria-hidden="true" tabindex="-1"></a><span class="co"># Lambda plot</span></span>
<span id="cb21-642"><a href="#cb21-642" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; density estimates with marginal density curve overlaid</span></span>
<span id="cb21-643"><a href="#cb21-643" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb21-644"><a href="#cb21-644" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> lambda, <span class="at">y =</span> f_lambda_hat, <span class="at">fill =</span> <span class="st">"Estimated density"</span>),</span>
<span id="cb21-645"><a href="#cb21-645" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">stroke =</span> <span class="dv">1</span>,</span>
<span id="cb21-646"><a href="#cb21-646" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> data_estimated_lambda) <span class="sc">+</span></span>
<span id="cb21-647"><a href="#cb21-647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">color =</span> <span class="st">"Actual density"</span>),</span>
<span id="cb21-648"><a href="#cb21-648" aria-hidden="true" tabindex="-1"></a>                <span class="at">fun =</span> dgamma, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">shape =</span> alpha, <span class="at">rate =</span> beta),</span>
<span id="cb21-649"><a href="#cb21-649" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(data_sample2<span class="sc">$</span>lambda))),</span>
<span id="cb21-650"><a href="#cb21-650" aria-hidden="true" tabindex="-1"></a>                <span class="at">n =</span> <span class="dv">100000</span>, <span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb21-651"><a href="#cb21-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb21-652"><a href="#cb21-652" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="st">"grey60"</span>) <span class="sc">+</span></span>
<span id="cb21-653"><a href="#cb21-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(lambda),</span>
<span id="cb21-654"><a href="#cb21-654" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">f</span>(<span class="fu">hat</span>(lambda))),</span>
<span id="cb21-655"><a href="#cb21-655" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">""</span>,</span>
<span id="cb21-656"><a href="#cb21-656" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb21-657"><a href="#cb21-657" aria-hidden="true" tabindex="-1"></a>  theme_swd</span>
<span id="cb21-658"><a href="#cb21-658" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-659"><a href="#cb21-659" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-660"><a href="#cb21-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-661"><a href="#cb21-661" aria-hidden="true" tabindex="-1"></a>@fig-est-density-x1 shows the plotted points of $f(\hat{x})$ with its known function $f(x)$ overlaid. @fig-est-density-lambda shows the same information except for $\lambda$. As one can see on both figures, the estimated densities happen to be excellent representations of the actual densities. If looking at a more complicated model where the target distribution cannot be solved for in closed form, there is now methods to solve for and study a random sample from an unknown distribution.</span>
<span id="cb21-662"><a href="#cb21-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-663"><a href="#cb21-663" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modeling Number of Claims</span></span>
<span id="cb21-664"><a href="#cb21-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-665"><a href="#cb21-665" aria-hidden="true" tabindex="-1"></a>Actuaries often try to model the number of claims to be filed for a certain book of business. These books contain many individual policies, each with similar risk characteristics. These characteristics contribute to the probability that a claim is filed. Therefore, each book of business, which we will refer to as a portfolio, contains many policies that have a similar probability of filing a claim. This is done to allow for analyses to be completed on the group as a whole, rather than on each individual policy.</span>
<span id="cb21-666"><a href="#cb21-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-667"><a href="#cb21-667" aria-hidden="true" tabindex="-1"></a>In order to model the number of claims for a portfolio, let claim probability $P$ (as a random variable) follow a beta distribution with parameters $\alpha$ and $\beta$.</span>
<span id="cb21-668"><a href="#cb21-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-669"><a href="#cb21-669" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-670"><a href="#cb21-670" aria-hidden="true" tabindex="-1"></a>f(p) = \frac{\Gamma(\alpha+\beta)}{\Gamma(\alpha) \Gamma(\beta)} p^{\alpha-1} (1-p)^{\beta-1},\hspace{10pt} 0 \le p \le 1.</span>
<span id="cb21-671"><a href="#cb21-671" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-672"><a href="#cb21-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-673"><a href="#cb21-673" aria-hidden="true" tabindex="-1"></a>It is a common practice to model claim probability $P$ with a beta distribution, where the values are bounded between zero and one. In practice, distributions for probabilities of filing a claim ($P$) are skewed to the right allowing higher chances for smaller $P$'s and increasingly lower chances for higher $P$'s. The skewness of the beta distribution can easily be controlled with correctly chosen parameters $\alpha$ and $\beta$. Next, we have to model the number of policies within a certain portfolio. To do this, the Poisson distribution is widely used. However, we are going to modify it slightly. By truncating the random variable at zero (zero truncated Poisson distribution), we can ensure that the portfolio has at least one policy. Now, the total number of policies within a portfolio $N$ can be written as</span>
<span id="cb21-674"><a href="#cb21-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-675"><a href="#cb21-675" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-676"><a href="#cb21-676" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb21-677"><a href="#cb21-677" aria-hidden="true" tabindex="-1"></a>f(n) &amp;= \frac{P(N=n\mid N&gt;0)}{1-P(N=0)}\nonumber<span class="sc">\\</span></span>
<span id="cb21-678"><a href="#cb21-678" aria-hidden="true" tabindex="-1"></a>&amp;= (e^{-\lambda}-1) \frac{\lambda^n}{n!},\hspace{10pt} n=1,2,3,\ldots.</span>
<span id="cb21-679"><a href="#cb21-679" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb21-680"><a href="#cb21-680" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-681"><a href="#cb21-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-682"><a href="#cb21-682" aria-hidden="true" tabindex="-1"></a>Next, let's focus on the number of policies that file a claim. Assuming that filing a claim for a policy is independent and that the probability of filing a claim is constant throughout the lifetime of the policy, the number of policies that file a claim $X$ can be modeled using a binomial distribution with parameters $N$ and $P$. Thus, we have</span>
<span id="cb21-683"><a href="#cb21-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-684"><a href="#cb21-684" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-685"><a href="#cb21-685" aria-hidden="true" tabindex="-1"></a>f(x \mid p,n) = \binom nx p^x (1-p)^{n-x},\hspace{10pt} x = 0,1,2,\ldots,n.</span>
<span id="cb21-686"><a href="#cb21-686" aria-hidden="true" tabindex="-1"></a>$$ {#eq-conditional-x-given-np}</span>
<span id="cb21-687"><a href="#cb21-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-688"><a href="#cb21-688" aria-hidden="true" tabindex="-1"></a>This is a well chosen distribution as it incorporates both of our previous random variates as parameters. It follows that the random variable $X$ can now be interpreted as the number of policies that generate a claim in a portfolio of $N$ identical and independent policies, each with a claim probability equal to $P$. Most often actuaries are less interested in the conditional distribution of the variable of interest, but rather the marginal distribution. This is because the marginal distribution of our random variate $X$ describes the typical number of policies generating a claim within an arbitrary portfolio; this is much more informative for them. However, $f(x)$ cannot be obtained in closed form in this particular model. Gibbs sampling is one possible solution for this problem.</span>
<span id="cb21-689"><a href="#cb21-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-690"><a href="#cb21-690" aria-hidden="true" tabindex="-1"></a>As shown earlier, the first step of Gibbs sampling is to find the conditional distributions of each random variable. These are derived as follows:</span>
<span id="cb21-691"><a href="#cb21-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-692"><a href="#cb21-692" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-693"><a href="#cb21-693" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb21-694"><a href="#cb21-694" aria-hidden="true" tabindex="-1"></a>f(x,p,n) &amp;= f(x\mid p,n) f(p) f(n)<span class="sc">\\</span></span>
<span id="cb21-695"><a href="#cb21-695" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{\binom nx p^{x+\alpha-1} (1-p)^{n+\beta-x-1} \Gamma(\alpha+\beta) \lambda^n}{\Gamma(\alpha) \Gamma(\beta) (e^\lambda-1)n!}</span>
<span id="cb21-696"><a href="#cb21-696" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb21-697"><a href="#cb21-697" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-698"><a href="#cb21-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-699"><a href="#cb21-699" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-700"><a href="#cb21-700" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb21-701"><a href="#cb21-701" aria-hidden="true" tabindex="-1"></a>f(x,n) &amp;= \int_0^1\ f(x,p,n)\,dp<span class="sc">\\</span></span>
<span id="cb21-702"><a href="#cb21-702" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{\Gamma(\alpha+\beta) \lambda^n \binom nx \Gamma(x+\alpha) \Gamma(n+\beta-x)}{\Gamma(\alpha) \Gamma(\beta) n! (e^\lambda-1) \Gamma(n+\alpha+\beta)}</span>
<span id="cb21-703"><a href="#cb21-703" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb21-704"><a href="#cb21-704" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-705"><a href="#cb21-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-706"><a href="#cb21-706" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-707"><a href="#cb21-707" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb21-708"><a href="#cb21-708" aria-hidden="true" tabindex="-1"></a>f(p\mid x,n) &amp;= \frac{f(x,p,n)}{f(x,n)}<span class="sc">\\</span></span>
<span id="cb21-709"><a href="#cb21-709" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{\Gamma(n+\alpha+\beta)}{\Gamma(x+\alpha) \Gamma(n+\beta-x)} p^{(x+\alpha)-1} (1-p)^{(n+\beta-x)-1}<span class="sc">\\</span></span>
<span id="cb21-710"><a href="#cb21-710" aria-hidden="true" tabindex="-1"></a>&amp;\sim \text{beta}\,(x+\alpha, n+\beta-x)</span>
<span id="cb21-711"><a href="#cb21-711" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb21-712"><a href="#cb21-712" aria-hidden="true" tabindex="-1"></a>$$ {#eq-conditional-p-given-xn}</span>
<span id="cb21-713"><a href="#cb21-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-714"><a href="#cb21-714" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-715"><a href="#cb21-715" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb21-716"><a href="#cb21-716" aria-hidden="true" tabindex="-1"></a>f(x,p) &amp;= \sum_{n=1}^\infty f(x,p,n)<span class="sc">\\</span></span>
<span id="cb21-717"><a href="#cb21-717" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{p^{x+\alpha-1} \Gamma(\alpha+\beta) p^{\beta-1} \lambda^x (e^\lambda-1) \Gamma(\alpha) \Gamma(\beta) x! e^{\lambda(1-p)}}{\Gamma(\alpha) \Gamma(\beta) (e^\lambda-1) n!}</span>
<span id="cb21-718"><a href="#cb21-718" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb21-719"><a href="#cb21-719" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-720"><a href="#cb21-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-721"><a href="#cb21-721" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-722"><a href="#cb21-722" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb21-723"><a href="#cb21-723" aria-hidden="true" tabindex="-1"></a>f(n\mid x,p) &amp;= \frac{f(x,p,n)}{f(x,p)}<span class="sc">\\</span></span>
<span id="cb21-724"><a href="#cb21-724" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{e^{-\lambda(1-p)} (\lambda(1-p))^{n-x}}{(n-x)!}\hspace{10pt}n = x,x+1,x+2,\ldots<span class="sc">\\</span></span>
<span id="cb21-725"><a href="#cb21-725" aria-hidden="true" tabindex="-1"></a>&amp;\sim \text{Poisson}\,(\lambda(1-p)).</span>
<span id="cb21-726"><a href="#cb21-726" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb21-727"><a href="#cb21-727" aria-hidden="true" tabindex="-1"></a>$$ {#eq-conditional-n-given-xp}</span>
<span id="cb21-728"><a href="#cb21-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-729"><a href="#cb21-729" aria-hidden="true" tabindex="-1"></a>Note that the distribution $f(p\mid x,n)$ follows a beta distribution with parameters $x+\alpha$ and $n+\beta-x$, as shown in equation @eq-conditional-p-given-xn. Additionally, the conditional distribution of $N$ follows a Poisson distribution with parameter $\lambda(1-p)$, which is shown in equation @eq-conditional-n-given-xp. In order to implement Gibbs sampling, we simply need to initialize the variables. For the purposes of illustration, we select $\alpha = 2$ (weight on $p$) and $\beta = 8$ (weight on $1-p$). This makes the distribution in equation @eq-conditional-p-given-xn right skewed. Furthermore, we assume the average number of policies within a portfolio is 12 ($\lambda = 12$). Next, we run a loop to generate $10,000$ random numbers from each of the full conditional distributions. We then discard the first $500$ values of each sampling path in order to burn-in Gibbs sampling.</span>
<span id="cb21-730"><a href="#cb21-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-731"><a href="#cb21-731" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">NOTE</span><span class="co">: overwriting previous functions and objects, just chuck labels need to be different --&gt;</span></span>
<span id="cb21-732"><a href="#cb21-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-735"><a href="#cb21-735" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-736"><a href="#cb21-736" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: generate-data2</span></span>
<span id="cb21-737"><a href="#cb21-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-738"><a href="#cb21-738" aria-hidden="true" tabindex="-1"></a><span class="co"># function to generate random data from conditional distributions</span></span>
<span id="cb21-739"><a href="#cb21-739" aria-hidden="true" tabindex="-1"></a>generate_sample <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">k =</span> <span class="dv">10000</span>, <span class="at">alpha =</span> <span class="dv">5</span>, <span class="at">beta =</span> <span class="dv">8</span>, <span class="at">lambda =</span> <span class="dv">12</span>, </span>
<span id="cb21-740"><a href="#cb21-740" aria-hidden="true" tabindex="-1"></a>                            <span class="at">start_x =</span> <span class="dv">5</span>, <span class="at">start_p =</span> <span class="fl">0.5</span>, <span class="at">start_n =</span> <span class="dv">15</span>, <span class="at">seed =</span> <span class="dv">0</span>) {</span>
<span id="cb21-741"><a href="#cb21-741" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-742"><a href="#cb21-742" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create matrix</span></span>
<span id="cb21-743"><a href="#cb21-743" aria-hidden="true" tabindex="-1"></a>  data_sample <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> k, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="cn">NULL</span>, <span class="fu">c</span>(<span class="st">"iteration"</span>, <span class="st">"X"</span>, <span class="st">"p"</span>, <span class="st">"n"</span>)))</span>
<span id="cb21-744"><a href="#cb21-744" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-745"><a href="#cb21-745" aria-hidden="true" tabindex="-1"></a>  <span class="co"># conditionally set random seed</span></span>
<span id="cb21-746"><a href="#cb21-746" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (seed <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="fu">set.seed</span>(seed)</span>
<span id="cb21-747"><a href="#cb21-747" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-748"><a href="#cb21-748" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize counter and starting values</span></span>
<span id="cb21-749"><a href="#cb21-749" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb21-750"><a href="#cb21-750" aria-hidden="true" tabindex="-1"></a>  data_sample[i, ] <span class="ot">=</span> <span class="fu">c</span>(i, start_x, start_p, start_n)</span>
<span id="cb21-751"><a href="#cb21-751" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-752"><a href="#cb21-752" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate new data for x, p and n based on sequentially updated conditional distributions</span></span>
<span id="cb21-753"><a href="#cb21-753" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (i <span class="sc">&lt;</span> k) {</span>
<span id="cb21-754"><a href="#cb21-754" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-755"><a href="#cb21-755" aria-hidden="true" tabindex="-1"></a>    <span class="co"># record iteration</span></span>
<span id="cb21-756"><a href="#cb21-756" aria-hidden="true" tabindex="-1"></a>    data_sample[i <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"iteration"</span>] <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb21-757"><a href="#cb21-757" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-758"><a href="#cb21-758" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sample from x | p , n</span></span>
<span id="cb21-759"><a href="#cb21-759" aria-hidden="true" tabindex="-1"></a>    data_sample[i <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"X"</span>] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">size =</span> data_sample[i, <span class="st">"n"</span>], <span class="at">prob =</span> data_sample[i, <span class="st">"p"</span>])</span>
<span id="cb21-760"><a href="#cb21-760" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-761"><a href="#cb21-761" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sample from p | x , n</span></span>
<span id="cb21-762"><a href="#cb21-762" aria-hidden="true" tabindex="-1"></a>    data_sample[i <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"p"</span>] <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">shape1 =</span> data_sample[i <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"X"</span>] <span class="sc">+</span> alpha, <span class="at">shape2 =</span> data_sample[i, <span class="st">"n"</span>] <span class="sc">+</span> beta <span class="sc">-</span> data_sample[i <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"X"</span>])</span>
<span id="cb21-763"><a href="#cb21-763" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-764"><a href="#cb21-764" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sample from n - x | x , p and then calculate final n = (n - x) + x</span></span>
<span id="cb21-765"><a href="#cb21-765" aria-hidden="true" tabindex="-1"></a>    data_sample[i <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"n"</span>] <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">lambda =</span> lambda <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> data_sample[i <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"p"</span>])) <span class="sc">+</span> data_sample[i <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"X"</span>]</span>
<span id="cb21-766"><a href="#cb21-766" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-767"><a href="#cb21-767" aria-hidden="true" tabindex="-1"></a>    <span class="co"># increase counter</span></span>
<span id="cb21-768"><a href="#cb21-768" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb21-769"><a href="#cb21-769" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-770"><a href="#cb21-770" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-771"><a href="#cb21-771" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data_sample)</span>
<span id="cb21-772"><a href="#cb21-772" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-773"><a href="#cb21-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-774"><a href="#cb21-774" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb21-775"><a href="#cb21-775" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb21-776"><a href="#cb21-776" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb21-777"><a href="#cb21-777" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb21-778"><a href="#cb21-778" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb21-779"><a href="#cb21-779" aria-hidden="true" tabindex="-1"></a>start_x <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb21-780"><a href="#cb21-780" aria-hidden="true" tabindex="-1"></a>start_p <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb21-781"><a href="#cb21-781" aria-hidden="true" tabindex="-1"></a>start_n <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb21-782"><a href="#cb21-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-783"><a href="#cb21-783" aria-hidden="true" tabindex="-1"></a><span class="co"># sample from conditional distributions</span></span>
<span id="cb21-784"><a href="#cb21-784" aria-hidden="true" tabindex="-1"></a>data_sample <span class="ot">&lt;-</span> <span class="fu">generate_sample</span>(<span class="at">k =</span> k, <span class="at">alpha =</span> alpha, <span class="at">beta =</span> beta, <span class="at">lambda =</span> lambda, <span class="at">start_x =</span> start_x, <span class="at">start_p =</span> start_p, <span class="at">start_n =</span> start_n, <span class="at">seed =</span> seed)</span>
<span id="cb21-785"><a href="#cb21-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-786"><a href="#cb21-786" aria-hidden="true" tabindex="-1"></a><span class="co"># set number of burn-in iterations</span></span>
<span id="cb21-787"><a href="#cb21-787" aria-hidden="true" tabindex="-1"></a>burn_in <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb21-788"><a href="#cb21-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-789"><a href="#cb21-789" aria-hidden="true" tabindex="-1"></a><span class="co"># remove burn-in iteration</span></span>
<span id="cb21-790"><a href="#cb21-790" aria-hidden="true" tabindex="-1"></a>data_sample2 <span class="ot">&lt;-</span> data_sample <span class="sc">%&gt;%</span> </span>
<span id="cb21-791"><a href="#cb21-791" aria-hidden="true" tabindex="-1"></a>  data.frame <span class="sc">%&gt;%</span> </span>
<span id="cb21-792"><a href="#cb21-792" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(iteration <span class="sc">&gt;</span> burn_in)</span>
<span id="cb21-793"><a href="#cb21-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-794"><a href="#cb21-794" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-795"><a href="#cb21-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-798"><a href="#cb21-798" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-799"><a href="#cb21-799" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: preview-sample2</span></span>
<span id="cb21-800"><a href="#cb21-800" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb21-801"><a href="#cb21-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-802"><a href="#cb21-802" aria-hidden="true" tabindex="-1"></a><span class="co"># preview</span></span>
<span id="cb21-803"><a href="#cb21-803" aria-hidden="true" tabindex="-1"></a><span class="fu">display_nice</span>(data_sample2, <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Iteration"</span>, <span class="st">"$X$"</span>, <span class="st">"$N$"</span> ,<span class="st">"$P$"</span>))</span>
<span id="cb21-804"><a href="#cb21-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-805"><a href="#cb21-805" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-806"><a href="#cb21-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-807"><a href="#cb21-807" aria-hidden="true" tabindex="-1"></a>The output of this simulation is an approximately independent random sample from each of the conditional distributions $f(n \mid x,p)$, $f(p \mid x, n)$, and $f(x \mid p, n)$. We are interested in studying the distribution of $f(x)$, which as noted earlier could not be found in closed form. However, by averaging equation @eq-conditional-x-given-np over the simulated values $P^{(i)}$ and $N^{(i)}$, a density estimate for the random variable $X$ can be obtained. In other words, the estimated value of the density of $f(x)$ at the point $x$ is given by</span>
<span id="cb21-808"><a href="#cb21-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-809"><a href="#cb21-809" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-810"><a href="#cb21-810" aria-hidden="true" tabindex="-1"></a>f(\hat{x})=\frac{1}{9,500}\sum_{i=501}^{10,000}f(x\mid p^{(i)},n^{(i)}).</span>
<span id="cb21-811"><a href="#cb21-811" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-812"><a href="#cb21-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-815"><a href="#cb21-815" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-816"><a href="#cb21-816" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: solve-est-density2</span></span>
<span id="cb21-817"><a href="#cb21-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-818"><a href="#cb21-818" aria-hidden="true" tabindex="-1"></a><span class="co"># function to solve for density estimates</span></span>
<span id="cb21-819"><a href="#cb21-819" aria-hidden="true" tabindex="-1"></a>estimate_density <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">input_values =</span> <span class="dv">1</span>, <span class="at">given_values1 =</span> <span class="dv">1</span>, <span class="at">given_values2 =</span> <span class="dv">1</span>, <span class="at">equation =</span> <span class="dv">1</span>) {</span>
<span id="cb21-820"><a href="#cb21-820" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-821"><a href="#cb21-821" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate density estimate</span></span>
<span id="cb21-822"><a href="#cb21-822" aria-hidden="true" tabindex="-1"></a>  density_estimate <span class="ot">=</span> <span class="fu">equation</span>(input_values, given_values1, given_values2) <span class="sc">%&gt;%</span> colMeans</span>
<span id="cb21-823"><a href="#cb21-823" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-824"><a href="#cb21-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-825"><a href="#cb21-825" aria-hidden="true" tabindex="-1"></a><span class="co"># function to perform calculations for x</span></span>
<span id="cb21-826"><a href="#cb21-826" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; x is technically a pmf</span></span>
<span id="cb21-827"><a href="#cb21-827" aria-hidden="true" tabindex="-1"></a>density_x_given_p_and_n <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">X =</span> <span class="dv">1</span>, <span class="at">P =</span> <span class="fl">0.5</span>, <span class="at">N =</span> <span class="dv">1</span>) {</span>
<span id="cb21-828"><a href="#cb21-828" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-829"><a href="#cb21-829" aria-hidden="true" tabindex="-1"></a>  <span class="co"># specify density equation</span></span>
<span id="cb21-830"><a href="#cb21-830" aria-hidden="true" tabindex="-1"></a>  <span class="fu">choose</span>(N, X) <span class="sc">*</span> P<span class="sc">^</span>X <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> P)<span class="sc">^</span>(N <span class="sc">-</span> X)</span>
<span id="cb21-831"><a href="#cb21-831" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-832"><a href="#cb21-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-833"><a href="#cb21-833" aria-hidden="true" tabindex="-1"></a><span class="co"># determine step size for x values</span></span>
<span id="cb21-834"><a href="#cb21-834" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">diff</span>(<span class="fu">range</span>(data_sample2<span class="sc">$</span>X)) <span class="sc">&gt;</span> <span class="dv">75</span>) {</span>
<span id="cb21-835"><a href="#cb21-835" aria-hidden="true" tabindex="-1"></a>  step <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb21-836"><a href="#cb21-836" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb21-837"><a href="#cb21-837" aria-hidden="true" tabindex="-1"></a>  step <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb21-838"><a href="#cb21-838" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-839"><a href="#cb21-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-840"><a href="#cb21-840" aria-hidden="true" tabindex="-1"></a><span class="co"># create matrices of data to be used for x</span></span>
<span id="cb21-841"><a href="#cb21-841" aria-hidden="true" tabindex="-1"></a>values_x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">max</span>(data_sample2<span class="sc">$</span>X), <span class="at">by =</span> step)</span>
<span id="cb21-842"><a href="#cb21-842" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> , values_x, <span class="at">nrow =</span> <span class="fu">nrow</span>(data_sample2), <span class="at">ncol =</span> <span class="fu">length</span>(values_x), <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-843"><a href="#cb21-843" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> data_sample2<span class="sc">$</span>p, <span class="at">nrow =</span> <span class="fu">nrow</span>(data_sample2), <span class="at">ncol =</span> <span class="fu">ncol</span>(X))</span>
<span id="cb21-844"><a href="#cb21-844" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> data_sample2<span class="sc">$</span>n, <span class="at">nrow =</span> <span class="fu">nrow</span>(data_sample2), <span class="at">ncol =</span> <span class="fu">ncol</span>(X))</span>
<span id="cb21-845"><a href="#cb21-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-846"><a href="#cb21-846" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate density estimates for f(x) and scale so that probabilities sum to one</span></span>
<span id="cb21-847"><a href="#cb21-847" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; with a step of 1, it is always super close to 1</span></span>
<span id="cb21-848"><a href="#cb21-848" aria-hidden="true" tabindex="-1"></a><span class="co"># --&gt; but if use a different step size, need to scale probabilities</span></span>
<span id="cb21-849"><a href="#cb21-849" aria-hidden="true" tabindex="-1"></a>data_estimated_x <span class="ot">&lt;-</span> <span class="fu">estimate_density</span>(<span class="at">input_values =</span> X, <span class="at">given_values1 =</span> P, <span class="at">given_values2 =</span> N, <span class="at">equation =</span> density_x_given_p_and_n) <span class="sc">%&gt;%</span> </span>
<span id="cb21-850"><a href="#cb21-850" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">x =</span> values_x, <span class="at">f_x_hat =</span> .) <span class="sc">%&gt;%</span> </span>
<span id="cb21-851"><a href="#cb21-851" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">f_x_hat =</span> f_x_hat<span class="sc">/</span><span class="fu">sum</span>(f_x_hat))</span>
<span id="cb21-852"><a href="#cb21-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-853"><a href="#cb21-853" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-854"><a href="#cb21-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-857"><a href="#cb21-857" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-858"><a href="#cb21-858" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: preview-estimated-x2</span></span>
<span id="cb21-859"><a href="#cb21-859" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb21-860"><a href="#cb21-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-861"><a href="#cb21-861" aria-hidden="true" tabindex="-1"></a><span class="co"># preview</span></span>
<span id="cb21-862"><a href="#cb21-862" aria-hidden="true" tabindex="-1"></a><span class="fu">display_nice</span>(data_estimated_x, <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"$x$"</span>, <span class="st">"$f</span><span class="sc">\\</span><span class="st">hat(x)$"</span>))</span>
<span id="cb21-863"><a href="#cb21-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-864"><a href="#cb21-864" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-865"><a href="#cb21-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-868"><a href="#cb21-868" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-869"><a href="#cb21-869" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-est-density-x2</span></span>
<span id="cb21-870"><a href="#cb21-870" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Estimated density of X"</span></span>
<span id="cb21-871"><a href="#cb21-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-872"><a href="#cb21-872" aria-hidden="true" tabindex="-1"></a><span class="co"># function to calculate mean of discrete probability distribution</span></span>
<span id="cb21-873"><a href="#cb21-873" aria-hidden="true" tabindex="-1"></a>calc_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">p_x =</span> <span class="dv">1</span>) {</span>
<span id="cb21-874"><a href="#cb21-874" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(x <span class="sc">*</span> p_x)</span>
<span id="cb21-875"><a href="#cb21-875" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-876"><a href="#cb21-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-877"><a href="#cb21-877" aria-hidden="true" tabindex="-1"></a><span class="co"># function to calculate variance of discrete probability distribution</span></span>
<span id="cb21-878"><a href="#cb21-878" aria-hidden="true" tabindex="-1"></a>calc_var <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">p_x =</span> <span class="dv">1</span>) {</span>
<span id="cb21-879"><a href="#cb21-879" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate mean</span></span>
<span id="cb21-880"><a href="#cb21-880" aria-hidden="true" tabindex="-1"></a>  mean <span class="ot">&lt;-</span> <span class="fu">sum</span>(x <span class="sc">*</span> p_x)</span>
<span id="cb21-881"><a href="#cb21-881" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate variance</span></span>
<span id="cb21-882"><a href="#cb21-882" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(((x <span class="sc">-</span> mean)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> p_x)</span>
<span id="cb21-883"><a href="#cb21-883" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-884"><a href="#cb21-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-885"><a href="#cb21-885" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate mean</span></span>
<span id="cb21-886"><a href="#cb21-886" aria-hidden="true" tabindex="-1"></a>x_mean <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">calc_mean</span>(<span class="at">x =</span> data_estimated_x<span class="sc">$</span>x, <span class="at">p_x =</span> data_estimated_x<span class="sc">$</span>f_x_hat), <span class="dv">3</span>)</span>
<span id="cb21-887"><a href="#cb21-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-888"><a href="#cb21-888" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate variance</span></span>
<span id="cb21-889"><a href="#cb21-889" aria-hidden="true" tabindex="-1"></a>x_var <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">calc_var</span>(<span class="at">x =</span> data_estimated_x<span class="sc">$</span>x, <span class="at">p_x =</span> data_estimated_x<span class="sc">$</span>f_x_hat), <span class="dv">3</span>)</span>
<span id="cb21-890"><a href="#cb21-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-891"><a href="#cb21-891" aria-hidden="true" tabindex="-1"></a><span class="co"># X plot</span></span>
<span id="cb21-892"><a href="#cb21-892" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; density estimates with marginal density curve overlaid</span></span>
<span id="cb21-893"><a href="#cb21-893" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb21-894"><a href="#cb21-894" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> f_x_hat, <span class="at">fill =</span> <span class="st">"Estimated density"</span>),</span>
<span id="cb21-895"><a href="#cb21-895" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> data_estimated_x,</span>
<span id="cb21-896"><a href="#cb21-896" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">stroke =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb21-897"><a href="#cb21-897" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">ymax =</span> f_x_hat),</span>
<span id="cb21-898"><a href="#cb21-898" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> data_estimated_x,</span>
<span id="cb21-899"><a href="#cb21-899" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ymin =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb21-900"><a href="#cb21-900" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb21-901"><a href="#cb21-901" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"mean = "</span>, x_mean, <span class="st">"</span><span class="sc">\n</span><span class="st">var = "</span>, x_var),</span>
<span id="cb21-902"><a href="#cb21-902" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span>,</span>
<span id="cb21-903"><a href="#cb21-903" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb21-904"><a href="#cb21-904" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb21-905"><a href="#cb21-905" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"x"</span>,</span>
<span id="cb21-906"><a href="#cb21-906" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(<span class="fu">f</span>(x))),</span>
<span id="cb21-907"><a href="#cb21-907" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb21-908"><a href="#cb21-908" aria-hidden="true" tabindex="-1"></a>  theme_swd</span>
<span id="cb21-909"><a href="#cb21-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-910"><a href="#cb21-910" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-911"><a href="#cb21-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-912"><a href="#cb21-912" aria-hidden="true" tabindex="-1"></a>A plot of this density estimate appears in .... From this, actuaries can compute many statistics for a portfolio with parameters $p$ and $n$. These can then be used to more accurately predict the number of claims expected for the future. For example, the expected value of $X$ can be found; in this case, $E(X)$ = <span class="in">`r x_mean`</span> claims. Combined with a model of the size of a typical claim, this statistic can tell an insurer the amount of loss they expect per policy (in dollars). Another statistic that can be found is the variance of $X$. This tells the average risk of each portfolio. If a group of policies has a large variance, then there could potentially be a large number of claims. This implies a higher risk, which means this particular group of policies likely will have a higher premium. For this model, $Var(X)$ = <span class="in">`r x_var`</span>.</span>
<span id="cb21-913"><a href="#cb21-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-914"><a href="#cb21-914" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modeling Size of Claim</span></span>
<span id="cb21-915"><a href="#cb21-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-916"><a href="#cb21-916" aria-hidden="true" tabindex="-1"></a>In contrast to the previous model, which dealt with the number of claims, this one deals with the size of claims (i.e. loss amounts). Loss distributions have high probabilities for lower values and a long tail to allow for large claims, however with an increasingly smaller probability. A widely used distribution to model loss is the Pareto distribution. It incorporates parameters $\lambda$ and $\theta$ and has the following density function:</span>
<span id="cb21-917"><a href="#cb21-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-918"><a href="#cb21-918" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-919"><a href="#cb21-919" aria-hidden="true" tabindex="-1"></a>f(x \mid \theta) = \frac{\theta \lambda^\theta}{(\lambda+x)^{\theta+1}}, \hspace{10pt} x &gt; 0.</span>
<span id="cb21-920"><a href="#cb21-920" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-921"><a href="#cb21-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-922"><a href="#cb21-922" aria-hidden="true" tabindex="-1"></a>Note that this distribution is a variation of the Pareto distribution called a Lomax distribution. It is essentially the same, however it has been shifted so that the support set begins at zero. To simplify the presentation, we assume that the parameter $\lambda$ is known to be 7,000 so that the only uncertainty is with respect to the value of the parameter $\theta$. Therefore, the prior distribution, represented as $\theta$, follows a gamma distribution with parameters $\alpha$ and $\beta$. In order to make further inference, again Gibbs sampling can be implemented. However, here we are considering a somewhat different situation: assume a total of 50 independent observations are available, but we only know the class frequencies (@tbl-grouped-data).</span>
<span id="cb21-923"><a href="#cb21-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-924"><a href="#cb21-924" aria-hidden="true" tabindex="-1"></a>| Class              | Frequency |</span>
<span id="cb21-925"><a href="#cb21-925" aria-hidden="true" tabindex="-1"></a>|--------------------|-----------|</span>
<span id="cb21-926"><a href="#cb21-926" aria-hidden="true" tabindex="-1"></a>| 0 -- 1000          | 25        |</span>
<span id="cb21-927"><a href="#cb21-927" aria-hidden="true" tabindex="-1"></a>| 1000 -- 2000       | 15        |</span>
<span id="cb21-928"><a href="#cb21-928" aria-hidden="true" tabindex="-1"></a>| 2000 -- 3000       | 7         |</span>
<span id="cb21-929"><a href="#cb21-929" aria-hidden="true" tabindex="-1"></a>| 3000 -- $\infty$   | 3         |</span>
<span id="cb21-930"><a href="#cb21-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-931"><a href="#cb21-931" aria-hidden="true" tabindex="-1"></a>: Grouped data</span>
<span id="cb21-932"><a href="#cb21-932" aria-hidden="true" tabindex="-1"></a>{#tbl-grouped-data}</span>
<span id="cb21-933"><a href="#cb21-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-934"><a href="#cb21-934" aria-hidden="true" tabindex="-1"></a>If the original observations (losses) were given, the likelihood function $L(\theta\mid observations)$ can be written as</span>
<span id="cb21-935"><a href="#cb21-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-936"><a href="#cb21-936" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-937"><a href="#cb21-937" aria-hidden="true" tabindex="-1"></a>L(\theta\mid observations) \propto \frac{\theta^{50}\lambda^{50\theta}}{\prod_{i=1}^{50}(\lambda+x_i)^{\theta+1}}</span>
<span id="cb21-938"><a href="#cb21-938" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-939"><a href="#cb21-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-940"><a href="#cb21-940" aria-hidden="true" tabindex="-1"></a>Combining this likelihood function with the conjugate gamma $(\alpha,\beta)$ prior density for $\theta$ results in the following posterior density:</span>
<span id="cb21-941"><a href="#cb21-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-942"><a href="#cb21-942" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-943"><a href="#cb21-943" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb21-944"><a href="#cb21-944" aria-hidden="true" tabindex="-1"></a>f(\theta \mid \text{observations}) &amp;\propto L(\theta) f(\theta)<span class="sc">\\</span></span>
<span id="cb21-945"><a href="#cb21-945" aria-hidden="true" tabindex="-1"></a>&amp;\propto \frac{\theta^{50}\lambda^{50 \theta}}{\prod_{i=1}^{50}(\lambda+x_i)^{\theta+1}} \frac{\beta^{\alpha}}{\Gamma(\alpha)} \theta^{\alpha-1} e^{-\beta\theta}<span class="sc">\\</span></span>
<span id="cb21-946"><a href="#cb21-946" aria-hidden="true" tabindex="-1"></a>&amp;\propto \theta^{49+\alpha} e^{-\theta(\beta-50 \ln\lambda+\sum_{i=1}^{50}\ln(\lambda+x_i))}<span class="sc">\\</span></span>
<span id="cb21-947"><a href="#cb21-947" aria-hidden="true" tabindex="-1"></a>&amp;\follow{gamma}(50+\alpha, \beta-50\ln(\lambda)+\sum_{i=1}^{50}\ln(\lambda+x_i)).</span>
<span id="cb21-948"><a href="#cb21-948" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb21-949"><a href="#cb21-949" aria-hidden="true" tabindex="-1"></a>$$ {#eq-conditional-theta-given-obs}</span>
<span id="cb21-950"><a href="#cb21-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-951"><a href="#cb21-951" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">NOTE</span><span class="co">: (just about) everything in the code is dynamic for sample size (n), but they are hard coded in the tables --&gt;</span></span>
<span id="cb21-952"><a href="#cb21-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-953"><a href="#cb21-953" aria-hidden="true" tabindex="-1"></a>Note that the conditional distribution of $\theta$ once again follows a gamma distribution, this time with parameters $50+\alpha$ and $\beta-50 \ln\lambda+\sum_{i=1}^{50}\ln(\lambda+x_i)$, as shown in equation @eq-conditional-theta-given-obs; this is because of the conjugate nature of the gamma/Pareto distributions. Now, assume $\alpha = 1$ and $\beta = 0.1$. This produces a large variance in the prior distribution. These values form a vague/uninformative prior which reflects the relative ignorance of the prior distribution. While this approach is common, the practitioner should adopt whatever form of the prior density that describes the prior information actually available. Next, a procedure called data augmentation is utilized on the grouped data in order to study individual losses. The augmented data values are all independently distributed given the model parameters and each is distributed according to the Pareto density function. However, they are restricted to the appropriate class interval. Thus, the conditional distribution of the augmented data given the model parameters and the observed class frequencies is described by the following set of truncated Pareto distributions:</span>
<span id="cb21-954"><a href="#cb21-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-955"><a href="#cb21-955" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-956"><a href="#cb21-956" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb21-957"><a href="#cb21-957" aria-hidden="true" tabindex="-1"></a>x_i &amp;\sim\text{truncated }Pareto\,(\theta, \lambda)\text{ on the interval }(0, 1000] ]\text{ for } i = 1,2,\ldots,25<span class="sc">\\</span></span>
<span id="cb21-958"><a href="#cb21-958" aria-hidden="true" tabindex="-1"></a>x_i &amp;\sim\text{truncated }Pareto\,(\theta, \lambda)\text{ on the interval } (1000, 2000] \text{ for } i = 26,27,\ldots,40<span class="sc">\\</span></span>
<span id="cb21-959"><a href="#cb21-959" aria-hidden="true" tabindex="-1"></a>x_i &amp;\sim\text{truncated }Pareto\,(\theta, \lambda)\text{ on the interval } (2000,  3000] \text{ for } i=41,42,\ldots,47<span class="sc">\\</span></span>
<span id="cb21-960"><a href="#cb21-960" aria-hidden="true" tabindex="-1"></a>x_i &amp;\sim\text{truncated }Pareto\,(\theta, \lambda)\text{ on the interval } (3000, \infty) \text{ for } i = 48,49,50.</span>
<span id="cb21-961"><a href="#cb21-961" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb21-962"><a href="#cb21-962" aria-hidden="true" tabindex="-1"></a>$${#eq-trunc-paretos}</span>
<span id="cb21-963"><a href="#cb21-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-964"><a href="#cb21-964" aria-hidden="true" tabindex="-1"></a>By applying Gibbs sampling to the <span class="in">`r n+1`</span> full conditional distributions defined by equations @eq-conditional-theta-given-obs and @eq-trunc-paretos, a Markov chain with an invariant distribution equal to $P(\theta, \text{augmented data} \mid \text{observed data})$ can be simulated. In order to make the posterior inference with respect to $\theta$, the parameter of interest, $<span class="in">`r k`</span>$ replications of this Markov chain are generated. Randomly selected starting values for $\theta$ and the augmented data are used each time.</span>
<span id="cb21-965"><a href="#cb21-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-968"><a href="#cb21-968" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-969"><a href="#cb21-969" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: generate_data3</span></span>
<span id="cb21-970"><a href="#cb21-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-971"><a href="#cb21-971" aria-hidden="true" tabindex="-1"></a><span class="co"># function to generate random data from conditional distributions</span></span>
<span id="cb21-972"><a href="#cb21-972" aria-hidden="true" tabindex="-1"></a>generate_sample <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">k =</span> <span class="dv">10000</span>, <span class="at">n =</span> <span class="dv">50</span>, <span class="at">lambda =</span> <span class="dv">7000</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">beta =</span> <span class="fl">0.1</span>, <span class="at">start_theta =</span> <span class="dv">5</span>, <span class="at">seed =</span> <span class="dv">0</span>) {</span>
<span id="cb21-973"><a href="#cb21-973" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-974"><a href="#cb21-974" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create matrix</span></span>
<span id="cb21-975"><a href="#cb21-975" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> n, <span class="at">ncol =</span> k)</span>
<span id="cb21-976"><a href="#cb21-976" aria-hidden="true" tabindex="-1"></a>  theta <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">data =</span> start_theta, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">ncol =</span> k)</span>
<span id="cb21-977"><a href="#cb21-977" aria-hidden="true" tabindex="-1"></a>  total <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">ncol =</span> k)</span>
<span id="cb21-978"><a href="#cb21-978" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-979"><a href="#cb21-979" aria-hidden="true" tabindex="-1"></a>  <span class="co"># conditionally set random seed</span></span>
<span id="cb21-980"><a href="#cb21-980" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (seed <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="fu">set.seed</span>(seed)</span>
<span id="cb21-981"><a href="#cb21-981" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-982"><a href="#cb21-982" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loop to generate new x's and theta's</span></span>
<span id="cb21-983"><a href="#cb21-983" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb21-984"><a href="#cb21-984" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (i <span class="sc">&lt;=</span> k) {</span>
<span id="cb21-985"><a href="#cb21-985" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-986"><a href="#cb21-986" aria-hidden="true" tabindex="-1"></a>    <span class="co"># generate x | theta based on truncated distribution</span></span>
<span id="cb21-987"><a href="#cb21-987" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb21-988"><a href="#cb21-988" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (j <span class="sc">&lt;=</span> <span class="fl">0.5</span><span class="sc">*</span>n) {</span>
<span id="cb21-989"><a href="#cb21-989" aria-hidden="true" tabindex="-1"></a>        x[j,i] <span class="ot">=</span> <span class="fu">rtrunc</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1000</span>, <span class="at">spec =</span> <span class="st">"pareto2"</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">shape =</span> theta[i], <span class="at">scale =</span> lambda)</span>
<span id="cb21-990"><a href="#cb21-990" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-991"><a href="#cb21-991" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> <span class="cf">if</span> (j <span class="sc">&lt;=</span> <span class="fl">0.8</span><span class="sc">*</span>n) {</span>
<span id="cb21-992"><a href="#cb21-992" aria-hidden="true" tabindex="-1"></a>        x[j,i] <span class="ot">=</span> <span class="fu">rtrunc</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">a =</span> <span class="dv">1000</span>, <span class="at">b =</span> <span class="dv">2000</span>, <span class="at">spec =</span> <span class="st">"pareto2"</span>, <span class="at">min =</span> <span class="dv">1000</span>, <span class="at">shape =</span> theta[i], <span class="at">scale =</span> lambda)</span>
<span id="cb21-993"><a href="#cb21-993" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-994"><a href="#cb21-994" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> <span class="cf">if</span> (j <span class="sc">&lt;=</span> <span class="fu">ceiling</span>(<span class="fl">0.94</span><span class="sc">*</span>n)) {</span>
<span id="cb21-995"><a href="#cb21-995" aria-hidden="true" tabindex="-1"></a>        x[j,i] <span class="ot">=</span> <span class="fu">rtrunc</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">a =</span> <span class="dv">2000</span>, <span class="at">b =</span> <span class="dv">3000</span>, <span class="at">spec =</span> <span class="st">"pareto2"</span>, <span class="at">min =</span> <span class="dv">2000</span>, <span class="at">shape =</span> theta[i], <span class="at">scale =</span> lambda)</span>
<span id="cb21-996"><a href="#cb21-996" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-997"><a href="#cb21-997" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb21-998"><a href="#cb21-998" aria-hidden="true" tabindex="-1"></a>        x[j,i] <span class="ot">=</span> <span class="fu">rtrunc</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">a =</span> <span class="dv">3000</span>, <span class="at">b =</span> <span class="cn">Inf</span>, <span class="at">spec =</span> <span class="st">"pareto2"</span>, <span class="at">min =</span> <span class="dv">3000</span>, <span class="at">shape =</span> theta[i], <span class="at">scale =</span> lambda)</span>
<span id="cb21-999"><a href="#cb21-999" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-1000"><a href="#cb21-1000" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-1001"><a href="#cb21-1001" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-1002"><a href="#cb21-1002" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate total</span></span>
<span id="cb21-1003"><a href="#cb21-1003" aria-hidden="true" tabindex="-1"></a>    total[i] <span class="ot">=</span> <span class="fu">sum</span>(<span class="fu">log</span>(lambda<span class="sc">+</span>x[,i]))</span>
<span id="cb21-1004"><a href="#cb21-1004" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-1005"><a href="#cb21-1005" aria-hidden="true" tabindex="-1"></a>    <span class="co"># generate a theta | x</span></span>
<span id="cb21-1006"><a href="#cb21-1006" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">==</span> k)</span>
<span id="cb21-1007"><a href="#cb21-1007" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb21-1008"><a href="#cb21-1008" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> </span>
<span id="cb21-1009"><a href="#cb21-1009" aria-hidden="true" tabindex="-1"></a>      theta[i<span class="sc">+</span><span class="dv">1</span>] <span class="ot">=</span> <span class="fu">rgamma</span>(<span class="dv">1</span>, <span class="at">shape =</span> <span class="dv">50</span><span class="sc">+</span>alpha, <span class="at">rate =</span> beta<span class="dv">-50</span><span class="sc">*</span><span class="fu">log</span>(lambda)<span class="sc">+</span>total[i])</span>
<span id="cb21-1010"><a href="#cb21-1010" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-1011"><a href="#cb21-1011" aria-hidden="true" tabindex="-1"></a>    <span class="co"># increase counter by 1</span></span>
<span id="cb21-1012"><a href="#cb21-1012" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">=</span> i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb21-1013"><a href="#cb21-1013" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-1014"><a href="#cb21-1014" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-1015"><a href="#cb21-1015" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-1016"><a href="#cb21-1016" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">x =</span> x, <span class="at">theta =</span> theta))</span>
<span id="cb21-1017"><a href="#cb21-1017" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-1018"><a href="#cb21-1018" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-1019"><a href="#cb21-1019" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize items</span></span>
<span id="cb21-1020"><a href="#cb21-1020" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">100000</span></span>
<span id="cb21-1021"><a href="#cb21-1021" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb21-1022"><a href="#cb21-1022" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="dv">7000</span></span>
<span id="cb21-1023"><a href="#cb21-1023" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb21-1024"><a href="#cb21-1024" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb21-1025"><a href="#cb21-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1026"><a href="#cb21-1026" aria-hidden="true" tabindex="-1"></a><span class="co"># sample from conditional distributions</span></span>
<span id="cb21-1027"><a href="#cb21-1027" aria-hidden="true" tabindex="-1"></a>data_sample <span class="ot">&lt;-</span> <span class="fu">generate_sample</span>(<span class="at">k =</span> k, <span class="at">n =</span> n, <span class="at">lambda =</span> lambda, <span class="at">alpha =</span> alpha, <span class="at">beta =</span> beta, <span class="at">start_theta =</span> <span class="dv">5</span>, <span class="at">seed =</span> seed)</span>
<span id="cb21-1028"><a href="#cb21-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1029"><a href="#cb21-1029" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-1030"><a href="#cb21-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1033"><a href="#cb21-1033" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-1034"><a href="#cb21-1034" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: preview-sample3</span></span>
<span id="cb21-1035"><a href="#cb21-1035" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb21-1036"><a href="#cb21-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1037"><a href="#cb21-1037" aria-hidden="true" tabindex="-1"></a><span class="co"># preview</span></span>
<span id="cb21-1038"><a href="#cb21-1038" aria-hidden="true" tabindex="-1"></a>data_sample[[<span class="st">"x"</span>]] <span class="sc">%&gt;%</span> data.frame <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)) <span class="sc">%&gt;%</span> display_nice</span>
<span id="cb21-1039"><a href="#cb21-1039" aria-hidden="true" tabindex="-1"></a>data_sample[[<span class="st">"theta"</span>]] <span class="sc">%&gt;%</span> data.frame <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)) <span class="sc">%&gt;%</span> <span class="fu">display_nice</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"$</span><span class="sc">\\</span><span class="st">theta_1$"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">theta_2$"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">theta_3$"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">theta_4$"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">theta_5$"</span>))</span>
<span id="cb21-1040"><a href="#cb21-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1041"><a href="#cb21-1041" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-1042"><a href="#cb21-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1043"><a href="#cb21-1043" aria-hidden="true" tabindex="-1"></a>Additionally, let each replication run for ten iterations with only the values generated in the final iteration of each replication will be used. This technique is called thinning, which takes care of the auto-correlation effect of the generated sample. Further, by taking the last 9500 values of the Markov chain, an approximately independent random sample from the posterior distribution $P(\theta \mid \text{observed data})$ can be obtained.</span>
<span id="cb21-1044"><a href="#cb21-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1047"><a href="#cb21-1047" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-1048"><a href="#cb21-1048" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: thin-and-burn</span></span>
<span id="cb21-1049"><a href="#cb21-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1050"><a href="#cb21-1050" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only every 10th x and theta</span></span>
<span id="cb21-1051"><a href="#cb21-1051" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; then get rid of first 500 samples</span></span>
<span id="cb21-1052"><a href="#cb21-1052" aria-hidden="true" tabindex="-1"></a>burn_in <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb21-1053"><a href="#cb21-1053" aria-hidden="true" tabindex="-1"></a>x10 <span class="ot">&lt;-</span> data_sample[[<span class="st">"x"</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb21-1054"><a href="#cb21-1054" aria-hidden="true" tabindex="-1"></a>  data.frame <span class="sc">%&gt;%</span> </span>
<span id="cb21-1055"><a href="#cb21-1055" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">"0"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-1056"><a href="#cb21-1056" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>(<span class="dv">1</span><span class="sc">:</span>burn_in))</span>
<span id="cb21-1057"><a href="#cb21-1057" aria-hidden="true" tabindex="-1"></a>theta10 <span class="ot">&lt;-</span> data_sample[[<span class="st">"theta"</span>]][<span class="fu">seq</span>(<span class="at">from =</span> burn_in, <span class="at">to =</span> k, <span class="at">by =</span> <span class="dv">10</span>)] <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>(<span class="at">theta =</span> .)</span>
<span id="cb21-1058"><a href="#cb21-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1059"><a href="#cb21-1059" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-1060"><a href="#cb21-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1063"><a href="#cb21-1063" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-1064"><a href="#cb21-1064" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: preview-sample3-thinned-burned</span></span>
<span id="cb21-1065"><a href="#cb21-1065" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb21-1066"><a href="#cb21-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1067"><a href="#cb21-1067" aria-hidden="true" tabindex="-1"></a><span class="co"># preview</span></span>
<span id="cb21-1068"><a href="#cb21-1068" aria-hidden="true" tabindex="-1"></a>x10 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)) <span class="sc">%&gt;%</span> display_nice</span>
<span id="cb21-1069"><a href="#cb21-1069" aria-hidden="true" tabindex="-1"></a><span class="fu">display_nice</span>(theta10, <span class="at">col.names =</span> <span class="st">"$</span><span class="sc">\\</span><span class="st">theta$"</span>)</span>
<span id="cb21-1070"><a href="#cb21-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1071"><a href="#cb21-1071" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-1072"><a href="#cb21-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1075"><a href="#cb21-1075" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-1076"><a href="#cb21-1076" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-est-density-theta</span></span>
<span id="cb21-1077"><a href="#cb21-1077" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Estimated density of θ"</span></span>
<span id="cb21-1078"><a href="#cb21-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1079"><a href="#cb21-1079" aria-hidden="true" tabindex="-1"></a><span class="co"># create histogram of theta </span></span>
<span id="cb21-1080"><a href="#cb21-1080" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> theta10) <span class="sc">+</span> </span>
<span id="cb21-1081"><a href="#cb21-1081" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta,</span>
<span id="cb21-1082"><a href="#cb21-1082" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> <span class="fu">after_stat</span>(density),</span>
<span id="cb21-1083"><a href="#cb21-1083" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fill =</span> <span class="st">"Sampled Values"</span>),</span>
<span id="cb21-1084"><a href="#cb21-1084" aria-hidden="true" tabindex="-1"></a>                 <span class="at">binwidth =</span> <span class="fl">0.5</span>,</span>
<span id="cb21-1085"><a href="#cb21-1085" aria-hidden="true" tabindex="-1"></a>                 <span class="at">col =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb21-1086"><a href="#cb21-1086" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">""</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Sampled Values"</span> <span class="ot">=</span> <span class="st">"white"</span>), <span class="at">guide =</span> <span class="st">"legend"</span>) <span class="sc">+</span></span>
<span id="cb21-1087"><a href="#cb21-1087" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb21-1088"><a href="#cb21-1088" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(theta)) <span class="sc">+</span> </span>
<span id="cb21-1089"><a href="#cb21-1089" aria-hidden="true" tabindex="-1"></a>  theme_swd </span>
<span id="cb21-1090"><a href="#cb21-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1091"><a href="#cb21-1091" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-1092"><a href="#cb21-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1093"><a href="#cb21-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1096"><a href="#cb21-1096" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-1097"><a href="#cb21-1097" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-summary-stats</span></span>
<span id="cb21-1098"><a href="#cb21-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1099"><a href="#cb21-1099" aria-hidden="true" tabindex="-1"></a><span class="co"># summary of theta</span></span>
<span id="cb21-1100"><a href="#cb21-1100" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(theta10)</span>
<span id="cb21-1101"><a href="#cb21-1101" aria-hidden="true" tabindex="-1"></a>theta_sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(theta10<span class="sc">$</span>theta)</span>
<span id="cb21-1102"><a href="#cb21-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1103"><a href="#cb21-1103" aria-hidden="true" tabindex="-1"></a><span class="co"># solve for the number of values exceeding 10000</span></span>
<span id="cb21-1104"><a href="#cb21-1104" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; first get subset of extreme cases (largest classes)</span></span>
<span id="cb21-1105"><a href="#cb21-1105" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; then count</span></span>
<span id="cb21-1106"><a href="#cb21-1106" aria-hidden="true" tabindex="-1"></a>extreme_cases <span class="ot">&lt;-</span> x10 <span class="sc">%&gt;%</span> </span>
<span id="cb21-1107"><a href="#cb21-1107" aria-hidden="true" tabindex="-1"></a>  t <span class="sc">%&gt;%</span> </span>
<span id="cb21-1108"><a href="#cb21-1108" aria-hidden="true" tabindex="-1"></a>  data.frame <span class="sc">%&gt;%</span> </span>
<span id="cb21-1109"><a href="#cb21-1109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(<span class="fu">ceiling</span>(<span class="fl">0.94</span><span class="sc">*</span>n)<span class="sc">:</span>n))</span>
<span id="cb21-1110"><a href="#cb21-1110" aria-hidden="true" tabindex="-1"></a>count <span class="ot">&lt;-</span> extreme_cases <span class="sc">%&gt;%</span> </span>
<span id="cb21-1111"><a href="#cb21-1111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">sum</span>(.x <span class="sc">&gt;</span> <span class="dv">10000</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb21-1112"><a href="#cb21-1112" aria-hidden="true" tabindex="-1"></a>  sum</span>
<span id="cb21-1113"><a href="#cb21-1113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-1114"><a href="#cb21-1114" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate percentage</span></span>
<span id="cb21-1115"><a href="#cb21-1115" aria-hidden="true" tabindex="-1"></a>proportion <span class="ot">&lt;-</span> count<span class="sc">/</span>(<span class="fu">dim</span>(extreme_cases)[<span class="dv">1</span>] <span class="sc">*</span> <span class="fu">dim</span>(extreme_cases)[<span class="dv">2</span>])</span>
<span id="cb21-1116"><a href="#cb21-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1117"><a href="#cb21-1117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-1118"><a href="#cb21-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1119"><a href="#cb21-1119" aria-hidden="true" tabindex="-1"></a>These values are used to construct the histogram of sample values for $\theta$ in Figure 9. The sample mean and standard deviation were <span class="in">`r round(mean(theta10$theta), 3)`</span> and <span class="in">`r round(theta_sd, 3)`</span>, respectively.</span>
<span id="cb21-1120"><a href="#cb21-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1121"><a href="#cb21-1121" aria-hidden="true" tabindex="-1"></a>By monitoring the values taken on by the augmented data as the simulation proceeds, posterior inferences can be made with respect to the actual but unobserved losses. For example, by looking at the values of the losses appearing in the upper-most class ($x_{48}$, $x_{49}$, and $x_{50}$), estimates of the posterior probability can be made that one or more of these losses exceeds an upper limit, say 10,000. Knowing a number like this can help in decision making. For this particular model, there was <span class="in">`r count`</span> observations that exceeded 10,000, giving $P(X &gt; 10,000) \approx%$ <span class="in">`r round(proportion*100, 3)`</span> $\%$. </span>
<span id="cb21-1122"><a href="#cb21-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1123"><a href="#cb21-1123" aria-hidden="true" tabindex="-1"></a><span class="fu">## References {.unnumbered}</span></span>
<span id="cb21-1124"><a href="#cb21-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1125"><a href="#cb21-1125" aria-hidden="true" tabindex="-1"></a>::: {#refs}</span>
<span id="cb21-1126"><a href="#cb21-1126" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb21-1127"><a href="#cb21-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1128"><a href="#cb21-1128" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb21-1129"><a href="#cb21-1129" aria-hidden="true" tabindex="-1"></a><span class="fu">## Github repository for code</span></span>
<span id="cb21-1130"><a href="#cb21-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1131"><a href="#cb21-1131" aria-hidden="true" tabindex="-1"></a>You can find the code to reproduce this report at <span class="co">[</span><span class="ot">coltongearhart/greaves</span><span class="co">](https://github.com/coltongearhart/greaves)</span>.</span>
<span id="cb21-1132"><a href="#cb21-1132" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>